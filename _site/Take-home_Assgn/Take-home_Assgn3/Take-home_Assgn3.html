<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rhonda Ho Kah Yee">
<meta name="dcterms.date" content="2023-03-09">

<title>IS415-GAA - Take-home Assignment 3: Predicting HDB Public Housing Resale Pricies using Geographically Weighted Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Week 1&amp;2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html">
 <span class="dropdown-text">Week 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html">
 <span class="dropdown-text">Week 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html">
 <span class="dropdown-text">Week 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html">
 <span class="dropdown-text">Week 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html">
 <span class="dropdown-text">Week 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html">
 <span class="dropdown-text">Week 8</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-class_Ex06.html">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex07/In-class_Ex07.html">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex08/In-class_Ex08.html">
 <span class="dropdown-text">In-class Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex09.html">
 <span class="dropdown-text">In-class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex10/In-class_Ex10.html">
 <span class="dropdown-text">In-class Exercise 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex11/In-class_Ex11.qmd">
 <span class="dropdown-text">In-class Exercise 11</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-assignment" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Assignment</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-assignment">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Assgn/Take-home_Assgn1/Take-home_Assgn1.html">
 <span class="dropdown-text">Take-home Assignment 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Assgn/Take-home_Assgn2/Take-home_Assgn2.html">
 <span class="dropdown-text">Take-home Assignment 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Assgn/Take-home_Assgn3/Take-home_Assgn3.html">
 <span class="dropdown-text">Take-home Assignment 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Take-home Assignment 3: Predicting HDB Public Housing Resale Pricies using Geographically Weighted Methods</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Rhonda Ho Kah Yee </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 9, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">March 26, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#task" id="toc-task" class="nav-link" data-scroll-target="#task">Task</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The Data</a></li>
  </ul></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting Started</a></li>
  <li><a href="#importing-data-and-wrangling" id="toc-importing-data-and-wrangling" class="nav-link" data-scroll-target="#importing-data-and-wrangling">Importing Data and Wrangling</a>
  <ul class="collapse">
  <li><a href="#aspatial-data" id="toc-aspatial-data" class="nav-link" data-scroll-target="#aspatial-data">Aspatial Data</a>
  <ul class="collapse">
  <li><a href="#resale-flat-prices" id="toc-resale-flat-prices" class="nav-link" data-scroll-target="#resale-flat-prices">Resale Flat Prices</a></li>
  <li><a href="#data-pre-processing" id="toc-data-pre-processing" class="nav-link" data-scroll-target="#data-pre-processing">Data Pre-processing</a></li>
  </ul></li>
  <li><a href="#geospatial-data" id="toc-geospatial-data" class="nav-link" data-scroll-target="#geospatial-data">Geospatial Data</a>
  <ul class="collapse">
  <li><a href="#master-plan-2019-boundary" id="toc-master-plan-2019-boundary" class="nav-link" data-scroll-target="#master-plan-2019-boundary">Master Plan 2019 Boundary</a></li>
  <li><a href="#locational-factors-extracted-via-onemapapi-token" id="toc-locational-factors-extracted-via-onemapapi-token" class="nav-link" data-scroll-target="#locational-factors-extracted-via-onemapapi-token">Locational Factors Extracted via onemapAPI token</a></li>
  <li><a href="#cbd-area" id="toc-cbd-area" class="nav-link" data-scroll-target="#cbd-area">CBD Area</a></li>
  <li><a href="#supermarket" id="toc-supermarket" class="nav-link" data-scroll-target="#supermarket">Supermarket</a></li>
  <li><a href="#bus-stop" id="toc-bus-stop" class="nav-link" data-scroll-target="#bus-stop">Bus Stop</a></li>
  <li><a href="#mrtlrt" id="toc-mrtlrt" class="nav-link" data-scroll-target="#mrtlrt">MRT/LRT</a></li>
  <li><a href="#primary-school" id="toc-primary-school" class="nav-link" data-scroll-target="#primary-school">Primary School</a></li>
  <li><a href="#shopping-mall" id="toc-shopping-mall" class="nav-link" data-scroll-target="#shopping-mall">Shopping Mall</a></li>
  </ul></li>
  <li><a href="#data-pre-processing-1" id="toc-data-pre-processing-1" class="nav-link" data-scroll-target="#data-pre-processing-1">Data-Pre Processing</a></li>
  <li><a href="#formulated-functions" id="toc-formulated-functions" class="nav-link" data-scroll-target="#formulated-functions">Formulated Functions</a>
  <ul class="collapse">
  <li><a href="#proximity-distance-calculations" id="toc-proximity-distance-calculations" class="nav-link" data-scroll-target="#proximity-distance-calculations">Proximity Distance Calculations</a></li>
  <li><a href="#facility-count-within-radius-calculations" id="toc-facility-count-within-radius-calculations" class="nav-link" data-scroll-target="#facility-count-within-radius-calculations">Facility Count within Radius Calculations</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#train-test-split" id="toc-train-test-split" class="nav-link" data-scroll-target="#train-test-split">Train-Test Split</a></li>
  <li><a href="#computing-correlation-matrix" id="toc-computing-correlation-matrix" class="nav-link" data-scroll-target="#computing-correlation-matrix">Computing Correlation Matrix</a></li>
  <li><a href="#multiple-linear-regression-model-ols" id="toc-multiple-linear-regression-model-ols" class="nav-link" data-scroll-target="#multiple-linear-regression-model-ols">Multiple Linear Regression Model (OLS)</a>
  <ul class="collapse">
  <li><a href="#test-of-multicollinearity-vif" id="toc-test-of-multicollinearity-vif" class="nav-link" data-scroll-target="#test-of-multicollinearity-vif">Test of multicollinearity (VIF)</a></li>
  </ul></li>
  <li><a href="#gwr-predictive-method" id="toc-gwr-predictive-method" class="nav-link" data-scroll-target="#gwr-predictive-method">GWR Predictive Method</a>
  <ul class="collapse">
  <li><a href="#converting-the-sf-data.frame-to-spatialpointdataframe" id="toc-converting-the-sf-data.frame-to-spatialpointdataframe" class="nav-link" data-scroll-target="#converting-the-sf-data.frame-to-spatialpointdataframe">Converting the sf data.frame to SpatialPointDataFrame</a></li>
  <li><a href="#computing-adaptive-bandwidth" id="toc-computing-adaptive-bandwidth" class="nav-link" data-scroll-target="#computing-adaptive-bandwidth">Computing adaptive bandwidth</a></li>
  <li><a href="#constructing-the-adaptive-bandwidth-gwr-model" id="toc-constructing-the-adaptive-bandwidth-gwr-model" class="nav-link" data-scroll-target="#constructing-the-adaptive-bandwidth-gwr-model">Constructing the adaptive bandwidth GWR model</a></li>
  </ul></li>
  <li><a href="#preparing-coordinates-data" id="toc-preparing-coordinates-data" class="nav-link" data-scroll-target="#preparing-coordinates-data">Preparing coordinates data</a>
  <ul class="collapse">
  <li><a href="#extracting-coordinates-data" id="toc-extracting-coordinates-data" class="nav-link" data-scroll-target="#extracting-coordinates-data">Extracting coordinates data</a></li>
  </ul></li>
  <li><a href="#calibrating-random-forest-model" id="toc-calibrating-random-forest-model" class="nav-link" data-scroll-target="#calibrating-random-forest-model">Calibrating Random Forest Model</a></li>
  <li><a href="#calibrating-a-geographically-weighted-random-forest" id="toc-calibrating-a-geographically-weighted-random-forest" class="nav-link" data-scroll-target="#calibrating-a-geographically-weighted-random-forest">Calibrating a Geographically Weighted Random Forest</a></li>
  <li><a href="#predicting-by-using-test-data" id="toc-predicting-by-using-test-data" class="nav-link" data-scroll-target="#predicting-by-using-test-data">Predicting by using Test Data</a>
  <ul class="collapse">
  <li><a href="#multiple-linear-regression-ols" id="toc-multiple-linear-regression-ols" class="nav-link" data-scroll-target="#multiple-linear-regression-ols">Multiple Linear Regression (OLS)</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest">Random Forest</a></li>
  <li><a href="#gwrf-model" id="toc-gwrf-model" class="nav-link" data-scroll-target="#gwrf-model">GWRF model</a></li>
  <li><a href="#models-evaluation" id="toc-models-evaluation" class="nav-link" data-scroll-target="#models-evaluation">Models Evaluation</a></li>
  <li><a href="#calculating-root-mean-square-error" id="toc-calculating-root-mean-square-error" class="nav-link" data-scroll-target="#calculating-root-mean-square-error">Calculating Root Mean Square Error</a>
  <ul class="collapse">
  <li><a href="#multiple-linear-regression-ols-1" id="toc-multiple-linear-regression-ols-1" class="nav-link" data-scroll-target="#multiple-linear-regression-ols-1">Multiple Linear Regression (OLS)</a></li>
  <li><a href="#random-forest-1" id="toc-random-forest-1" class="nav-link" data-scroll-target="#random-forest-1">Random Forest</a></li>
  <li><a href="#gwrf-model-1" id="toc-gwrf-model-1" class="nav-link" data-scroll-target="#gwrf-model-1">GWRF model</a></li>
  </ul></li>
  <li><a href="#visualising-the-predicted-values" id="toc-visualising-the-predicted-values" class="nav-link" data-scroll-target="#visualising-the-predicted-values">Visualising the Predicted Values</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="overview" class="level1">
<h1>Overview</h1>
<p>Hello! This is Rhonda Ho’s take-home Assignment 3 for IS415 module.</p>
<p>To view/hide all the code at once, please click on the “&lt;/&gt; code” tab beside the title of this html document and select the option to view/hide the code.</p>
<p>The full details of this assignment can be found <a href="https://is415-ay2022-23t2.netlify.app/th_ex3.html">here</a>.</p>
<section id="task" class="level2">
<h2 class="anchored" data-anchor-id="task">Task</h2>
<p>In this take-home exercise, I am tasked to predict HDB resale prices at the sub-market level (i.e.&nbsp;HDB 3-room, HDB 4-room and HDB 5-room) for the month of January and February 2023 in Singapore. The predictive models must be built by using by using conventional OLS method and GWR methods. I am also required to compare the performance of the conventional OLS method versus the geographical weighted methods.</p>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<p>Below is the list of datasets i have collected.</p>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Dataset</th>
<th>File Format</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Aspatial</td>
<td><a href="https://data.gov.sg/dataset/resale-flat-prices">Resale Flat Prices</a></td>
<td>.csv</td>
</tr>
<tr class="even">
<td>Geospatial</td>
<td><a href="https://data.gov.sg/dataset/master-plan-2014-subzone-boundary-web">Master Plan 2014 Subzone Boundary (Web)</a></td>
<td>.kml</td>
</tr>
<tr class="odd">
<td>Geospatial</td>
<td><a href="https://datamall.lta.gov.sg/content/datamall/en/search_datasets.html?searchText=bus%20stop">Bus Stop Location</a></td>
<td><p>.kml</p>
<p>.shp</p></td>
</tr>
<tr class="even">
<td>Geospatial</td>
<td><a href="https://datamall.lta.gov.sg/content/datamall/en/search_datasets.html?searchText=Train">Train Station</a></td>
<td><p>.kml</p>
<p>.shp</p></td>
</tr>
<tr class="odd">
<td>Geospatial</td>
<td><a href="https://data.gov.sg/dataset/school-directory-and-information">School Directory and Information</a></td>
<td>.csv</td>
</tr>
<tr class="even">
<td>Geospatial-Extracted</td>
<td>Child Care Services</td>
<td>.shp</td>
</tr>
<tr class="odd">
<td>Geospatial-Extracted</td>
<td>Eldercare Services</td>
<td>.rds</td>
</tr>
<tr class="even">
<td>Geospatial-Extracted</td>
<td>Hawker Centres</td>
<td>.rds</td>
</tr>
<tr class="odd">
<td>Geospatial-Extracted</td>
<td>Kindergarterns</td>
<td>.rds</td>
</tr>
<tr class="even">
<td>Geospatial-Extracted</td>
<td>Parks</td>
<td>.rds</td>
</tr>
<tr class="odd">
<td>Geospatial</td>
<td><a href="https://data.gov.sg/dataset/supermarkets">Supermarket</a></td>
<td>.geoson</td>
</tr>
<tr class="even">
<td>Geospatial</td>
<td><a href="https://github.com/ValaryLim/Mall-Coordinates-Web-Scraper">Shopping Malls</a></td>
<td>.csv</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="getting-started" class="level1">
<h1>Getting Started</h1>
<p>The following packages will be used:</p>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/sf/index.html"><strong>sf</strong></a>: used for importing, managing, and processing geospatial data</p></li>
<li><p><a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>: a collection of packages for data science tasks</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/tmap/index.html"><strong>tmap</strong></a>: used for creating thematic maps, such as choropleth and bubble maps</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/sfdep/index.html"><strong>sfdep</strong></a>: used to create spatial weights matrix objects, global and local spatial autocorrelation statistics and related calculations (e.g.&nbsp;spatially lag attributes)</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/onemapsgapi/index.html"><strong>onemapsgapi</strong></a>: used to query Singapore-specific spatial data, alongside additional functionalities.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/units/index.html"><strong>units</strong></a>: used to for manipulating numeric vectors that have physical measurement units associated with them</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/matrixStats/index.html"><strong>matrixStats</strong></a>: a set of high-performing functions for operating on rows and columns of matrices</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html"><strong>jsonlite</strong></a>: a JSON parser that can convert from JSON to the appropraite R data types</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/olsrr/index.html"><strong>olsrr</strong></a>: used for building least squares regression models</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/httr/"><strong>httr</strong></a> : used to make API calls, such as a GET request</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/ggpubr/index.html"><strong>ggpubr</strong></a>: used for multivariate data visualisation &amp; analysis</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/GWmodel/index.html"><strong>GWmodel</strong></a>: provides a collection of localised spatial statistical methods, such as summary statistics, principal components analysis, discriminant analysis and various forms of GW regression</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/SpatialML/index.html"><strong>SpatialML</strong></a><strong>:</strong> allows for a geographically weighted random forest regression including a function to find the optical bandwidth</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/ranger/index.html"><strong>Ranger</strong></a><strong>:</strong> a fast implementation of Random Forests, particularly suited for high dimensional data</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html"><strong>cowplot</strong></a>: a simple add-on to ggplot and provides various features that help with creating publication-quality figures.</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(readxl, sf, tidyverse, units, matrixStats, olsrr , gdata, tmap, sfdep, jsonlite, onemapsgapi, rvest, ranger, SpatialML, readxl, GWmodel, httr, cowplot )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="importing-data-and-wrangling" class="level1">
<h1>Importing Data and Wrangling</h1>
<section id="aspatial-data" class="level2">
<h2 class="anchored" data-anchor-id="aspatial-data">Aspatial Data</h2>
<section id="resale-flat-prices" class="level3">
<h3 class="anchored" data-anchor-id="resale-flat-prices">Resale Flat Prices</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/resale-flat-prices-based-on-registration-date-from-jan-2017-onwards.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(resale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Having a glimpse of our data, we can observe that this dataset has a total of 11 columns and 149071 rows. The columns consist of month, town, flat_type, block, street_name, storey_range, floor_area_sqm, flat_model, lease_commence_date, remaining_lease, resale_price.</p>
<p>For this assignment, the dataset will focus on:</p>
<ul>
<li><p>Transaction period: Oct 2022 to February 2023</p></li>
<li><p>Training dataset period: Oct 2022 to December 2023</p></li>
<li><p>Test dataset period: January 2023 to February 2023</p></li>
<li><p>Type of rook flat: 5-room flats</p></li>
</ul>
<p>The code chunk filters our dataset accordingly.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>resale<span class="ot">&lt;-</span> resale <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"5 ROOM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2022-10"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2023-02"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on my <a href="https://is415-msty.netlify.app/posts/2021-10-25-take-home-exercise-3/?panelset1=extracted2&amp;panelset2=base3&amp;panelset3=base4&amp;panelset=base&amp;panelset4=sg">senior’s</a> experience, “ST.” is usually written as “SAINT” instead - for example, St.&nbsp;Luke’s Primary School is written as Saint Luke’s Primary School. To address, this, we’ll replace such occurrences:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>resale<span class="sc">$</span>street_name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"ST</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"SAINT"</span>, resale<span class="sc">$</span>street_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Subsequently, as our dataset is missing the coordinates for the location, I created a function, <code>geocode()</code>, which calls onemapAPI to retrieve the geometry of each location.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(httr)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>geocode <span class="ot">&lt;-</span> <span class="cf">function</span>(block, streetname) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://developers.onemap.sg/commonapi/search"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  address <span class="ot">&lt;-</span> <span class="fu">paste</span>(block, streetname, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"searchVal"</span> <span class="ot">=</span> address, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"returnGeom"</span> <span class="ot">=</span> <span class="st">"Y"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"getAddrDetails"</span> <span class="ot">=</span> <span class="st">"N"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pageNum"</span> <span class="ot">=</span> <span class="st">"1"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">GET</span>(base_url, <span class="at">query =</span> query)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  restext<span class="ot">&lt;-</span><span class="fu">content</span>(res, <span class="at">as=</span><span class="st">"text"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(restext)  <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    as.data.frame <span class="sc">%&gt;%</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(results.LATITUDE, results.LONGITUDE)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>While exploring the <a href="https://app.swaggerhub.com/apis/onemap-sg/new-onemap-api/1.0.4#/OneMap%20REST%20APIs/search">API</a>, I realised that the best search parameter would be to combine the column block with its street_name. Thus, the function <code>geocode()</code> takes in both the block and street name .</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>resale<span class="sc">$</span>LATITUDE <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>resale<span class="sc">$</span>LONGITUDE <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(resale)){</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  temp_output <span class="ot">&lt;-</span> <span class="fu">geocode</span>(resale[i, <span class="dv">4</span>], resale[i, <span class="dv">5</span>])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  resale<span class="sc">$</span>LATITUDE[i] <span class="ot">&lt;-</span> temp_output<span class="sc">$</span>results.LATITUDE</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  resale<span class="sc">$</span>LONGITUDE[i] <span class="ot">&lt;-</span> temp_output<span class="sc">$</span>results.LONGITUDE</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To reuse the resale dataset, without calling the API, I saved it into a rds file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale, <span class="st">"data/rds/resale.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>resale_rds<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/resale.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="structural-data" class="level4">
<h4 class="anchored" data-anchor-id="structural-data">Structural Data</h4>
<p>In this section, I will be pre processing the structural data that I need for my tasks.</p>
<section id="floor-level" class="level5">
<h5 class="anchored" data-anchor-id="floor-level">Floor Level</h5>
<p>let’s first take a look at the storey_range values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(resale_rds<span class="sc">$</span>storey_range))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can see that there are 17 storey level ranges categories. The following code chunk recodes the categorical naming to numerical values by assigning 1 to the first range 01 TO 03 and 17 to the last range 49 TO 51.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>storey <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(resale_rds<span class="sc">$</span>storey_range))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>storey_order <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(storey)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>storey_range_order <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(storey, storey_order)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>storey_range_order</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, I will combine it to the original resale df.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>resale_rds <span class="ot">&lt;-</span> <span class="fu">left_join</span>(resale_rds,  storey_range_order, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"storey_range"</span> <span class="ot">=</span> <span class="st">"storey"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="remaining-lease" class="level5">
<h5 class="anchored" data-anchor-id="remaining-lease">Remaining Lease</h5>
<p>Currently, the remaining_lease is in string format but we need it to be numeric. Thus, we need to split the string into month and year and then replace the original values with the calculated value of the remaining lease in years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#e.g of resale$remaining_lease - 53 years 10 months</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>str_list <span class="ot">&lt;-</span> <span class="fu">str_split</span>(resale_rds<span class="sc">$</span>remaining_lease, <span class="st">" "</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#after spliting, [53, years, 10, months]</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(str_list)){</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unlist</span>(str_list[i])) <span class="sc">&gt;</span> <span class="dv">2</span>) {</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(str_list[i])[<span class="dv">1</span>])</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(str_list[i])[<span class="dv">3</span>])</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      resale_rds<span class="sc">$</span>remaining_lease[i] <span class="ot">&lt;-</span> year <span class="sc">+</span> <span class="fu">round</span>(month<span class="sc">/</span><span class="dv">12</span>, <span class="dv">2</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(str_list[i])[<span class="dv">1</span>])</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    resale_rds<span class="sc">$</span>remaining_lease[i] <span class="ot">&lt;-</span> year</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="age-of-unit" class="level5">
<h5 class="anchored" data-anchor-id="age-of-unit">Age of Unit</h5>
<p>To get the age of the unit, I decided to take the current year i.e 2023 and minus the lease commence date year of the the unit.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>str_list <span class="ot">&lt;-</span> resale_rds<span class="sc">$</span>lease_commence_date</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(str_list)){</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    resale_rds<span class="sc">$</span>lease_commence_date[i] <span class="ot">&lt;-</span> <span class="dv">2023</span> <span class="sc">-</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      resale_rds<span class="sc">$</span>lease_commence_date[i]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, we can convert it into a sf.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>resale_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(resale_rds, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"LATITUDE"</span>), </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="data-pre-processing" class="level3">
<h3 class="anchored" data-anchor-id="data-pre-processing">Data Pre-processing</h3>
<p>Under this section, we will check for:</p>
<ul>
<li><p>check for missing values</p></li>
<li><p>check correct coordinates system</p></li>
<li><p>check for invalid geometries</p></li>
</ul>
<section id="check-for-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="check-for-missing-values">Check for Missing Values</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#resale_sf</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(resale_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can observe that we have no missing values.</p>
</section>
<section id="check-for-correct-coordinates-system" class="level4">
<h4 class="anchored" data-anchor-id="check-for-correct-coordinates-system">Check for Correct Coordinates System</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#resale_sf</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(resale_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Our dataset have the correct Singapore coordinates system of 3414.</p>
</section>
<section id="check-for-invalid-geometries" class="level4">
<h4 class="anchored" data-anchor-id="check-for-invalid-geometries">Check for Invalid Geometries</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#resale_sf</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(resale_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the output, our geometries are valid.</p>
<p>Once again, I saved the processed resale_sf in an rds file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale_sf, <span class="st">"data/rds/resale_sf.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="geospatial-data" class="level2">
<h2 class="anchored" data-anchor-id="geospatial-data">Geospatial Data</h2>
<section id="master-plan-2019-boundary" class="level3">
<h3 class="anchored" data-anchor-id="master-plan-2019-boundary">Master Plan 2019 Boundary</h3>
<p>The code chunk below retrieves the geospatial polygon data for Singapore’s region in 2019.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial/MP14_SUBZONE_WEB_PL.kml"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="locational-factors-extracted-via-onemapapi-token" class="level3">
<h3 class="anchored" data-anchor-id="locational-factors-extracted-via-onemapapi-token">Locational Factors Extracted via onemapAPI token</h3>
<p>For some of the locational factors, I will be utilising onemapAPI to retrieve its geometry data.</p>
<p>One method I discovered was the usage of a token to retrieve geometry of locational factors based on its related theme. But before we can proceed on, we need to register for account <a href="https://www.onemap.gov.sg/docs/#register-free-account">here</a> and retrieve the token.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>token <span class="ot">&lt;-</span> <span class="fu">get_token</span>(<span class="st">"user@example.com"</span>, <span class="st">"password"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code chunk below helps us view the available themes. As a token is needed, I first saved the output in an rds file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve available themes that we can refer to</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>avail_themes <span class="ot">&lt;-</span><span class="fu">search_themes</span>(token)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(avail_themes, <span class="st">"data/rds/available_themes.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>By reading the according file, I sorted the themes in alphabetical order, for easier reference.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#read the file for available themes</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>avail_themes<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/available_themes.rds"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#sort by alphabetical order</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>avail_themes<span class="ot">&lt;-</span>avail_themes[<span class="fu">order</span>(avail_themes<span class="sc">$</span>THEMENAME),]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>avail_themes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Looking through the available themes from onemap API, some of the themes relevant to our tasks is:</p>
<table class="table">
<colgroup>
<col style="width: 85%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Theme Name</th>
<th>Query Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Child Care Services</td>
<td>childcare</td>
</tr>
<tr class="even">
<td>Eldercare Services</td>
<td>eldercare</td>
</tr>
<tr class="odd">
<td>Hawker Centres_New (Note: there are other similar themes such as Hawker Centres and Healthier Hawker Centres)</td>
<td>hawkercentre_new</td>
</tr>
<tr class="even">
<td>Kindergartens</td>
<td>kindergartens</td>
</tr>
<tr class="odd">
<td>Parks (Note: there are other similar themes such as Parks@SG and NParks Parks and Nature Reserves)</td>
<td>nationalparks</td>
</tr>
</tbody>
</table>
<p>For the following code chunks, I created a shapefile for each locational factor I am interested in.</p>
<p>The steps taken are:</p>
<ol type="1">
<li><p>Retrieve data such as the geometry and name of the place/amenity by using onemap’s get_theme() function which takes in a theme (i.e query name) and the store the data in a df</p></li>
<li><p>Convert the df to a sf object by using the st_as_sf() function</p></li>
<li><p>Transform crs information to <a href="https://epsg.io/3414">Singapore coordinates system</a> i.e 3414 by using st_transform() function</p></li>
<li><p>Write to a shapefile using st_write() function</p></li>
</ol>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Childcare</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Eldercare</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Hawker Centres</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Kindergartens</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Parks</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: childcare</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name  accordingly to the theme</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>childcare_tibble <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"childcare"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>childcare_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(childcare_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> childcare_sf,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="st">"data/geospatial"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">layer =</span> <span class="st">"childcare"</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">"ESRI Shapefile"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">append=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: eldercare</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name based accordingly to the theme</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>eldercare_tibble <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"eldercare"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>eldercare_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(eldercare_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(eldercare_sf, <span class="st">"data/rds/eldercare.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: new hawker centres</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name based accordingly to the theme</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_tibble &lt;- get_theme(token, "hawkercentre_new")</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>hawkercentre_new_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(hawkercentre_new_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(hawkercentre_new_sf, <span class="st">"data/rds/hawker_new.rds"</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#issues writing in this manner</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#st_write(obj = hawkercentre_new_sf,</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#         dsn = "data/geospatial",</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#         layer = "hawkercentre_new",</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#        driver = "ESRI Shapefile",</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#         append=FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: kindergartens</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name based accordingly to the theme</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>kindergartens_tibble <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"kindergartens"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>kindergartens_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(kindergartens_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(kindergartens_sf, <span class="st">"data/rds/kindergartens.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: parks</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name based accordingly to the theme</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>nationalparks_tibble <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"nationalparks"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>nationalparks_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(nationalparks_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(nationalparks_sf, <span class="st">"data/rds/nationalparks.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Import the following to be used for our tasks later.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>childcare_sf <span class="ot">&lt;-</span><span class="fu">st_read</span>(<span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"childcare"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>eldercare_sf<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/eldercare.rds"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>hawkercentre_new_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/hawker_new.rds"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>kindergartens_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/kindergartens.rds"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>nationalparks_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/nationalparks.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cbd-area" class="level3">
<h3 class="anchored" data-anchor-id="cbd-area">CBD Area</h3>
<p>For this assignment, I consider the CBD area to be in the Downtown Core so I will be using the <a href="https://www.latlong.net/place/downtown-core-singapore-20616.html">coordinates of Downtown Core</a> .</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>lat<span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.287953</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>lng<span class="ot">=</span> <span class="fu">c</span>(<span class="fl">103.851784</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>cbd_sf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(lat, lng) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="supermarket" class="level3">
<h3 class="anchored" data-anchor-id="supermarket">Supermarket</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>supermarket_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/supermarkets-geojson.geojson"</span>) </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>supermarket_sf <span class="ot">&lt;-</span> supermarket_sf <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="bus-stop" class="level3">
<h3 class="anchored" data-anchor-id="bus-stop">Bus Stop</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>bus_stop<span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"BusStop"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>bus_stop_sf <span class="ot">&lt;-</span> bus_stop <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mrtlrt" class="level3">
<h3 class="anchored" data-anchor-id="mrtlrt">MRT/LRT</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mrt <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/"</span>, <span class="at">layer =</span> <span class="st">"Train_Station_Exit_Layer"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>mrt_sf <span class="ot">&lt;-</span> mrt <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="primary-school" class="level3">
<h3 class="anchored" data-anchor-id="primary-school">Primary School</h3>
<p>While searching for a dataset for primary school locations, i’ve crossed upon this dataset from <a href="https://data.gov.sg/">data.gov.sg</a> which has the general information of schools in Singapore. By filtering out <code>themainlevel_code</code> which represents the different types of schools to be Primary, I will be able to extract out the address and postal codes of primary schools in Singapore.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>primary_school <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/geospatial/general-information-of-schools.csv"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>primary_school <span class="ot">&lt;-</span> primary_school <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mainlevel_code <span class="sc">==</span> <span class="st">"PRIMARY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(school_name, address, postal_code)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(primary_school)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the output, we can observe that there are 183 primary schools in Singapore. However, in 2022, the primary school, Juying Primary School was merged together with Pioneer Primary School and it cannot be found via the API . Thus, I decided to remove it out of our data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>primary_school<span class="ot">&lt;-</span>primary_school <span class="sc">%&gt;%</span>  </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school_name<span class="sc">!=</span><span class="st">'JUYING PRIMARY SCHOOL'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Once again, we can use geocode() function we created earlier to help us extract the geometry of each primary school by its school name.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>primary_school<span class="sc">$</span>LATITUDE <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>primary_school<span class="sc">$</span>LONGITUDE <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(primary_school)){</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  temp_output <span class="ot">&lt;-</span> <span class="fu">geocode</span>(primary_school[i, <span class="dv">1</span>],<span class="st">""</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  primary_school<span class="sc">$</span>LATITUDE[i] <span class="ot">&lt;-</span> temp_output<span class="sc">$</span>results.LATITUDE</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  primary_school<span class="sc">$</span>LONGITUDE[i] <span class="ot">&lt;-</span> temp_output<span class="sc">$</span>results.LONGITUDE</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To reuse the primary school data without recalling the API, I saved it in an rds file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(primary_school, <span class="st">"data/rds/primary_school.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>primary_school_rds<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/primary_school.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we can convert our df into a sf.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>primary_school_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(primary_school_rds,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"LATITUDE"</span>),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>However, besides this, we need to determine what is a good primary school (which is necessary for 1 of our tasks). Based on the assumption that a good primary school is a popular one, I picked out the top 10 popular primary schools, referencing its popularity from this <a href="https://schoolbell.sg/primary-school-ranking/">website</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>popular_primary_schools <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Pei Hwa Presbyterian Primary School"</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Gongshang Primary School"</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Riverside Primary School"</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Red Swastika School"</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Punggol Green Primary School"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Princess Elizabeth Primary School"</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Westwood Primary School"</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"St. Hilda’s Primary School"</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Catholic High School (Primary Section)"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Ai Tong School"</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>popular_primary_schools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, I need to check whether the top 10 most popular primary schools can be found in the primary school data i extracted earlier. But before that, to make things consistent, I used lapply() function and make the schools names I picked out from the website to be all in uppercase.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#make school names all uppercase</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>popular_primary_schools <span class="ot">&lt;-</span> <span class="fu">lapply</span>(popular_primary_schools, toupper) </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to check both primary school datasets matches</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>popular_primary_schools_sf <span class="ot">&lt;-</span> primary_school_sf <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school_name <span class="sc">%in%</span> popular_primary_schools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(popular_primary_schools_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the output above, out of the 10 primary schools, only 8 can be found. The code chunk below tells us which primary schools are missing.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(popular_primary_schools[<span class="sc">!</span>(popular_primary_schools <span class="sc">%in%</span> popular_primary_schools_sf<span class="sc">$</span>school_name)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Looking further into our dataset, I found out that in the original primary school dataset, the schools names of the output above is written different. For eg, CANOSSA CATHOLIC PRIMARY SCHOOL is the same as CATHOLIC HIGH SCHOOL (PRIMARY SECTION). Thus, I decided to use rbind() function to manually add both records to popular_primary_schools_sf.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>popular_primary_schools_sf <span class="ot">&lt;-</span> popular_primary_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(primary_school_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(school_name <span class="sc">==</span> <span class="st">"CANOSSA CATHOLIC PRIMARY SCHOOL"</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>popular_primary_schools_sf <span class="ot">&lt;-</span> popular_primary_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(primary_school_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(school_name <span class="sc">==</span> <span class="st">"ST. HILDA'S PRIMARY SCHOOL"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(popular_primary_schools_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="shopping-mall" class="level3">
<h3 class="anchored" data-anchor-id="shopping-mall">Shopping Mall</h3>
<p>For shopping malls, I used the dataset extracted by <a href="https://github.com/ValaryLim/Mall-Coordinates-Web-Scraper">Valery Lim</a> who webscrapped the shopping malls data from its <a href="https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore">wikipedia</a> in 2019.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>shopping_mall <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/geospatial/mall_coordinates_updated.csv"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>shopping_mall <span class="ot">&lt;-</span> shopping_mall <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, latitude, longitude)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(shopping_mall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Taking a glimpse in our data, there is a total of 184 shopping malls in 2019.</p>
<p>Next, the code chunk below transforms our data with the correct Singapore coordinates system.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>shopping_mall_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(shopping_mall,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"latitude"</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-pre-processing-1" class="level2">
<h2 class="anchored" data-anchor-id="data-pre-processing-1">Data-Pre Processing</h2>
<p>Same as before, we will conduct the following steps for data preprocessing, with an additional step of removing irrelevant columns for certain datasets:</p>
<ul>
<li><p>removing irrelevant columns</p></li>
<li><p>check for missing values</p></li>
<li><p>check correct coordinates system</p></li>
<li><p>check for invalid geometries</p></li>
</ul>
<section id="remove-irrelevant-columns" class="level4">
<h4 class="anchored" data-anchor-id="remove-irrelevant-columns">Remove Irrelevant Columns</h4>
<p>So for our datasets, we only need to know the name and the geometry so in the following code chunks i will be removing/dropping irrelevant columns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mpsz</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"Name"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#childcare_sf</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#combine name and address postal to make it unique, some childcare have same name but diff locations</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>childcare_sf<span class="sc">$</span>full_address <span class="ot">&lt;-</span> <span class="fu">paste</span>(childcare_sf<span class="sc">$</span>NAME, childcare_sf<span class="sc">$</span>ADDRESSP)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>childcare_sf <span class="ot">&lt;-</span> childcare_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"full_address"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">#eldercare_sf</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>eldercare_sf<span class="sc">$</span>full_address <span class="ot">&lt;-</span> <span class="fu">paste</span>(eldercare_sf<span class="sc">$</span>NAME, eldercare_sf<span class="sc">$</span>ADDRESSPOSTALCODE)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>eldercare_sf <span class="ot">&lt;-</span> eldercare_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"full_address"</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_sf</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>hawkercentre_new_sf <span class="ot">&lt;-</span> hawkercentre_new_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"NAME"</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">#kindergartens_sf</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>kindergartens_sf <span class="ot">&lt;-</span> kindergartens_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"NAME"</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co">#nationalparks_sf</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>nationalparks_sf <span class="ot">&lt;-</span> nationalparks_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"NAME"</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="co">#supermarket</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>supermarket_sf <span class="ot">&lt;-</span> supermarket_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"Description"</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="co">#bus stop</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>bus_stop_sf<span class="sc">$</span>stop_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(bus_stop_sf<span class="sc">$</span>BUS_STOP_N, bus_stop_sf<span class="sc">$</span>BUS_ROOF_N, bus_stop_sf<span class="sc">$</span>LOC_DESC)</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>bus_stop_sf <span class="ot">&lt;-</span> bus_stop_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"stop_name"</span>)</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="co">#mrt</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="co">#combine stn name and exit to make each row unique</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>mrt_sf<span class="sc">$</span>stn <span class="ot">&lt;-</span> <span class="fu">paste</span>(mrt_sf<span class="sc">$</span>stn_name, mrt_sf<span class="sc">$</span>exit_code)</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>mrt_sf <span class="ot">&lt;-</span> mrt_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"stn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="check-for-missing-values-1" class="level4">
<h4 class="anchored" data-anchor-id="check-for-missing-values-1">Check for Missing Values</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mpsz</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(mpsz))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">#childcare_sf</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(childcare_sf))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">#eldercare_sf</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(eldercare_sf))</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_sf</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(hawkercentre_new_sf))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">#kindergartens_sf</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(kindergartens_sf))</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">#nationalparks_sf</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(nationalparks_sf))</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="co">#supermarket_sf</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(supermarket_sf))</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="co">#bus stop</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(bus_stop_sf))</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="co">#MRT</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(mrt_sf))</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="co">#shopping_mall_sf</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(shopping_mall_sf))</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="co">#primary_school_sf</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(primary_school_sf))</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="co">#popular_primary_schools_sf</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(popular_primary_schools_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the output, there is no missing values.</p>
</section>
<section id="check-for-correct-coordinates-system-1" class="level4">
<h4 class="anchored" data-anchor-id="check-for-correct-coordinates-system-1">Check for Correct Coordinates System</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mpsz</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mpsz)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#childcare_sf</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(childcare_sf)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">#eldercare_sf</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(eldercare_sf)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_sf</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(hawkercentre_new_sf)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">#kindergartens_sf</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(kindergartens_sf)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co">#nationalparks_sf</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(nationalparks_sf)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co">#supermarket_sf</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(supermarket_sf)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="co">#bus_stop_sf</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(bus_stop_sf)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co">#mrt_sf</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mrt_sf)</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co">#shopping_mall_sf</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(shopping_mall_sf)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="co">#primary_school_sf</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(primary_school_sf)</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co">#popular_primary_schools_sf</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(popular_primary_schools_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the output, our datasets are in the correct coordinate systems.</p>
</section>
<section id="check-for-invalid-geometries-1" class="level4">
<h4 class="anchored" data-anchor-id="check-for-invalid-geometries-1">Check for Invalid Geometries</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mpsz</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co">#childcare_sf</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(childcare_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">#eldercare_sf</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(eldercare_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">#kindergartens_sf</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(kindergartens_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_sf</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(hawkercentre_new_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co">#nationalparks_sf</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(nationalparks_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co">#supermarket_sf</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(supermarket_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="co">#bus_stop_sf</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(bus_stop_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co">#mrt_sf</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mrt_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="co">#shopping_mall_sf</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(shopping_mall_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="co">#primary_school_sf</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(primary_school_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="co">#popular_primary_schools_sf</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(popular_primary_schools_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the output, we can see that only the mpsz dataset has invalid geometries. The code chunk beow addresses this issue.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(mpsz)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualisations" class="level4">
<h4 class="anchored" data-anchor-id="visualisations">Visualisations</h4>
<p>The following code chunks shows some visualisations for the data we have just preprocessed.</p>
<section id="subzone-boundary-of-singapore-2014" class="level5">
<h5 class="anchored" data-anchor-id="subzone-boundary-of-singapore-2014"><strong>Subzone Boundary of Singapore 2014</strong></h5>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(mpsz))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mrtlrt-stations-map" class="level5">
<h5 class="anchored" data-anchor-id="mrtlrt-stations-map"><strong>MRT/LRT Stations Map</strong></h5>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mrt_sf) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="bus-map" class="level5">
<h5 class="anchored" data-anchor-id="bus-map"><strong>Bus Map</strong></h5>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(bus_stop_sf) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Bus Stops"</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">main.title.size =</span> <span class="fl">1.2</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">frame =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="educationhealthcare-related-map" class="level5">
<h5 class="anchored" data-anchor-id="educationhealthcare-related-map"><strong>Education/Healthcare related map</strong></h5>
<p>The code chunk below shows the location of:</p>
<ul>
<li><p>childcare centres - blue dots</p></li>
<li><p>eldercare centres - red dots</p></li>
<li><p>kindergartens - orange dots</p></li>
<li><p>primary schools - black dots</p></li>
<li><p>top 10 popular primary schools - grey dots</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(childcare_sf) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="co">#affects transparency of points</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#2ec4b6"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(eldercare_sf) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#e71d36"</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(kindergartens_sf) <span class="sc">+</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#ff9f1c"</span>,</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(primary_school_sf) <span class="sc">+</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#011627"</span>,</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(popular_primary_schools_sf) <span class="sc">+</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">"grey"</span>,</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>One thing we can observe is that there are more childcare centres as compared to the rest.</p>
</section>
<section id="amenities-related-map" class="level5">
<h5 class="anchored" data-anchor-id="amenities-related-map">Amenities Related Map</h5>
<p>The code chunk below shows the location of:</p>
<ul>
<li><p>supermarkets - red dots</p></li>
<li><p>shopping malls - orange dots</p></li>
<li><p>national parks - dark green dots</p></li>
<li><p>hawker centres - blue dots</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(supermarket_sf) <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="co">#affects transparency of points</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#d62828"</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(shopping_mall_sf) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#f77f00"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(supermarket_sf) <span class="sc">+</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#fcbf49"</span>,</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(nationalparks_sf) <span class="sc">+</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#023020"</span>,</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hawkercentre_new_sf) <span class="sc">+</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#ADD8E6"</span>,</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="resale-flat-prices-1" class="level5">
<h5 class="anchored" data-anchor-id="resale-flat-prices-1">Resale Flat Prices</h5>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(resale_sf) <span class="sc">+</span>  </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"resale_price"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">style=</span><span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sets minimum zoom level to 11, sets maximum zoom level to 14</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can observe that from July 2022 to December 2022, the are majority of the 5 room HDB flats can be found in the east side of Singapore and the higher priced flats tend to be in the southern-eastern side of Singapore.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="formulated-functions" class="level2">
<h2 class="anchored" data-anchor-id="formulated-functions">Formulated Functions</h2>
<section id="proximity-distance-calculations" class="level3">
<h3 class="anchored" data-anchor-id="proximity-distance-calculations">Proximity Distance Calculations</h3>
<p>As per our task , we need to find the proximity of certain facilities i.e proximity to CBD, eldercare, hawker centres, MRT, park, good primary school, shopping mall and supermarket. It can be computed by creating a function called proximity which utilises st_distance() to find the closest facility (shortest distance) with the rowMins() function of our matrixStats package. The values will then be appended to the resale_sf as a new column.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>proximity <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, varname) {</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  dist_matrix <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(df1, df2) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_units</span>()</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  df1[,varname] <span class="ot">&lt;-</span> <span class="fu">rowMins</span>(dist_matrix)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df1)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>resale_sf<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/resale_sf.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#CBD, eldercare, hawker centres, MRT, park, good primary school, shopping mall and supermarket.</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>resale_sf <span class="ot">&lt;-</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(resale_sf, cbd_sf, <span class="st">"PROX_CBD"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., eldercare_sf, <span class="st">"PROX_ELDERCARE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., hawkercentre_new_sf, <span class="st">"PROX_HAWKER"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., mrt_sf, <span class="st">"PROX_MRT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., nationalparks_sf, <span class="st">"PROX_PARK"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., popular_primary_schools_sf, <span class="st">"PROX_GDPRISCH"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., shopping_mall_sf, <span class="st">"PROX_SHOPPINGMALL"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., supermarket_sf, <span class="st">"PROX_SPRMKT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="facility-count-within-radius-calculations" class="level3">
<h3 class="anchored" data-anchor-id="facility-count-within-radius-calculations">Facility Count within Radius Calculations</h3>
<p>As per our task, we also want to find the number of facilities within a particular radius. Thus, we have to create another function called num_radius() which utilise st_distance() to compute the distance between the flats and the desiredfacilities, and then sum up the observations with rowSums(). The values will be appended to the data frame as a new column.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>num_radius <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, varname, radius) {</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  dist_matrix <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(df1, df2) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_units</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  df1[,varname] <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(dist_matrix <span class="sc">&lt;=</span> radius)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df1)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Numbers of kindergartens within 350m, Numbers of childcare centres within 350m, Numbers of bus stop within 350m, Numbers of primary school within 1km</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>resale_sf <span class="ot">&lt;-</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(resale_sf, kindergartens_sf, <span class="st">"NUM_KNDRGTN"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., childcare_sf, <span class="st">"NUM_CHILDCARE"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., bus_stop_sf, <span class="st">"NUM_BUS_STOP"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., primary_school_sf, <span class="st">"NUM_PRISCH"</span>, <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Once again, I would like to save the latest resale_sf file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale_sf, <span class="st">"data/rds/resale_sf_complete.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(<span class="fu">readRDS</span>(<span class="st">"data/rds/resale_sf_complete.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="train-test-split" class="level1">
<h1>Train-Test Split</h1>
<p>As earlier mentioned, for the resale dataset,</p>
<ul>
<li><p>Training dataset period: October 2022 to December 2023</p></li>
<li><p>Test dataset period: January 2023 to February 2023</p></li>
</ul>
<p>Hence, the code chunk below reads the rds file - resale_sf which we created earlier on and splits the dataset accordingly.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>resale_sf_complete<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/resale_sf_complete.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>resale_train <span class="ot">&lt;-</span> resale_sf_complete <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2022-10"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2022-12"</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>         flat_type <span class="sc">==</span> <span class="st">"5 ROOM"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>resale_test <span class="ot">&lt;-</span> resale_sf_complete <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2023-01"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2023-02"</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>         flat_type <span class="sc">==</span> <span class="st">"5 ROOM"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For future references, I will be writing the train and test data set of resale_sf as a rds file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale_train, <span class="st">"data/model/resale_train.rds"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale_test, <span class="st">"data/model/resale_test.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code chunk below reads our train and test dataset of resale_sf.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/resale_train.rds"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/resale_test.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Having a glimpse at our training and test data, I realised that there are some columns that are irrelevant for our subsequent tasks such as flat_model , town, flat_type, block and street_name. Thus, I removed it.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span><span class="fu">subset</span>(train_data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(month,flat_model, town,flat_type, block,street_name, storey_range ))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span><span class="fu">subset</span>(test_data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(month,flat_model, town,flat_type, block,street_name, storey_range ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The lease_commence_date represents the age of the unit that we had calculated earlier on but its name can be misleading so I changed the name to age.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(train_data)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"age"</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(test_data)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"age"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Looking at our data again, the type of age and remaining_lease is characters but it should be numeric/integer so i changed it accordingly.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>age  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(train_data<span class="sc">$</span>age)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>age  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data<span class="sc">$</span>age)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>remaining_lease  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(train_data<span class="sc">$</span>remaining_lease)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>remaining_lease  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data<span class="sc">$</span>remaining_lease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, we are done processing our train and test data for our subsequent tasks!</p>
<p>The code chunk below shows a summary of our resale prices.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train_data<span class="sc">$</span>resale_price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="computing-correlation-matrix" class="level1">
<h1>Computing Correlation Matrix</h1>
<p>Before loading the predictors into a predictive model, it is always a good practice to use correlation matrix to examine if there is sign of multicolinearity.</p>
<p>But before that, we need to drop our geometry values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>train_nogeo <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code chunk below saves the rds file for training data without geometry so we can use it later.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(train_nogeo, <span class="st">"data/model/train_nogeo.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code chunk below computes the correlation matrix.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(train_nogeo), </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">diag =</span> <span class="cn">FALSE</span>, </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="st">"AOE"</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tl.pos =</span> <span class="st">"td"</span>, </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tl.cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"number"</span>, </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"upper"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In <a href="https://blog.clairvoyantsoft.com/correlation-and-collinearity-how-they-can-make-or-break-a-model-9135fbe6936a">general</a>, an absolute correlation coefficient of &gt;0.7 among two or more predictors indicates the presence of multicollinearity. As we have a lot of variables, it is quite hard to see the correlation value, but most seems to be okay except age with its correlation to remaining_lease being -1. This indicates that age of the unit and the remaining lease have perfect multicollinearity and we should remove either the age or remaining lease when creating our linear regression model.</p>
<p>The code chunk below removes the age of unit from our dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#removes age column</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>train_nogeo<span class="ot">&lt;-</span>train_nogeo[,<span class="sc">-</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Another way to check multicolinearity is looking at the Variance Inflation Factor (VIF) which we will perform later.</p>
</section>
<section id="multiple-linear-regression-model-ols" class="level1">
<h1>Multiple Linear Regression Model (OLS)</h1>
<p>First, let’s build our multi regression model where y is resale_price and x is the independent predictors.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>mlr1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(resale_price <span class="sc">~</span>. ,</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train_nogeo)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlr1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the output, we can infer that the adjusted R square is 0.7054 which roughly indicates that 70% of the variance of the dependent variable being studied is explained by the variance of the independent variable. It seems that most of the predictors are significant (p-value&lt;0.5) except for PROX_SPRMKT, PROX_SHOPPINGMALL, PROX_GDPRISCH and NUM_BUS_STOP.</p>
<section id="test-of-multicollinearity-vif" class="level2">
<h2 class="anchored" data-anchor-id="test-of-multicollinearity-vif">Test of multicollinearity (VIF)</h2>
<p>We can use ols_vif_tol() function of our olsrr package to calculate VIF. In general, if the VIF value is less than 5, then there is usually no sign/possibility of correlations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_vif_tol</span>(mlr1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Th higher the VIF, the less reliable our regression results are going to be. Based on the output, there are no signs of multicollinearity as VIF &lt;5.</p>
<p>The code chunk below saves the results of our model to an rds file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mlr1, <span class="st">"data/model/mlr1.rds"</span> ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="gwr-predictive-method" class="level1">
<h1>GWR Predictive Method</h1>
<p>In this section, we will calibrate our mlr1 model to predict HDB resale prices.</p>
<section id="converting-the-sf-data.frame-to-spatialpointdataframe" class="level2">
<h2 class="anchored" data-anchor-id="converting-the-sf-data.frame-to-spatialpointdataframe">Converting the sf data.frame to SpatialPointDataFrame</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>train_data_sp <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(train_data[,<span class="sc">-</span><span class="dv">2</span>])</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>train_data_sp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="computing-adaptive-bandwidth" class="level2">
<h2 class="anchored" data-anchor-id="computing-adaptive-bandwidth">Computing adaptive bandwidth</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(resale_price <span class="sc">~</span>.,</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> train_data_sp,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">approach=</span><span class="st">"CV"</span>,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel=</span><span class="st">"gaussian"</span>,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">longlat=</span><span class="cn">FALSE</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="img/bw_adaptive_out.PNG" class="img-fluid" width="397"></p>
<p>Doing cross-validation while utilising a gaussian kernel, the smallest CV score is 3.054284e+12 and its adaptive bandwidth is 22.</p>
<p>Next, we will save the adaptive bandwidth as an rds file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(bw_adaptive, <span class="at">file =</span> <span class="st">"data/model/bw_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="constructing-the-adaptive-bandwidth-gwr-model" class="level2">
<h2 class="anchored" data-anchor-id="constructing-the-adaptive-bandwidth-gwr-model">Constructing the adaptive bandwidth GWR model</h2>
<p>First, let’s call the saved bandwith by using the code chunk below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/bw_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, we can go ahead to calibrate the gwr-based hedonic pricing model by using adaptive bandwidth and Gaussian kernel as shown in the code chunk below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span>.,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data=</span>train_data_sp,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">bw=</span>bw_adaptive, </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code chunk below will be used to save the model in rds format for future use.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwr_adaptive, <span class="st">"data/model/gwr_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code below can be used to display the model output.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/gwr_adaptive.rds"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>gwr_adaptive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From the output above, we can observe that the GWR Adjusted R-square is 0.9243233, which is higher than the non-spatial mulitiple linear regression model’s Adjusted R-square of 0.709 . Based on <a href="https://builtin.com/data-science/adjusted-r-squared#:~:text=R%2Dsquared%20measures%20the%20goodness,is%20not%20a%20good%20fit.">research</a>, R-squared measures the goodness of fit of a regression model. Hence, a higher R-squared indicates the model is a good fit, while a lower R-squared indicates the model is not a good fit which suggests that the GWR model is a better fit.</p>
<p>GWR model also has a lower AIC i.e 35569.1 than the regression model’s AIC i.e 37841.04. Based on <a href="https://www.scribbr.com/statistics/akaike-information-criterion/#:~:text=Lower%20AIC%20scores%20are%20better,be%20the%20better%2Dfit%20model.">research</a>, the lower AIC scores, the better it is, as AIC penalizes models that use more parameters.</p>
</section>
</section>
<section id="preparing-coordinates-data" class="level1">
<h1>Preparing coordinates data</h1>
<section id="extracting-coordinates-data" class="level2">
<h2 class="anchored" data-anchor-id="extracting-coordinates-data">Extracting coordinates data</h2>
<p>The code chunk below extract the x,y coordinates of the full, training and test data sets.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(train_data)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>coords_test <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Before continue, we write all the output into rds for future uses</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(coords_train, <span class="st">"data/model/coords_train.rds"</span> )</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>coords_test <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(coords_test, <span class="st">"data/model/coords_test.rds"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, we need to retrieve our training data, which does not have the geometry.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>train_nogeo_rds<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/model/train_nogeo.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="calibrating-random-forest-model" class="level1">
<h1>Calibrating Random Forest Model</h1>
<p>Now, we will calibrate a model to predict HDB resale price by using random forest function of ranger package. Set.seed() is used to keep results constant as random forest is a simulation. Based on <a href="https://medium.com/@raj5287/effects-of-multi-collinearity-in-logistic-regression-svm-rf-af6766d91f1b#:~:text=Random%20Forest%20uses%20bootstrap%20sampling,different%20set%20of%20data%20points.">research</a>, random forest uses bootstrap sampling and feature sampling, i.e row sampling and column sampling. Therefore, Random Forest is not affected by multicollinearity that much since it is picking different set of features for different models and every model sees a different set of data points. This means that I do not need to remove the age variable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(resale_price <span class="sc">~</span>.,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>train_nogeo_rds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the output, for a random forest of 500 trees, the OOB prediction error (MSE) is 2833677157 and the R squared (OOB) / R2 is 0.8524123 which implies that around 85% of the variance of the train data is explained by the model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(rf<span class="sc">$</span>prediction.error)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Random forest rmse is 53232.29.</p>
</section>
<section id="calibrating-a-geographically-weighted-random-forest" class="level1">
<h1>Calibrating a Geographically Weighted Random Forest</h1>
<p>Next, we would like to calibrate the Geographically Weighted Random Forest by using the grf.bw() function. As the grf.bw() function is computationally expensive, I will be running it on a subset of the data (500 rows). Even though the bandwidth of using 500 rows would differ a lot from the bandwidth of using the whole dataset, but for this assignment approximating it on a subset is good enough as a proof of concept.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>gwRF_bw <span class="ot">&lt;-</span> <span class="fu">grf.bw</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>                    age <span class="sc">+</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                    remaining_lease <span class="sc">+</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                    floor_area_sqm <span class="sc">+</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>                    storey_order <span class="sc">+</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>                    PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>                    PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_GDPRISCH <span class="sc">+</span> PROX_SPRMKT <span class="sc">+</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>                    PROX_SHOPPINGMALL <span class="sc">+</span> </span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>                    NUM_KNDRGTN <span class="sc">+</span> NUM_CHILDCARE <span class="sc">+</span> NUM_BUS_STOP <span class="sc">+</span> NUM_PRISCH,</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train_nogeo_rds[<span class="dv">0</span><span class="sc">:</span><span class="dv">500</span>,],</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">kernel =</span> <span class="st">"adaptive"</span>,</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">trees =</span> <span class="dv">30</span>,</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">coords =</span> coords_train[<span class="dv">0</span><span class="sc">:</span><span class="dv">500</span>,]</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>                )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="img/bw_gwr2.PNG" class="img-fluid" width="389"></p>
<p>As computation time is too long, I will use what has been generated so far. Based on the output, the best bandwidth is 85 with a R2 of 0.761592272965718.</p>
<p>Next, I used the bandwidth discovered previously to calibrate our GWRF model. Afterwards, I saved it into an rds file.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">grf</span>(resale_price <span class="sc">~</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                    age <span class="sc">+</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>                    remaining_lease <span class="sc">+</span> </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>                    floor_area_sqm <span class="sc">+</span> storey_order <span class="sc">+</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>                    PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>                    PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_GDPRISCH <span class="sc">+</span> PROX_SPRMKT <span class="sc">+</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>                    PROX_SHOPPINGMALL <span class="sc">+</span> </span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>                    NUM_KNDRGTN <span class="sc">+</span> NUM_CHILDCARE <span class="sc">+</span> NUM_BUS_STOP <span class="sc">+</span> NUM_PRISCH,</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dframe=</span>train_nogeo_rds, </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bw=</span> <span class="dv">85</span>,</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ntree =</span> <span class="dv">30</span>,</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">kernel=</span><span class="st">"adaptive"</span>,</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">coords=</span>coords_train)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwRF_adaptive, <span class="st">"data/model/gwRF_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#write_rds(gwRF_adaptive, "data/model/gwRF_adaptive.rds")</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/gwRF_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#look at important variables</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gwRF_adaptive<span class="sc">$</span>Local.Variable.Importance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive<span class="sc">$</span>Global.Model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The output shows that the R2 is 0.8331023. for a GWR model of 30 trees and a bandwidth of 86.</p>
</section>
<section id="predicting-by-using-test-data" class="level1">
<h1>Predicting by using Test Data</h1>
<section id="multiple-linear-regression-ols" class="level2">
<h2 class="anchored" data-anchor-id="multiple-linear-regression-ols">Multiple Linear Regression (OLS)</h2>
<p>The code chunk below uses predict.lm() function of the stats package to run inference on our test data and save it into RDS format.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>ols_pred <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(mlr1, test_data[,<span class="sc">-</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"data/model/ols_pred.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<p>The code chunk below uses predict() function of the ranger package to run inference on our test data and save it into RDS format.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>rf_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf, test_data) <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"data/model/rf_pred.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="gwrf-model" class="level2">
<h2 class="anchored" data-anchor-id="gwrf-model">GWRF model</h2>
<p>The code chunk below will be used to combine the test data with its corresponding coordinates data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, coords_test) <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, predict.grf() of spatialML package will be used to predict the resale value by using the test data and gwRF_adaptive model calibrated earlier.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>gwRF_pred <span class="ot">&lt;-</span> <span class="fu">predict.grf</span>(gwRF_adaptive, </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>                           test_data, </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x.var.name=</span><span class="st">"X"</span>,</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y.var.name=</span><span class="st">"Y"</span>, </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">local.w=</span><span class="dv">1</span>,</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">global.w=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Before moving on, let us save the output into rds file for future use.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>GRF_pred <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(gwRF_pred, <span class="st">"data/model/GRF_pred.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The output of the predict.grf() is a vector of predicted values. It is wiser to convert it into a data frame for further visualisation and analysis.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>GRF_pred <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/GRF_pred.rds"</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>GRF_pred_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(GRF_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the code chunk below, cbind() is used to append the predicted values for both the GRF and multiple linear regression mode onto test_data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for gwrf</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>test_data_p <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, GRF_pred_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(test_data_p, <span class="st">"data/model/test_data_p.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="models-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="models-evaluation">Models Evaluation</h2>
<p>To evaluate the 3 models, we can combine the resale price and predicted prices of each model into a single dataframe.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>ols_pred_df <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/ols_pred.rds"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ols_pred_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ols_pred"</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>rf_pred_df <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/rf_pred.rds"</span>)<span class="sc">$</span>predictions <span class="sc">%&gt;%</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rf_pred_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rf_pred"</span>)</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>gwRF_pred_df <span class="ot">&lt;-</span>  GRF_pred <span class="sc">%&gt;%</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gwRF_pred_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gwrf_pred"</span>)</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>prices_pred_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data<span class="sc">$</span>resale_price, ols_pred_df, rf_pred_df,</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>                        gwRF_pred_df) <span class="sc">%&gt;%</span> </span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"actual_price"</span> <span class="ot">=</span> <span class="st">"test_data$resale_price"</span>)</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prices_pred_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Looking at the results, it seems like gwrf model has the closest predicted value to the actual price as compared to the other models.</p>
</section>
<section id="calculating-root-mean-square-error" class="level2">
<h2 class="anchored" data-anchor-id="calculating-root-mean-square-error">Calculating Root Mean Square Error</h2>
<p>The root mean square error (RMSE) allows us to measure how far predicted values are from observed values in a regression analysis.</p>
<section id="multiple-linear-regression-ols-1" class="level3">
<h3 class="anchored" data-anchor-id="multiple-linear-regression-ols-1">Multiple Linear Regression (OLS)</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lm</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co">#MSE &lt;- mean((test_data$resale_price - lm_predicted_value)^2)</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse_lm &lt;- sqrt(MSE)</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((prices_pred_df<span class="sc">$</span>actual_price <span class="sc">-</span> prices_pred_df<span class="sc">$</span>ols_pred)<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="random-forest-1" class="level3">
<h3 class="anchored" data-anchor-id="random-forest-1">Random Forest</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((prices_pred_df<span class="sc">$</span>actual_price <span class="sc">-</span> prices_pred_df<span class="sc">$</span>rf_pred)<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="gwrf-model-1" class="level3">
<h3 class="anchored" data-anchor-id="gwrf-model-1">GWRF model</h3>
<p>In the code chunk below, rmse() of Metrics package is used to compute the RMSE for GRF model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#grf</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse</span>(test_data_p<span class="sc">$</span>resale_price, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>     test_data_p<span class="sc">$</span>GRF_pred)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co">#sqrt(mean((prices_pred_df$actual_price - prices_pred_df$gwrf_pred)^2))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Comparing the 3 models RMSE, the GWRF model has the lowest RMSE of 53185.72 as compared to OLS model’s RMSE of 69388.4 and random forest model’s RMSE of 52045.52. <a href="https://help.sap.com/docs/SAP_PREDICTIVE_ANALYTICS/41d1a6d4e7574e32b815f1cc87c00f42/5e5198fd4afe4ae5b48fefe0d3161810.html#:~:text=The%20Root%20Mean%20Squared%20Error%20(RMSE)%20is%20one%20of%20the,the%20target%20value%20(accuracy).">RMSE</a> measures the average difference between values predicted by a model and the actual values and provides an estimation of how well the model is able to predict the target value (accuracy). Hence, among the 3 models, the GWRF model will be better model at predicting the resale price.</p>
</section>
</section>
<section id="visualising-the-predicted-values" class="level2">
<h2 class="anchored" data-anchor-id="visualising-the-predicted-values">Visualising the Predicted Values</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>test_data_models <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, prices_pred_df)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>gwr_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> test_data_p,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> GRF_pred,</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> resale_price)) <span class="sc">+</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">col =</span> <span class="st">"Red"</span>)</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>lm_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> test_data_models,</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ols_pred,</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> actual_price)) <span class="sc">+</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">col =</span> <span class="st">"Red"</span>)</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>rf_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> test_data_models,</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> rf_pred,</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> actual_price)) <span class="sc">+</span></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">col =</span> <span class="st">"Red"</span>)</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(gwr_plot, lm_plot, rf_plot, <span class="at">labels =</span> <span class="st">"AUTO"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>By comparing the 3 graphs, GWRF model is more linear while OLS and random forest model points on the right half side, majority of it is above the red line. Thus, we can see that the GWRF model is better than the OLS and random forest model as the scatter points are more closer to the diagonal line.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>In conclusion, be comparing the 3 models’ performance at predicting the actual resale prices, the RMSE and visualisation of its scatterplots, we can determine that GWRF model is the best model at predicting the actual resale prices. One of the reasons why it performs better is because <a href="https://www.publichealth.columbia.edu/research/population-health-methods/geographically-weighted-regression#:~:text=outcome%20of%20interest.-,Description,variables%20to%20vary%20by%20locality.">GWR</a> is an outgrowth of ordinary least squares regression (OLS) and adds a level of modeling sophistication by allowing the relationships between the independent and dependent variables to vary by locality.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb114" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Take-home Assignment 3: Predicting HDB Public Housing Resale Pricies using Geographically Weighted Methods"</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="an">title-block-banner:</span><span class="co"> true</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "9 March 2023"</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> last-modified</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Rhonda Ho Kah Yee"</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="co">      code-fold: true</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="co">      code-tools: true</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: false</span></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># Overview</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>Hello! This is Rhonda Ho's take-home Assignment 3 for IS415 module.</span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>To view/hide all the code at once, please click on the "<span class="sc">\&lt;</span>/<span class="sc">\&gt;</span> code" tab beside the title of this html document and select the option to view/hide the code.</span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>The full details of this assignment can be found <span class="co">[</span><span class="ot">here</span><span class="co">](https://is415-ay2022-23t2.netlify.app/th_ex3.html)</span>.</span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task</span></span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true" tabindex="-1"></a>In this take-home exercise, I am tasked to predict HDB resale prices at the sub-market level (i.e. HDB 3-room, HDB 4-room and HDB 5-room) for the month of January and February 2023 in Singapore. The predictive models must be built by using by using conventional OLS method and GWR methods. I am also required to compare the performance of the conventional OLS method versus the geographical weighted methods.</span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Data</span></span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-37"><a href="#cb114-37" aria-hidden="true" tabindex="-1"></a>Below is the list of datasets i have collected.</span>
<span id="cb114-38"><a href="#cb114-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-39"><a href="#cb114-39" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-40"><a href="#cb114-40" aria-hidden="true" tabindex="-1"></a>| Type                 | Dataset                                                                                                         | File Format |</span>
<span id="cb114-41"><a href="#cb114-41" aria-hidden="true" tabindex="-1"></a>+======================+=================================================================================================================+=============+</span>
<span id="cb114-42"><a href="#cb114-42" aria-hidden="true" tabindex="-1"></a>| Aspatial             | <span class="co">[</span><span class="ot">Resale Flat Prices</span><span class="co">](https://data.gov.sg/dataset/resale-flat-prices)</span>                                            | .csv        |</span>
<span id="cb114-43"><a href="#cb114-43" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-44"><a href="#cb114-44" aria-hidden="true" tabindex="-1"></a>| Geospatial           | <span class="co">[</span><span class="ot">Master Plan 2014 Subzone Boundary (Web)</span><span class="co">](https://data.gov.sg/dataset/master-plan-2014-subzone-boundary-web)</span>    | .kml        |</span>
<span id="cb114-45"><a href="#cb114-45" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-46"><a href="#cb114-46" aria-hidden="true" tabindex="-1"></a>| Geospatial           | <span class="co">[</span><span class="ot">Bus Stop Location</span><span class="co">](https://datamall.lta.gov.sg/content/datamall/en/search_datasets.html?searchText=bus%20stop)</span> | .kml        |</span>
<span id="cb114-47"><a href="#cb114-47" aria-hidden="true" tabindex="-1"></a>|                      |                                                                                                                 |             |</span>
<span id="cb114-48"><a href="#cb114-48" aria-hidden="true" tabindex="-1"></a>|                      |                                                                                                                 | .shp        |</span>
<span id="cb114-49"><a href="#cb114-49" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-50"><a href="#cb114-50" aria-hidden="true" tabindex="-1"></a>| Geospatial           | <span class="co">[</span><span class="ot">Train Station</span><span class="co">](https://datamall.lta.gov.sg/content/datamall/en/search_datasets.html?searchText=Train)</span>          | .kml        |</span>
<span id="cb114-51"><a href="#cb114-51" aria-hidden="true" tabindex="-1"></a>|                      |                                                                                                                 |             |</span>
<span id="cb114-52"><a href="#cb114-52" aria-hidden="true" tabindex="-1"></a>|                      |                                                                                                                 | .shp        |</span>
<span id="cb114-53"><a href="#cb114-53" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-54"><a href="#cb114-54" aria-hidden="true" tabindex="-1"></a>| Geospatial           | <span class="co">[</span><span class="ot">School Directory and Information</span><span class="co">](https://data.gov.sg/dataset/school-directory-and-information)</span>                | .csv        |</span>
<span id="cb114-55"><a href="#cb114-55" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-56"><a href="#cb114-56" aria-hidden="true" tabindex="-1"></a>| Geospatial-Extracted | Child Care Services                                                                                             | .shp        |</span>
<span id="cb114-57"><a href="#cb114-57" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-58"><a href="#cb114-58" aria-hidden="true" tabindex="-1"></a>| Geospatial-Extracted | Eldercare Services                                                                                              | .rds        |</span>
<span id="cb114-59"><a href="#cb114-59" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-60"><a href="#cb114-60" aria-hidden="true" tabindex="-1"></a>| Geospatial-Extracted | Hawker Centres                                                                                                  | .rds        |</span>
<span id="cb114-61"><a href="#cb114-61" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-62"><a href="#cb114-62" aria-hidden="true" tabindex="-1"></a>| Geospatial-Extracted | Kindergarterns                                                                                                  | .rds        |</span>
<span id="cb114-63"><a href="#cb114-63" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-64"><a href="#cb114-64" aria-hidden="true" tabindex="-1"></a>| Geospatial-Extracted | Parks                                                                                                           | .rds        |</span>
<span id="cb114-65"><a href="#cb114-65" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-66"><a href="#cb114-66" aria-hidden="true" tabindex="-1"></a>| Geospatial           | <span class="co">[</span><span class="ot">Supermarket</span><span class="co">](https://data.gov.sg/dataset/supermarkets)</span>                                                         | .geoson     |</span>
<span id="cb114-67"><a href="#cb114-67" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-68"><a href="#cb114-68" aria-hidden="true" tabindex="-1"></a>| Geospatial           | <span class="co">[</span><span class="ot">Shopping Malls</span><span class="co">](https://github.com/ValaryLim/Mall-Coordinates-Web-Scraper)</span>                                     | .csv        |</span>
<span id="cb114-69"><a href="#cb114-69" aria-hidden="true" tabindex="-1"></a>+----------------------+-----------------------------------------------------------------------------------------------------------------+-------------+</span>
<span id="cb114-70"><a href="#cb114-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-71"><a href="#cb114-71" aria-hidden="true" tabindex="-1"></a><span class="fu"># Getting Started</span></span>
<span id="cb114-72"><a href="#cb114-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-73"><a href="#cb114-73" aria-hidden="true" tabindex="-1"></a>The following packages will be used:</span>
<span id="cb114-74"><a href="#cb114-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-75"><a href="#cb114-75" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**sf**</span><span class="co">](https://cran.r-project.org/web/packages/sf/index.html)</span>: used for importing, managing, and processing geospatial data</span>
<span id="cb114-76"><a href="#cb114-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-77"><a href="#cb114-77" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**tidyverse**</span><span class="co">](https://www.tidyverse.org/)</span>: a collection of packages for data science tasks</span>
<span id="cb114-78"><a href="#cb114-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-79"><a href="#cb114-79" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**tmap**</span><span class="co">](https://cran.r-project.org/web/packages/tmap/index.html)</span>: used for creating thematic maps, such as choropleth and bubble maps</span>
<span id="cb114-80"><a href="#cb114-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-81"><a href="#cb114-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**sfdep**</span><span class="co">](https://cran.r-project.org/web/packages/sfdep/index.html)</span>: used to create spatial weights matrix objects, global and local spatial autocorrelation statistics and related calculations (e.g.&nbsp;spatially lag attributes)</span>
<span id="cb114-82"><a href="#cb114-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-83"><a href="#cb114-83" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**onemapsgapi**</span><span class="co">](https://cran.r-project.org/web/packages/onemapsgapi/index.html)</span>: used to query Singapore-specific spatial data, alongside additional functionalities.</span>
<span id="cb114-84"><a href="#cb114-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-85"><a href="#cb114-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**units**</span><span class="co">](https://cran.r-project.org/web/packages/units/index.html)</span>: used to for manipulating numeric vectors that have physical measurement units associated with them</span>
<span id="cb114-86"><a href="#cb114-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-87"><a href="#cb114-87" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**matrixStats**</span><span class="co">](https://cran.r-project.org/web/packages/matrixStats/index.html)</span>: a set of high-performing functions for operating on rows and columns of matrices</span>
<span id="cb114-88"><a href="#cb114-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-89"><a href="#cb114-89" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**jsonlite**</span><span class="co">](https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html)</span>: a JSON parser that can convert from JSON to the appropraite R data types</span>
<span id="cb114-90"><a href="#cb114-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-91"><a href="#cb114-91" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**olsrr**</span><span class="co">](https://cran.r-project.org/web/packages/olsrr/index.html)</span>: used for building least squares regression models</span>
<span id="cb114-92"><a href="#cb114-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-93"><a href="#cb114-93" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**httr**</span><span class="co">](https://cran.r-project.org/web/packages/httr/)</span> : used to make API calls, such as a GET request</span>
<span id="cb114-94"><a href="#cb114-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-95"><a href="#cb114-95" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**ggpubr**</span><span class="co">](https://cran.r-project.org/web/packages/ggpubr/index.html)</span>: used for multivariate data visualisation &amp; analysis</span>
<span id="cb114-96"><a href="#cb114-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-97"><a href="#cb114-97" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**GWmodel**</span><span class="co">](https://cran.r-project.org/web/packages/GWmodel/index.html)</span>: provides a collection of localised spatial statistical methods, such as summary statistics, principal components analysis, discriminant analysis and various forms of GW regression</span>
<span id="cb114-98"><a href="#cb114-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-99"><a href="#cb114-99" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**SpatialML**</span><span class="co">](https://cran.r-project.org/web/packages/SpatialML/index.html)</span>**:** allows for a geographically weighted random forest regression including a function to find the optical bandwidth</span>
<span id="cb114-100"><a href="#cb114-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-101"><a href="#cb114-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Ranger**</span><span class="co">](https://cran.r-project.org/web/packages/ranger/index.html)</span>**:** a fast implementation of Random Forests, particularly suited for high dimensional data</span>
<span id="cb114-102"><a href="#cb114-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-103"><a href="#cb114-103" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**cowplot**</span><span class="co">](https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html)</span>: a simple add-on to ggplot and provides various features that help with creating publication-quality figures.</span>
<span id="cb114-104"><a href="#cb114-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-107"><a href="#cb114-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-108"><a href="#cb114-108" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(readxl, sf, tidyverse, units, matrixStats, olsrr , gdata, tmap, sfdep, jsonlite, onemapsgapi, rvest, ranger, SpatialML, readxl, GWmodel, httr, cowplot )</span>
<span id="cb114-109"><a href="#cb114-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-110"><a href="#cb114-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-111"><a href="#cb114-111" aria-hidden="true" tabindex="-1"></a><span class="fu"># Importing Data and Wrangling</span></span>
<span id="cb114-112"><a href="#cb114-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-113"><a href="#cb114-113" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aspatial Data</span></span>
<span id="cb114-114"><a href="#cb114-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-115"><a href="#cb114-115" aria-hidden="true" tabindex="-1"></a><span class="fu">### Resale Flat Prices</span></span>
<span id="cb114-116"><a href="#cb114-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-119"><a href="#cb114-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-120"><a href="#cb114-120" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/resale-flat-prices-based-on-registration-date-from-jan-2017-onwards.csv"</span>)</span>
<span id="cb114-121"><a href="#cb114-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-122"><a href="#cb114-122" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(resale)</span>
<span id="cb114-123"><a href="#cb114-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-124"><a href="#cb114-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-125"><a href="#cb114-125" aria-hidden="true" tabindex="-1"></a>Having a glimpse of our data, we can observe that this dataset has a total of 11 columns and 149071 rows. The columns consist of month, town, flat_type, block, street_name, storey_range, floor_area_sqm, flat_model, lease_commence_date, remaining_lease, resale_price.</span>
<span id="cb114-126"><a href="#cb114-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-127"><a href="#cb114-127" aria-hidden="true" tabindex="-1"></a>For this assignment, the dataset will focus on:</span>
<span id="cb114-128"><a href="#cb114-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-129"><a href="#cb114-129" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Transaction period: Oct 2022 to February 2023</span>
<span id="cb114-130"><a href="#cb114-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-131"><a href="#cb114-131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Training dataset period: Oct 2022 to December 2023</span>
<span id="cb114-132"><a href="#cb114-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-133"><a href="#cb114-133" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Test dataset period: January 2023 to February 2023</span>
<span id="cb114-134"><a href="#cb114-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-135"><a href="#cb114-135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Type of rook flat: 5-room flats</span>
<span id="cb114-136"><a href="#cb114-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-137"><a href="#cb114-137" aria-hidden="true" tabindex="-1"></a>The code chunk filters our dataset accordingly.</span>
<span id="cb114-138"><a href="#cb114-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-141"><a href="#cb114-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-142"><a href="#cb114-142" aria-hidden="true" tabindex="-1"></a>resale<span class="ot">&lt;-</span> resale <span class="sc">%&gt;%</span> </span>
<span id="cb114-143"><a href="#cb114-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"5 ROOM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-144"><a href="#cb114-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2022-10"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2023-02"</span>)</span>
<span id="cb114-145"><a href="#cb114-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-146"><a href="#cb114-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-147"><a href="#cb114-147" aria-hidden="true" tabindex="-1"></a>Based on my <span class="co">[</span><span class="ot">senior's</span><span class="co">](https://is415-msty.netlify.app/posts/2021-10-25-take-home-exercise-3/?panelset1=extracted2&amp;panelset2=base3&amp;panelset3=base4&amp;panelset=base&amp;panelset4=sg)</span> experience, "ST." is usually written as "SAINT" instead - for example, St. Luke's Primary School is written as Saint Luke's Primary School. To address, this, we'll replace such occurrences:</span>
<span id="cb114-148"><a href="#cb114-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-151"><a href="#cb114-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-152"><a href="#cb114-152" aria-hidden="true" tabindex="-1"></a>resale<span class="sc">$</span>street_name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"ST</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"SAINT"</span>, resale<span class="sc">$</span>street_name)</span>
<span id="cb114-153"><a href="#cb114-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-154"><a href="#cb114-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-155"><a href="#cb114-155" aria-hidden="true" tabindex="-1"></a>Subsequently, as our dataset is missing the coordinates for the location, I created a function, <span class="in">`geocode()`</span>, which calls onemapAPI to retrieve the geometry of each location.</span>
<span id="cb114-156"><a href="#cb114-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-159"><a href="#cb114-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-160"><a href="#cb114-160" aria-hidden="true" tabindex="-1"></a><span class="co">#library(httr)</span></span>
<span id="cb114-161"><a href="#cb114-161" aria-hidden="true" tabindex="-1"></a>geocode <span class="ot">&lt;-</span> <span class="cf">function</span>(block, streetname) {</span>
<span id="cb114-162"><a href="#cb114-162" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://developers.onemap.sg/commonapi/search"</span></span>
<span id="cb114-163"><a href="#cb114-163" aria-hidden="true" tabindex="-1"></a>  address <span class="ot">&lt;-</span> <span class="fu">paste</span>(block, streetname, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb114-164"><a href="#cb114-164" aria-hidden="true" tabindex="-1"></a>  query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"searchVal"</span> <span class="ot">=</span> address, </span>
<span id="cb114-165"><a href="#cb114-165" aria-hidden="true" tabindex="-1"></a>                <span class="st">"returnGeom"</span> <span class="ot">=</span> <span class="st">"Y"</span>,</span>
<span id="cb114-166"><a href="#cb114-166" aria-hidden="true" tabindex="-1"></a>                <span class="st">"getAddrDetails"</span> <span class="ot">=</span> <span class="st">"N"</span>,</span>
<span id="cb114-167"><a href="#cb114-167" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pageNum"</span> <span class="ot">=</span> <span class="st">"1"</span>)</span>
<span id="cb114-168"><a href="#cb114-168" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb114-169"><a href="#cb114-169" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">GET</span>(base_url, <span class="at">query =</span> query)</span>
<span id="cb114-170"><a href="#cb114-170" aria-hidden="true" tabindex="-1"></a>  restext<span class="ot">&lt;-</span><span class="fu">content</span>(res, <span class="at">as=</span><span class="st">"text"</span>)</span>
<span id="cb114-171"><a href="#cb114-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb114-172"><a href="#cb114-172" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(restext)  <span class="sc">%&gt;%</span> </span>
<span id="cb114-173"><a href="#cb114-173" aria-hidden="true" tabindex="-1"></a>    as.data.frame <span class="sc">%&gt;%</span></span>
<span id="cb114-174"><a href="#cb114-174" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(results.LATITUDE, results.LONGITUDE)</span>
<span id="cb114-175"><a href="#cb114-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-176"><a href="#cb114-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb114-177"><a href="#cb114-177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-178"><a href="#cb114-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-179"><a href="#cb114-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-180"><a href="#cb114-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-181"><a href="#cb114-181" aria-hidden="true" tabindex="-1"></a>While exploring the <span class="co">[</span><span class="ot">API</span><span class="co">](https://app.swaggerhub.com/apis/onemap-sg/new-onemap-api/1.0.4#/OneMap%20REST%20APIs/search)</span>, I realised that the best search parameter would be to combine the column block with its street_name. Thus, the function <span class="in">`geocode()`</span> takes in both the block and street name .</span>
<span id="cb114-182"><a href="#cb114-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-185"><a href="#cb114-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-186"><a href="#cb114-186" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-187"><a href="#cb114-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-188"><a href="#cb114-188" aria-hidden="true" tabindex="-1"></a>resale<span class="sc">$</span>LATITUDE <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb114-189"><a href="#cb114-189" aria-hidden="true" tabindex="-1"></a>resale<span class="sc">$</span>LONGITUDE <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb114-190"><a href="#cb114-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-191"><a href="#cb114-191" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(resale)){</span>
<span id="cb114-192"><a href="#cb114-192" aria-hidden="true" tabindex="-1"></a>  temp_output <span class="ot">&lt;-</span> <span class="fu">geocode</span>(resale[i, <span class="dv">4</span>], resale[i, <span class="dv">5</span>])</span>
<span id="cb114-193"><a href="#cb114-193" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb114-194"><a href="#cb114-194" aria-hidden="true" tabindex="-1"></a>  resale<span class="sc">$</span>LATITUDE[i] <span class="ot">&lt;-</span> temp_output<span class="sc">$</span>results.LATITUDE</span>
<span id="cb114-195"><a href="#cb114-195" aria-hidden="true" tabindex="-1"></a>  resale<span class="sc">$</span>LONGITUDE[i] <span class="ot">&lt;-</span> temp_output<span class="sc">$</span>results.LONGITUDE</span>
<span id="cb114-196"><a href="#cb114-196" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-197"><a href="#cb114-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-198"><a href="#cb114-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-199"><a href="#cb114-199" aria-hidden="true" tabindex="-1"></a>To reuse the resale dataset, without calling the API, I saved it into a rds file.</span>
<span id="cb114-200"><a href="#cb114-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-203"><a href="#cb114-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-204"><a href="#cb114-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-205"><a href="#cb114-205" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale, <span class="st">"data/rds/resale.rds"</span>)</span>
<span id="cb114-206"><a href="#cb114-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-207"><a href="#cb114-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-210"><a href="#cb114-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-211"><a href="#cb114-211" aria-hidden="true" tabindex="-1"></a>resale_rds<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/resale.rds"</span>)</span>
<span id="cb114-212"><a href="#cb114-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-213"><a href="#cb114-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-214"><a href="#cb114-214" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Structural Data</span></span>
<span id="cb114-215"><a href="#cb114-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-216"><a href="#cb114-216" aria-hidden="true" tabindex="-1"></a>In this section, I will be pre processing the structural data that I need for my tasks.</span>
<span id="cb114-217"><a href="#cb114-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-218"><a href="#cb114-218" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Floor Level</span></span>
<span id="cb114-219"><a href="#cb114-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-220"><a href="#cb114-220" aria-hidden="true" tabindex="-1"></a>let's first take a look at the storey_range values.</span>
<span id="cb114-221"><a href="#cb114-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-224"><a href="#cb114-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-225"><a href="#cb114-225" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(resale_rds<span class="sc">$</span>storey_range))</span>
<span id="cb114-226"><a href="#cb114-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-227"><a href="#cb114-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-228"><a href="#cb114-228" aria-hidden="true" tabindex="-1"></a>We can see that there are 17 storey level ranges categories. The following code chunk recodes the categorical naming to numerical values by assigning 1 to the first range 01 TO 03 and 17 to the last range 49 TO 51.</span>
<span id="cb114-229"><a href="#cb114-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-232"><a href="#cb114-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-233"><a href="#cb114-233" aria-hidden="true" tabindex="-1"></a>storey <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(resale_rds<span class="sc">$</span>storey_range))</span>
<span id="cb114-234"><a href="#cb114-234" aria-hidden="true" tabindex="-1"></a>storey_order <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(storey)</span>
<span id="cb114-235"><a href="#cb114-235" aria-hidden="true" tabindex="-1"></a>storey_range_order <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(storey, storey_order)</span>
<span id="cb114-236"><a href="#cb114-236" aria-hidden="true" tabindex="-1"></a>storey_range_order</span>
<span id="cb114-237"><a href="#cb114-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-238"><a href="#cb114-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-239"><a href="#cb114-239" aria-hidden="true" tabindex="-1"></a>Next, I will combine it to the original resale df.</span>
<span id="cb114-240"><a href="#cb114-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-243"><a href="#cb114-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-244"><a href="#cb114-244" aria-hidden="true" tabindex="-1"></a>resale_rds <span class="ot">&lt;-</span> <span class="fu">left_join</span>(resale_rds,  storey_range_order, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"storey_range"</span> <span class="ot">=</span> <span class="st">"storey"</span>))</span>
<span id="cb114-245"><a href="#cb114-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-246"><a href="#cb114-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-247"><a href="#cb114-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-248"><a href="#cb114-248" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Remaining Lease</span></span>
<span id="cb114-249"><a href="#cb114-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-250"><a href="#cb114-250" aria-hidden="true" tabindex="-1"></a>Currently, the remaining_lease is in string format but we need it to be numeric. Thus, we need to split the string into month and year and then replace the original values with the calculated value of the remaining lease in years.</span>
<span id="cb114-251"><a href="#cb114-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-254"><a href="#cb114-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-255"><a href="#cb114-255" aria-hidden="true" tabindex="-1"></a><span class="co">#e.g of resale$remaining_lease - 53 years 10 months</span></span>
<span id="cb114-256"><a href="#cb114-256" aria-hidden="true" tabindex="-1"></a>str_list <span class="ot">&lt;-</span> <span class="fu">str_split</span>(resale_rds<span class="sc">$</span>remaining_lease, <span class="st">" "</span>)</span>
<span id="cb114-257"><a href="#cb114-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-258"><a href="#cb114-258" aria-hidden="true" tabindex="-1"></a><span class="co">#after spliting, [53, years, 10, months]</span></span>
<span id="cb114-259"><a href="#cb114-259" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(str_list)){</span>
<span id="cb114-260"><a href="#cb114-260" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unlist</span>(str_list[i])) <span class="sc">&gt;</span> <span class="dv">2</span>) {</span>
<span id="cb114-261"><a href="#cb114-261" aria-hidden="true" tabindex="-1"></a>      year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(str_list[i])[<span class="dv">1</span>])</span>
<span id="cb114-262"><a href="#cb114-262" aria-hidden="true" tabindex="-1"></a>      month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(str_list[i])[<span class="dv">3</span>])</span>
<span id="cb114-263"><a href="#cb114-263" aria-hidden="true" tabindex="-1"></a>      resale_rds<span class="sc">$</span>remaining_lease[i] <span class="ot">&lt;-</span> year <span class="sc">+</span> <span class="fu">round</span>(month<span class="sc">/</span><span class="dv">12</span>, <span class="dv">2</span>)</span>
<span id="cb114-264"><a href="#cb114-264" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb114-265"><a href="#cb114-265" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb114-266"><a href="#cb114-266" aria-hidden="true" tabindex="-1"></a>    year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(str_list[i])[<span class="dv">1</span>])</span>
<span id="cb114-267"><a href="#cb114-267" aria-hidden="true" tabindex="-1"></a>    resale_rds<span class="sc">$</span>remaining_lease[i] <span class="ot">&lt;-</span> year</span>
<span id="cb114-268"><a href="#cb114-268" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb114-269"><a href="#cb114-269" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-270"><a href="#cb114-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-271"><a href="#cb114-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-272"><a href="#cb114-272" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Age of Unit</span></span>
<span id="cb114-273"><a href="#cb114-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-274"><a href="#cb114-274" aria-hidden="true" tabindex="-1"></a>To get the age of the unit, I decided to take the current year i.e 2023 and minus the lease commence date year of the the unit.</span>
<span id="cb114-275"><a href="#cb114-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-278"><a href="#cb114-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-279"><a href="#cb114-279" aria-hidden="true" tabindex="-1"></a>str_list <span class="ot">&lt;-</span> resale_rds<span class="sc">$</span>lease_commence_date</span>
<span id="cb114-280"><a href="#cb114-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-281"><a href="#cb114-281" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(str_list)){</span>
<span id="cb114-282"><a href="#cb114-282" aria-hidden="true" tabindex="-1"></a>    resale_rds<span class="sc">$</span>lease_commence_date[i] <span class="ot">&lt;-</span> <span class="dv">2023</span> <span class="sc">-</span></span>
<span id="cb114-283"><a href="#cb114-283" aria-hidden="true" tabindex="-1"></a>      resale_rds<span class="sc">$</span>lease_commence_date[i]</span>
<span id="cb114-284"><a href="#cb114-284" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-285"><a href="#cb114-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-286"><a href="#cb114-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-287"><a href="#cb114-287" aria-hidden="true" tabindex="-1"></a>Finally, we can convert it into a sf.</span>
<span id="cb114-288"><a href="#cb114-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-291"><a href="#cb114-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-292"><a href="#cb114-292" aria-hidden="true" tabindex="-1"></a>resale_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(resale_rds, </span>
<span id="cb114-293"><a href="#cb114-293" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>, </span>
<span id="cb114-294"><a href="#cb114-294" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"LATITUDE"</span>), </span>
<span id="cb114-295"><a href="#cb114-295" aria-hidden="true" tabindex="-1"></a>                      <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-296"><a href="#cb114-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-297"><a href="#cb114-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-298"><a href="#cb114-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-299"><a href="#cb114-299" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Pre-processing</span></span>
<span id="cb114-300"><a href="#cb114-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-301"><a href="#cb114-301" aria-hidden="true" tabindex="-1"></a>Under this section, we will check for:</span>
<span id="cb114-302"><a href="#cb114-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-303"><a href="#cb114-303" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>check for missing values</span>
<span id="cb114-304"><a href="#cb114-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-305"><a href="#cb114-305" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>check correct coordinates system</span>
<span id="cb114-306"><a href="#cb114-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-307"><a href="#cb114-307" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>check for invalid geometries</span>
<span id="cb114-308"><a href="#cb114-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-309"><a href="#cb114-309" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check for Missing Values</span></span>
<span id="cb114-310"><a href="#cb114-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-313"><a href="#cb114-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-314"><a href="#cb114-314" aria-hidden="true" tabindex="-1"></a><span class="co">#resale_sf</span></span>
<span id="cb114-315"><a href="#cb114-315" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(resale_sf))</span>
<span id="cb114-316"><a href="#cb114-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-317"><a href="#cb114-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-318"><a href="#cb114-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-319"><a href="#cb114-319" aria-hidden="true" tabindex="-1"></a>We can observe that we have no missing values.</span>
<span id="cb114-320"><a href="#cb114-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-321"><a href="#cb114-321" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check for Correct Coordinates System</span></span>
<span id="cb114-322"><a href="#cb114-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-325"><a href="#cb114-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-326"><a href="#cb114-326" aria-hidden="true" tabindex="-1"></a><span class="co">#resale_sf</span></span>
<span id="cb114-327"><a href="#cb114-327" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(resale_sf)</span>
<span id="cb114-328"><a href="#cb114-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-329"><a href="#cb114-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-330"><a href="#cb114-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-331"><a href="#cb114-331" aria-hidden="true" tabindex="-1"></a>Our dataset have the correct Singapore coordinates system of 3414.</span>
<span id="cb114-332"><a href="#cb114-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-333"><a href="#cb114-333" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check for Invalid Geometries</span></span>
<span id="cb114-334"><a href="#cb114-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-337"><a href="#cb114-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-338"><a href="#cb114-338" aria-hidden="true" tabindex="-1"></a><span class="co">#resale_sf</span></span>
<span id="cb114-339"><a href="#cb114-339" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(resale_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-340"><a href="#cb114-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-341"><a href="#cb114-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-342"><a href="#cb114-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-343"><a href="#cb114-343" aria-hidden="true" tabindex="-1"></a>Based on the output, our geometries are valid.</span>
<span id="cb114-344"><a href="#cb114-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-345"><a href="#cb114-345" aria-hidden="true" tabindex="-1"></a>Once again, I saved the processed resale_sf in an rds file.</span>
<span id="cb114-346"><a href="#cb114-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-349"><a href="#cb114-349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-350"><a href="#cb114-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-351"><a href="#cb114-351" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale_sf, <span class="st">"data/rds/resale_sf.rds"</span>)</span>
<span id="cb114-352"><a href="#cb114-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-353"><a href="#cb114-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-354"><a href="#cb114-354" aria-hidden="true" tabindex="-1"></a><span class="fu">## Geospatial Data</span></span>
<span id="cb114-355"><a href="#cb114-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-356"><a href="#cb114-356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Master Plan 2019 Boundary</span></span>
<span id="cb114-357"><a href="#cb114-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-358"><a href="#cb114-358" aria-hidden="true" tabindex="-1"></a>The code chunk below retrieves the geospatial polygon data for Singapore's region in 2019.</span>
<span id="cb114-359"><a href="#cb114-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-362"><a href="#cb114-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-363"><a href="#cb114-363" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial/MP14_SUBZONE_WEB_PL.kml"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-364"><a href="#cb114-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-365"><a href="#cb114-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-366"><a href="#cb114-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-367"><a href="#cb114-367" aria-hidden="true" tabindex="-1"></a><span class="fu">### Locational Factors Extracted via onemapAPI token</span></span>
<span id="cb114-368"><a href="#cb114-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-369"><a href="#cb114-369" aria-hidden="true" tabindex="-1"></a>For some of the locational factors, I will be utilising onemapAPI to retrieve its geometry data.</span>
<span id="cb114-370"><a href="#cb114-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-371"><a href="#cb114-371" aria-hidden="true" tabindex="-1"></a>One method I discovered was the usage of a token to retrieve geometry of locational factors based on its related theme. But before we can proceed on, we need to register for account <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.onemap.gov.sg/docs/#register-free-account)</span> and retrieve the token.</span>
<span id="cb114-372"><a href="#cb114-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-375"><a href="#cb114-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-376"><a href="#cb114-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-377"><a href="#cb114-377" aria-hidden="true" tabindex="-1"></a>token <span class="ot">&lt;-</span> <span class="fu">get_token</span>(<span class="st">"user@example.com"</span>, <span class="st">"password"</span>)</span>
<span id="cb114-378"><a href="#cb114-378" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-379"><a href="#cb114-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-380"><a href="#cb114-380" aria-hidden="true" tabindex="-1"></a>The code chunk below helps us view the available themes. As a token is needed, I first saved the output in an rds file.</span>
<span id="cb114-381"><a href="#cb114-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-384"><a href="#cb114-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-385"><a href="#cb114-385" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-386"><a href="#cb114-386" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve available themes that we can refer to</span></span>
<span id="cb114-387"><a href="#cb114-387" aria-hidden="true" tabindex="-1"></a>avail_themes <span class="ot">&lt;-</span><span class="fu">search_themes</span>(token)</span>
<span id="cb114-388"><a href="#cb114-388" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(avail_themes, <span class="st">"data/rds/available_themes.rds"</span>)</span>
<span id="cb114-389"><a href="#cb114-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-390"><a href="#cb114-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-391"><a href="#cb114-391" aria-hidden="true" tabindex="-1"></a>By reading the according file, I sorted the themes in alphabetical order, for easier reference.</span>
<span id="cb114-392"><a href="#cb114-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-395"><a href="#cb114-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-396"><a href="#cb114-396" aria-hidden="true" tabindex="-1"></a><span class="co">#read the file for available themes</span></span>
<span id="cb114-397"><a href="#cb114-397" aria-hidden="true" tabindex="-1"></a>avail_themes<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/available_themes.rds"</span>)</span>
<span id="cb114-398"><a href="#cb114-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-399"><a href="#cb114-399" aria-hidden="true" tabindex="-1"></a><span class="co">#sort by alphabetical order</span></span>
<span id="cb114-400"><a href="#cb114-400" aria-hidden="true" tabindex="-1"></a>avail_themes<span class="ot">&lt;-</span>avail_themes[<span class="fu">order</span>(avail_themes<span class="sc">$</span>THEMENAME),]</span>
<span id="cb114-401"><a href="#cb114-401" aria-hidden="true" tabindex="-1"></a>avail_themes</span>
<span id="cb114-402"><a href="#cb114-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-403"><a href="#cb114-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-404"><a href="#cb114-404" aria-hidden="true" tabindex="-1"></a>Looking through the available themes from onemap API, some of the themes relevant to our tasks is:</span>
<span id="cb114-405"><a href="#cb114-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-406"><a href="#cb114-406" aria-hidden="true" tabindex="-1"></a>+---------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb114-407"><a href="#cb114-407" aria-hidden="true" tabindex="-1"></a>| Theme Name                                                                                                    | Query Name       |</span>
<span id="cb114-408"><a href="#cb114-408" aria-hidden="true" tabindex="-1"></a>+===============================================================================================================+==================+</span>
<span id="cb114-409"><a href="#cb114-409" aria-hidden="true" tabindex="-1"></a>| Child Care Services                                                                                           | childcare        |</span>
<span id="cb114-410"><a href="#cb114-410" aria-hidden="true" tabindex="-1"></a>+---------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb114-411"><a href="#cb114-411" aria-hidden="true" tabindex="-1"></a>| Eldercare Services                                                                                            | eldercare        |</span>
<span id="cb114-412"><a href="#cb114-412" aria-hidden="true" tabindex="-1"></a>+---------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb114-413"><a href="#cb114-413" aria-hidden="true" tabindex="-1"></a>| Hawker Centres_New (Note: there are other similar themes such as Hawker Centres and Healthier Hawker Centres) | hawkercentre_new |</span>
<span id="cb114-414"><a href="#cb114-414" aria-hidden="true" tabindex="-1"></a>+---------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb114-415"><a href="#cb114-415" aria-hidden="true" tabindex="-1"></a>| Kindergartens                                                                                                 | kindergartens    |</span>
<span id="cb114-416"><a href="#cb114-416" aria-hidden="true" tabindex="-1"></a>+---------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb114-417"><a href="#cb114-417" aria-hidden="true" tabindex="-1"></a>| Parks (Note: there are other similar themes such as Parks\@SG and NParks Parks and Nature Reserves)           | nationalparks    |</span>
<span id="cb114-418"><a href="#cb114-418" aria-hidden="true" tabindex="-1"></a>+---------------------------------------------------------------------------------------------------------------+------------------+</span>
<span id="cb114-419"><a href="#cb114-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-420"><a href="#cb114-420" aria-hidden="true" tabindex="-1"></a>For the following code chunks, I created a shapefile for each locational factor I am interested in.</span>
<span id="cb114-421"><a href="#cb114-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-422"><a href="#cb114-422" aria-hidden="true" tabindex="-1"></a>The steps taken are:</span>
<span id="cb114-423"><a href="#cb114-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-424"><a href="#cb114-424" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Retrieve data such as the geometry and name of the place/amenity by using onemap's get_theme() function which takes in a theme (i.e query name) and the store the data in a df</span>
<span id="cb114-425"><a href="#cb114-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-426"><a href="#cb114-426" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Convert the df to a sf object by using the st_as_sf() function</span>
<span id="cb114-427"><a href="#cb114-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-428"><a href="#cb114-428" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Transform crs information to <span class="co">[</span><span class="ot">Singapore coordinates system</span><span class="co">](https://epsg.io/3414)</span> i.e 3414 by using st_transform() function</span>
<span id="cb114-429"><a href="#cb114-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-430"><a href="#cb114-430" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Write to a shapefile using st_write() function</span>
<span id="cb114-431"><a href="#cb114-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-432"><a href="#cb114-432" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb114-433"><a href="#cb114-433" aria-hidden="true" tabindex="-1"></a><span class="fu">## Childcare</span></span>
<span id="cb114-434"><a href="#cb114-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-435"><a href="#cb114-435" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb114-436"><a href="#cb114-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-437"><a href="#cb114-437" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: childcare</span></span>
<span id="cb114-438"><a href="#cb114-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-439"><a href="#cb114-439" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name  accordingly to the theme</span></span>
<span id="cb114-440"><a href="#cb114-440" aria-hidden="true" tabindex="-1"></a>childcare_tibble <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"childcare"</span>)</span>
<span id="cb114-441"><a href="#cb114-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-442"><a href="#cb114-442" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb114-443"><a href="#cb114-443" aria-hidden="true" tabindex="-1"></a>childcare_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(childcare_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb114-444"><a href="#cb114-444" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb114-445"><a href="#cb114-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-446"><a href="#cb114-446" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> childcare_sf,</span>
<span id="cb114-447"><a href="#cb114-447" aria-hidden="true" tabindex="-1"></a>         <span class="at">dsn =</span> <span class="st">"data/geospatial"</span>,</span>
<span id="cb114-448"><a href="#cb114-448" aria-hidden="true" tabindex="-1"></a>         <span class="at">layer =</span> <span class="st">"childcare"</span>,</span>
<span id="cb114-449"><a href="#cb114-449" aria-hidden="true" tabindex="-1"></a>         <span class="at">driver =</span> <span class="st">"ESRI Shapefile"</span>,</span>
<span id="cb114-450"><a href="#cb114-450" aria-hidden="true" tabindex="-1"></a>         <span class="at">append=</span><span class="cn">FALSE</span>)</span>
<span id="cb114-451"><a href="#cb114-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-452"><a href="#cb114-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-453"><a href="#cb114-453" aria-hidden="true" tabindex="-1"></a><span class="fu">## Eldercare</span></span>
<span id="cb114-454"><a href="#cb114-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-455"><a href="#cb114-455" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb114-456"><a href="#cb114-456" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-457"><a href="#cb114-457" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: eldercare</span></span>
<span id="cb114-458"><a href="#cb114-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-459"><a href="#cb114-459" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name based accordingly to the theme</span></span>
<span id="cb114-460"><a href="#cb114-460" aria-hidden="true" tabindex="-1"></a>eldercare_tibble <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"eldercare"</span>)</span>
<span id="cb114-461"><a href="#cb114-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-462"><a href="#cb114-462" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb114-463"><a href="#cb114-463" aria-hidden="true" tabindex="-1"></a>eldercare_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(eldercare_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb114-464"><a href="#cb114-464" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb114-465"><a href="#cb114-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-466"><a href="#cb114-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-467"><a href="#cb114-467" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(eldercare_sf, <span class="st">"data/rds/eldercare.rds"</span>)</span>
<span id="cb114-468"><a href="#cb114-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-469"><a href="#cb114-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-470"><a href="#cb114-470" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hawker Centres</span></span>
<span id="cb114-471"><a href="#cb114-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-472"><a href="#cb114-472" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb114-473"><a href="#cb114-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-474"><a href="#cb114-474" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: new hawker centres</span></span>
<span id="cb114-475"><a href="#cb114-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-476"><a href="#cb114-476" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name based accordingly to the theme</span></span>
<span id="cb114-477"><a href="#cb114-477" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_tibble &lt;- get_theme(token, "hawkercentre_new")</span></span>
<span id="cb114-478"><a href="#cb114-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-479"><a href="#cb114-479" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb114-480"><a href="#cb114-480" aria-hidden="true" tabindex="-1"></a>hawkercentre_new_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(hawkercentre_new_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb114-481"><a href="#cb114-481" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb114-482"><a href="#cb114-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-483"><a href="#cb114-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-484"><a href="#cb114-484" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(hawkercentre_new_sf, <span class="st">"data/rds/hawker_new.rds"</span>)</span>
<span id="cb114-485"><a href="#cb114-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-486"><a href="#cb114-486" aria-hidden="true" tabindex="-1"></a><span class="co">#issues writing in this manner</span></span>
<span id="cb114-487"><a href="#cb114-487" aria-hidden="true" tabindex="-1"></a><span class="co">#st_write(obj = hawkercentre_new_sf,</span></span>
<span id="cb114-488"><a href="#cb114-488" aria-hidden="true" tabindex="-1"></a><span class="co">#         dsn = "data/geospatial",</span></span>
<span id="cb114-489"><a href="#cb114-489" aria-hidden="true" tabindex="-1"></a><span class="co">#         layer = "hawkercentre_new",</span></span>
<span id="cb114-490"><a href="#cb114-490" aria-hidden="true" tabindex="-1"></a><span class="co">#        driver = "ESRI Shapefile",</span></span>
<span id="cb114-491"><a href="#cb114-491" aria-hidden="true" tabindex="-1"></a><span class="co">#         append=FALSE)</span></span>
<span id="cb114-492"><a href="#cb114-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-493"><a href="#cb114-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-494"><a href="#cb114-494" aria-hidden="true" tabindex="-1"></a><span class="fu">## Kindergartens</span></span>
<span id="cb114-495"><a href="#cb114-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-496"><a href="#cb114-496" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb114-497"><a href="#cb114-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-498"><a href="#cb114-498" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: kindergartens</span></span>
<span id="cb114-499"><a href="#cb114-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-500"><a href="#cb114-500" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name based accordingly to the theme</span></span>
<span id="cb114-501"><a href="#cb114-501" aria-hidden="true" tabindex="-1"></a>kindergartens_tibble <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"kindergartens"</span>)</span>
<span id="cb114-502"><a href="#cb114-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-503"><a href="#cb114-503" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb114-504"><a href="#cb114-504" aria-hidden="true" tabindex="-1"></a>kindergartens_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(kindergartens_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb114-505"><a href="#cb114-505" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb114-506"><a href="#cb114-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-507"><a href="#cb114-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-508"><a href="#cb114-508" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(kindergartens_sf, <span class="st">"data/rds/kindergartens.rds"</span>)</span>
<span id="cb114-509"><a href="#cb114-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-510"><a href="#cb114-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-511"><a href="#cb114-511" aria-hidden="true" tabindex="-1"></a><span class="fu">## Parks</span></span>
<span id="cb114-512"><a href="#cb114-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-513"><a href="#cb114-513" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb114-514"><a href="#cb114-514" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-515"><a href="#cb114-515" aria-hidden="true" tabindex="-1"></a><span class="co">#theme: parks</span></span>
<span id="cb114-516"><a href="#cb114-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-517"><a href="#cb114-517" aria-hidden="true" tabindex="-1"></a><span class="co">#retrieve the data such as the geometry and name based accordingly to the theme</span></span>
<span id="cb114-518"><a href="#cb114-518" aria-hidden="true" tabindex="-1"></a>nationalparks_tibble <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"nationalparks"</span>)</span>
<span id="cb114-519"><a href="#cb114-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-520"><a href="#cb114-520" aria-hidden="true" tabindex="-1"></a><span class="co"># to convert a data frame of coordinates to an sf object and transform the crs information and create a shapefile for it</span></span>
<span id="cb114-521"><a href="#cb114-521" aria-hidden="true" tabindex="-1"></a>nationalparks_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(nationalparks_tibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), </span>
<span id="cb114-522"><a href="#cb114-522" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb114-523"><a href="#cb114-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-524"><a href="#cb114-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-525"><a href="#cb114-525" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(nationalparks_sf, <span class="st">"data/rds/nationalparks.rds"</span>)</span>
<span id="cb114-526"><a href="#cb114-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-527"><a href="#cb114-527" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb114-528"><a href="#cb114-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-529"><a href="#cb114-529" aria-hidden="true" tabindex="-1"></a>Import the following to be used for our tasks later.</span>
<span id="cb114-530"><a href="#cb114-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-533"><a href="#cb114-533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-534"><a href="#cb114-534" aria-hidden="true" tabindex="-1"></a>childcare_sf <span class="ot">&lt;-</span><span class="fu">st_read</span>(<span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"childcare"</span>)</span>
<span id="cb114-535"><a href="#cb114-535" aria-hidden="true" tabindex="-1"></a>eldercare_sf<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/eldercare.rds"</span>)</span>
<span id="cb114-536"><a href="#cb114-536" aria-hidden="true" tabindex="-1"></a>hawkercentre_new_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/hawker_new.rds"</span>)</span>
<span id="cb114-537"><a href="#cb114-537" aria-hidden="true" tabindex="-1"></a>kindergartens_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/kindergartens.rds"</span>)</span>
<span id="cb114-538"><a href="#cb114-538" aria-hidden="true" tabindex="-1"></a>nationalparks_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/nationalparks.rds"</span>)</span>
<span id="cb114-539"><a href="#cb114-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-540"><a href="#cb114-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-541"><a href="#cb114-541" aria-hidden="true" tabindex="-1"></a><span class="fu">### CBD Area</span></span>
<span id="cb114-542"><a href="#cb114-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-543"><a href="#cb114-543" aria-hidden="true" tabindex="-1"></a>For this assignment, I consider the CBD area to be in the Downtown Core so I will be using the <span class="co">[</span><span class="ot">coordinates of Downtown Core</span><span class="co">](https://www.latlong.net/place/downtown-core-singapore-20616.html)</span> .</span>
<span id="cb114-544"><a href="#cb114-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-547"><a href="#cb114-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-548"><a href="#cb114-548" aria-hidden="true" tabindex="-1"></a>lat<span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.287953</span>)</span>
<span id="cb114-549"><a href="#cb114-549" aria-hidden="true" tabindex="-1"></a>lng<span class="ot">=</span> <span class="fu">c</span>(<span class="fl">103.851784</span>)</span>
<span id="cb114-550"><a href="#cb114-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-551"><a href="#cb114-551" aria-hidden="true" tabindex="-1"></a>cbd_sf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(lat, lng) <span class="sc">%&gt;%</span></span>
<span id="cb114-552"><a href="#cb114-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-553"><a href="#cb114-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb114-554"><a href="#cb114-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-555"><a href="#cb114-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-556"><a href="#cb114-556" aria-hidden="true" tabindex="-1"></a><span class="fu">### Supermarket</span></span>
<span id="cb114-557"><a href="#cb114-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-560"><a href="#cb114-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-561"><a href="#cb114-561" aria-hidden="true" tabindex="-1"></a>supermarket_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/supermarkets-geojson.geojson"</span>) </span>
<span id="cb114-562"><a href="#cb114-562" aria-hidden="true" tabindex="-1"></a>supermarket_sf <span class="ot">&lt;-</span> supermarket_sf <span class="sc">%&gt;%</span></span>
<span id="cb114-563"><a href="#cb114-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-564"><a href="#cb114-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-565"><a href="#cb114-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-566"><a href="#cb114-566" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bus Stop</span></span>
<span id="cb114-567"><a href="#cb114-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-570"><a href="#cb114-570" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-571"><a href="#cb114-571" aria-hidden="true" tabindex="-1"></a>bus_stop<span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"BusStop"</span>)</span>
<span id="cb114-572"><a href="#cb114-572" aria-hidden="true" tabindex="-1"></a>bus_stop_sf <span class="ot">&lt;-</span> bus_stop <span class="sc">%&gt;%</span></span>
<span id="cb114-573"><a href="#cb114-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-574"><a href="#cb114-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-575"><a href="#cb114-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-576"><a href="#cb114-576" aria-hidden="true" tabindex="-1"></a><span class="fu">### MRT/LRT</span></span>
<span id="cb114-577"><a href="#cb114-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-580"><a href="#cb114-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-581"><a href="#cb114-581" aria-hidden="true" tabindex="-1"></a>mrt <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/"</span>, <span class="at">layer =</span> <span class="st">"Train_Station_Exit_Layer"</span>)</span>
<span id="cb114-582"><a href="#cb114-582" aria-hidden="true" tabindex="-1"></a>mrt_sf <span class="ot">&lt;-</span> mrt <span class="sc">%&gt;%</span></span>
<span id="cb114-583"><a href="#cb114-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-584"><a href="#cb114-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-585"><a href="#cb114-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-586"><a href="#cb114-586" aria-hidden="true" tabindex="-1"></a><span class="fu">### Primary School</span></span>
<span id="cb114-587"><a href="#cb114-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-588"><a href="#cb114-588" aria-hidden="true" tabindex="-1"></a>While searching for a dataset for primary school locations, i've crossed upon this dataset from <span class="co">[</span><span class="ot">data.gov.sg</span><span class="co">](https://data.gov.sg/)</span> which has the general information of schools in Singapore. By filtering out <span class="in">`themainlevel_code`</span> which represents the different types of schools to be Primary, I will be able to extract out the address and postal codes of primary schools in Singapore.</span>
<span id="cb114-589"><a href="#cb114-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-592"><a href="#cb114-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-593"><a href="#cb114-593" aria-hidden="true" tabindex="-1"></a>primary_school <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/geospatial/general-information-of-schools.csv"</span>)</span>
<span id="cb114-594"><a href="#cb114-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-595"><a href="#cb114-595" aria-hidden="true" tabindex="-1"></a>primary_school <span class="ot">&lt;-</span> primary_school <span class="sc">%&gt;%</span></span>
<span id="cb114-596"><a href="#cb114-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mainlevel_code <span class="sc">==</span> <span class="st">"PRIMARY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-597"><a href="#cb114-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(school_name, address, postal_code)</span>
<span id="cb114-598"><a href="#cb114-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-599"><a href="#cb114-599" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(primary_school)</span>
<span id="cb114-600"><a href="#cb114-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-601"><a href="#cb114-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-602"><a href="#cb114-602" aria-hidden="true" tabindex="-1"></a>Based on the output, we can observe that there are 183 primary schools in Singapore. However, in 2022, the primary school, Juying Primary School was merged together with Pioneer Primary School and it cannot be found via the API . Thus, I decided to remove it out of our data.</span>
<span id="cb114-603"><a href="#cb114-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-606"><a href="#cb114-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-607"><a href="#cb114-607" aria-hidden="true" tabindex="-1"></a>primary_school<span class="ot">&lt;-</span>primary_school <span class="sc">%&gt;%</span>  </span>
<span id="cb114-608"><a href="#cb114-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school_name<span class="sc">!=</span><span class="st">'JUYING PRIMARY SCHOOL'</span>)</span>
<span id="cb114-609"><a href="#cb114-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-610"><a href="#cb114-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-611"><a href="#cb114-611" aria-hidden="true" tabindex="-1"></a>Once again, we can use geocode() function we created earlier to help us extract the geometry of each primary school by its school name.</span>
<span id="cb114-612"><a href="#cb114-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-615"><a href="#cb114-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-616"><a href="#cb114-616" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-617"><a href="#cb114-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-618"><a href="#cb114-618" aria-hidden="true" tabindex="-1"></a>primary_school<span class="sc">$</span>LATITUDE <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb114-619"><a href="#cb114-619" aria-hidden="true" tabindex="-1"></a>primary_school<span class="sc">$</span>LONGITUDE <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb114-620"><a href="#cb114-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-621"><a href="#cb114-621" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(primary_school)){</span>
<span id="cb114-622"><a href="#cb114-622" aria-hidden="true" tabindex="-1"></a>  temp_output <span class="ot">&lt;-</span> <span class="fu">geocode</span>(primary_school[i, <span class="dv">1</span>],<span class="st">""</span>)</span>
<span id="cb114-623"><a href="#cb114-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-624"><a href="#cb114-624" aria-hidden="true" tabindex="-1"></a>  primary_school<span class="sc">$</span>LATITUDE[i] <span class="ot">&lt;-</span> temp_output<span class="sc">$</span>results.LATITUDE</span>
<span id="cb114-625"><a href="#cb114-625" aria-hidden="true" tabindex="-1"></a>  primary_school<span class="sc">$</span>LONGITUDE[i] <span class="ot">&lt;-</span> temp_output<span class="sc">$</span>results.LONGITUDE</span>
<span id="cb114-626"><a href="#cb114-626" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-627"><a href="#cb114-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-628"><a href="#cb114-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-629"><a href="#cb114-629" aria-hidden="true" tabindex="-1"></a>To reuse the primary school data without recalling the API, I saved it in an rds file.</span>
<span id="cb114-630"><a href="#cb114-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-633"><a href="#cb114-633" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-634"><a href="#cb114-634" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-635"><a href="#cb114-635" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(primary_school, <span class="st">"data/rds/primary_school.rds"</span>)</span>
<span id="cb114-636"><a href="#cb114-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-637"><a href="#cb114-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-640"><a href="#cb114-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-641"><a href="#cb114-641" aria-hidden="true" tabindex="-1"></a>primary_school_rds<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/primary_school.rds"</span>)</span>
<span id="cb114-642"><a href="#cb114-642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-643"><a href="#cb114-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-644"><a href="#cb114-644" aria-hidden="true" tabindex="-1"></a>Next, we can convert our df into a sf.</span>
<span id="cb114-645"><a href="#cb114-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-648"><a href="#cb114-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-649"><a href="#cb114-649" aria-hidden="true" tabindex="-1"></a>primary_school_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(primary_school_rds,</span>
<span id="cb114-650"><a href="#cb114-650" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>, </span>
<span id="cb114-651"><a href="#cb114-651" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"LATITUDE"</span>),</span>
<span id="cb114-652"><a href="#cb114-652" aria-hidden="true" tabindex="-1"></a>                    <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-653"><a href="#cb114-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-654"><a href="#cb114-654" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-655"><a href="#cb114-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-656"><a href="#cb114-656" aria-hidden="true" tabindex="-1"></a>However, besides this, we need to determine what is a good primary school (which is necessary for 1 of our tasks). Based on the assumption that a good primary school is a popular one, I picked out the top 10 popular primary schools, referencing its popularity from this <span class="co">[</span><span class="ot">website</span><span class="co">](https://schoolbell.sg/primary-school-ranking/)</span>.</span>
<span id="cb114-657"><a href="#cb114-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-660"><a href="#cb114-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-661"><a href="#cb114-661" aria-hidden="true" tabindex="-1"></a>popular_primary_schools <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Pei Hwa Presbyterian Primary School"</span>,</span>
<span id="cb114-662"><a href="#cb114-662" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Gongshang Primary School"</span>,</span>
<span id="cb114-663"><a href="#cb114-663" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Riverside Primary School"</span>,</span>
<span id="cb114-664"><a href="#cb114-664" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Red Swastika School"</span>,</span>
<span id="cb114-665"><a href="#cb114-665" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Punggol Green Primary School"</span>,</span>
<span id="cb114-666"><a href="#cb114-666" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Princess Elizabeth Primary School"</span>,</span>
<span id="cb114-667"><a href="#cb114-667" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Westwood Primary School"</span>,</span>
<span id="cb114-668"><a href="#cb114-668" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"St. Hilda’s Primary School"</span>,</span>
<span id="cb114-669"><a href="#cb114-669" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Catholic High School (Primary Section)"</span>,</span>
<span id="cb114-670"><a href="#cb114-670" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Ai Tong School"</span>)</span>
<span id="cb114-671"><a href="#cb114-671" aria-hidden="true" tabindex="-1"></a>popular_primary_schools</span>
<span id="cb114-672"><a href="#cb114-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-673"><a href="#cb114-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-674"><a href="#cb114-674" aria-hidden="true" tabindex="-1"></a>Next, I need to check whether the top 10 most popular primary schools can be found in the primary school data i extracted earlier. But before that, to make things consistent, I used lapply() function and make the schools names I picked out from the website to be all in uppercase.</span>
<span id="cb114-675"><a href="#cb114-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-678"><a href="#cb114-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-679"><a href="#cb114-679" aria-hidden="true" tabindex="-1"></a><span class="co">#make school names all uppercase</span></span>
<span id="cb114-680"><a href="#cb114-680" aria-hidden="true" tabindex="-1"></a>popular_primary_schools <span class="ot">&lt;-</span> <span class="fu">lapply</span>(popular_primary_schools, toupper) </span>
<span id="cb114-681"><a href="#cb114-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-682"><a href="#cb114-682" aria-hidden="true" tabindex="-1"></a><span class="co"># to check both primary school datasets matches</span></span>
<span id="cb114-683"><a href="#cb114-683" aria-hidden="true" tabindex="-1"></a>popular_primary_schools_sf <span class="ot">&lt;-</span> primary_school_sf <span class="sc">%&gt;%</span></span>
<span id="cb114-684"><a href="#cb114-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school_name <span class="sc">%in%</span> popular_primary_schools)</span>
<span id="cb114-685"><a href="#cb114-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-686"><a href="#cb114-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-689"><a href="#cb114-689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-690"><a href="#cb114-690" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(popular_primary_schools_sf)</span>
<span id="cb114-691"><a href="#cb114-691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-692"><a href="#cb114-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-693"><a href="#cb114-693" aria-hidden="true" tabindex="-1"></a>Based on the output above, out of the 10 primary schools, only 8 can be found. The code chunk below tells us which primary schools are missing.</span>
<span id="cb114-694"><a href="#cb114-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-697"><a href="#cb114-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-698"><a href="#cb114-698" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(popular_primary_schools[<span class="sc">!</span>(popular_primary_schools <span class="sc">%in%</span> popular_primary_schools_sf<span class="sc">$</span>school_name)])</span>
<span id="cb114-699"><a href="#cb114-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-700"><a href="#cb114-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-701"><a href="#cb114-701" aria-hidden="true" tabindex="-1"></a>Looking further into our dataset, I found out that in the original primary school dataset, the schools names of the output above is written different. For eg, CANOSSA CATHOLIC PRIMARY SCHOOL is the same as CATHOLIC HIGH SCHOOL (PRIMARY SECTION). Thus, I decided to use rbind() function to manually add both records to popular_primary_schools_sf.</span>
<span id="cb114-702"><a href="#cb114-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-705"><a href="#cb114-705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-706"><a href="#cb114-706" aria-hidden="true" tabindex="-1"></a>popular_primary_schools_sf <span class="ot">&lt;-</span> popular_primary_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb114-707"><a href="#cb114-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(primary_school_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(school_name <span class="sc">==</span> <span class="st">"CANOSSA CATHOLIC PRIMARY SCHOOL"</span>))</span>
<span id="cb114-708"><a href="#cb114-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-709"><a href="#cb114-709" aria-hidden="true" tabindex="-1"></a>popular_primary_schools_sf <span class="ot">&lt;-</span> popular_primary_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb114-710"><a href="#cb114-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(primary_school_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(school_name <span class="sc">==</span> <span class="st">"ST. HILDA'S PRIMARY SCHOOL"</span>))</span>
<span id="cb114-711"><a href="#cb114-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-712"><a href="#cb114-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-715"><a href="#cb114-715" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-716"><a href="#cb114-716" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(popular_primary_schools_sf)</span>
<span id="cb114-717"><a href="#cb114-717" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-718"><a href="#cb114-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-719"><a href="#cb114-719" aria-hidden="true" tabindex="-1"></a><span class="fu">### Shopping Mall</span></span>
<span id="cb114-720"><a href="#cb114-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-721"><a href="#cb114-721" aria-hidden="true" tabindex="-1"></a>For shopping malls, I used the dataset extracted by <span class="co">[</span><span class="ot">Valery Lim</span><span class="co">](https://github.com/ValaryLim/Mall-Coordinates-Web-Scraper)</span> who webscrapped the shopping malls data from its <span class="co">[</span><span class="ot">wikipedia</span><span class="co">](https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore)</span> in 2019.</span>
<span id="cb114-722"><a href="#cb114-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-725"><a href="#cb114-725" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-726"><a href="#cb114-726" aria-hidden="true" tabindex="-1"></a>shopping_mall <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/geospatial/mall_coordinates_updated.csv"</span>)</span>
<span id="cb114-727"><a href="#cb114-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-728"><a href="#cb114-728" aria-hidden="true" tabindex="-1"></a>shopping_mall <span class="ot">&lt;-</span> shopping_mall <span class="sc">%&gt;%</span></span>
<span id="cb114-729"><a href="#cb114-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, latitude, longitude)</span>
<span id="cb114-730"><a href="#cb114-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-731"><a href="#cb114-731" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(shopping_mall)</span>
<span id="cb114-732"><a href="#cb114-732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-733"><a href="#cb114-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-734"><a href="#cb114-734" aria-hidden="true" tabindex="-1"></a>Taking a glimpse in our data, there is a total of 184 shopping malls in 2019.</span>
<span id="cb114-735"><a href="#cb114-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-736"><a href="#cb114-736" aria-hidden="true" tabindex="-1"></a>Next, the code chunk below transforms our data with the correct Singapore coordinates system.</span>
<span id="cb114-737"><a href="#cb114-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-740"><a href="#cb114-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-741"><a href="#cb114-741" aria-hidden="true" tabindex="-1"></a>shopping_mall_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(shopping_mall,</span>
<span id="cb114-742"><a href="#cb114-742" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,</span>
<span id="cb114-743"><a href="#cb114-743" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"latitude"</span>),</span>
<span id="cb114-744"><a href="#cb114-744" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-745"><a href="#cb114-745" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb114-746"><a href="#cb114-746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-747"><a href="#cb114-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-748"><a href="#cb114-748" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data-Pre Processing</span></span>
<span id="cb114-749"><a href="#cb114-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-750"><a href="#cb114-750" aria-hidden="true" tabindex="-1"></a>Same as before, we will conduct the following steps for data preprocessing, with an additional step of removing irrelevant columns for certain datasets:</span>
<span id="cb114-751"><a href="#cb114-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-752"><a href="#cb114-752" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>removing irrelevant columns</span>
<span id="cb114-753"><a href="#cb114-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-754"><a href="#cb114-754" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>check for missing values</span>
<span id="cb114-755"><a href="#cb114-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-756"><a href="#cb114-756" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>check correct coordinates system</span>
<span id="cb114-757"><a href="#cb114-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-758"><a href="#cb114-758" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>check for invalid geometries</span>
<span id="cb114-759"><a href="#cb114-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-760"><a href="#cb114-760" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Remove Irrelevant Columns</span></span>
<span id="cb114-761"><a href="#cb114-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-762"><a href="#cb114-762" aria-hidden="true" tabindex="-1"></a>So for our datasets, we only need to know the name and the geometry so in the following code chunks i will be removing/dropping irrelevant columns.</span>
<span id="cb114-763"><a href="#cb114-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-766"><a href="#cb114-766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-767"><a href="#cb114-767" aria-hidden="true" tabindex="-1"></a><span class="co">#mpsz</span></span>
<span id="cb114-768"><a href="#cb114-768" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"Name"</span>)</span>
<span id="cb114-769"><a href="#cb114-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-770"><a href="#cb114-770" aria-hidden="true" tabindex="-1"></a><span class="co">#childcare_sf</span></span>
<span id="cb114-771"><a href="#cb114-771" aria-hidden="true" tabindex="-1"></a><span class="co">#combine name and address postal to make it unique, some childcare have same name but diff locations</span></span>
<span id="cb114-772"><a href="#cb114-772" aria-hidden="true" tabindex="-1"></a>childcare_sf<span class="sc">$</span>full_address <span class="ot">&lt;-</span> <span class="fu">paste</span>(childcare_sf<span class="sc">$</span>NAME, childcare_sf<span class="sc">$</span>ADDRESSP)</span>
<span id="cb114-773"><a href="#cb114-773" aria-hidden="true" tabindex="-1"></a>childcare_sf <span class="ot">&lt;-</span> childcare_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"full_address"</span>)</span>
<span id="cb114-774"><a href="#cb114-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-775"><a href="#cb114-775" aria-hidden="true" tabindex="-1"></a><span class="co">#eldercare_sf</span></span>
<span id="cb114-776"><a href="#cb114-776" aria-hidden="true" tabindex="-1"></a>eldercare_sf<span class="sc">$</span>full_address <span class="ot">&lt;-</span> <span class="fu">paste</span>(eldercare_sf<span class="sc">$</span>NAME, eldercare_sf<span class="sc">$</span>ADDRESSPOSTALCODE)</span>
<span id="cb114-777"><a href="#cb114-777" aria-hidden="true" tabindex="-1"></a>eldercare_sf <span class="ot">&lt;-</span> eldercare_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"full_address"</span>)</span>
<span id="cb114-778"><a href="#cb114-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-779"><a href="#cb114-779" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_sf</span></span>
<span id="cb114-780"><a href="#cb114-780" aria-hidden="true" tabindex="-1"></a>hawkercentre_new_sf <span class="ot">&lt;-</span> hawkercentre_new_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"NAME"</span>)</span>
<span id="cb114-781"><a href="#cb114-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-782"><a href="#cb114-782" aria-hidden="true" tabindex="-1"></a><span class="co">#kindergartens_sf</span></span>
<span id="cb114-783"><a href="#cb114-783" aria-hidden="true" tabindex="-1"></a>kindergartens_sf <span class="ot">&lt;-</span> kindergartens_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"NAME"</span>)</span>
<span id="cb114-784"><a href="#cb114-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-785"><a href="#cb114-785" aria-hidden="true" tabindex="-1"></a><span class="co">#nationalparks_sf</span></span>
<span id="cb114-786"><a href="#cb114-786" aria-hidden="true" tabindex="-1"></a>nationalparks_sf <span class="ot">&lt;-</span> nationalparks_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"NAME"</span>)</span>
<span id="cb114-787"><a href="#cb114-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-788"><a href="#cb114-788" aria-hidden="true" tabindex="-1"></a><span class="co">#supermarket</span></span>
<span id="cb114-789"><a href="#cb114-789" aria-hidden="true" tabindex="-1"></a>supermarket_sf <span class="ot">&lt;-</span> supermarket_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"Description"</span>)</span>
<span id="cb114-790"><a href="#cb114-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-791"><a href="#cb114-791" aria-hidden="true" tabindex="-1"></a><span class="co">#bus stop</span></span>
<span id="cb114-792"><a href="#cb114-792" aria-hidden="true" tabindex="-1"></a>bus_stop_sf<span class="sc">$</span>stop_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(bus_stop_sf<span class="sc">$</span>BUS_STOP_N, bus_stop_sf<span class="sc">$</span>BUS_ROOF_N, bus_stop_sf<span class="sc">$</span>LOC_DESC)</span>
<span id="cb114-793"><a href="#cb114-793" aria-hidden="true" tabindex="-1"></a>bus_stop_sf <span class="ot">&lt;-</span> bus_stop_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"stop_name"</span>)</span>
<span id="cb114-794"><a href="#cb114-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-795"><a href="#cb114-795" aria-hidden="true" tabindex="-1"></a><span class="co">#mrt</span></span>
<span id="cb114-796"><a href="#cb114-796" aria-hidden="true" tabindex="-1"></a><span class="co">#combine stn name and exit to make each row unique</span></span>
<span id="cb114-797"><a href="#cb114-797" aria-hidden="true" tabindex="-1"></a>mrt_sf<span class="sc">$</span>stn <span class="ot">&lt;-</span> <span class="fu">paste</span>(mrt_sf<span class="sc">$</span>stn_name, mrt_sf<span class="sc">$</span>exit_code)</span>
<span id="cb114-798"><a href="#cb114-798" aria-hidden="true" tabindex="-1"></a>mrt_sf <span class="ot">&lt;-</span> mrt_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"stn"</span>)</span>
<span id="cb114-799"><a href="#cb114-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-800"><a href="#cb114-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-801"><a href="#cb114-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-802"><a href="#cb114-802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-803"><a href="#cb114-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-804"><a href="#cb114-804" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check for Missing Values</span></span>
<span id="cb114-805"><a href="#cb114-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-808"><a href="#cb114-808" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-809"><a href="#cb114-809" aria-hidden="true" tabindex="-1"></a><span class="co">#mpsz</span></span>
<span id="cb114-810"><a href="#cb114-810" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(mpsz))</span>
<span id="cb114-811"><a href="#cb114-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-812"><a href="#cb114-812" aria-hidden="true" tabindex="-1"></a><span class="co">#childcare_sf</span></span>
<span id="cb114-813"><a href="#cb114-813" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(childcare_sf))</span>
<span id="cb114-814"><a href="#cb114-814" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span></span>
<span id="cb114-815"><a href="#cb114-815" aria-hidden="true" tabindex="-1"></a><span class="co">#eldercare_sf</span></span>
<span id="cb114-816"><a href="#cb114-816" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(eldercare_sf))</span>
<span id="cb114-817"><a href="#cb114-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-818"><a href="#cb114-818" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_sf</span></span>
<span id="cb114-819"><a href="#cb114-819" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(hawkercentre_new_sf))</span>
<span id="cb114-820"><a href="#cb114-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-821"><a href="#cb114-821" aria-hidden="true" tabindex="-1"></a><span class="co">#kindergartens_sf</span></span>
<span id="cb114-822"><a href="#cb114-822" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(kindergartens_sf))</span>
<span id="cb114-823"><a href="#cb114-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-824"><a href="#cb114-824" aria-hidden="true" tabindex="-1"></a><span class="co">#nationalparks_sf</span></span>
<span id="cb114-825"><a href="#cb114-825" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(nationalparks_sf))</span>
<span id="cb114-826"><a href="#cb114-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-827"><a href="#cb114-827" aria-hidden="true" tabindex="-1"></a><span class="co">#supermarket_sf</span></span>
<span id="cb114-828"><a href="#cb114-828" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(supermarket_sf))</span>
<span id="cb114-829"><a href="#cb114-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-830"><a href="#cb114-830" aria-hidden="true" tabindex="-1"></a><span class="co">#bus stop</span></span>
<span id="cb114-831"><a href="#cb114-831" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(bus_stop_sf))</span>
<span id="cb114-832"><a href="#cb114-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-833"><a href="#cb114-833" aria-hidden="true" tabindex="-1"></a><span class="co">#MRT</span></span>
<span id="cb114-834"><a href="#cb114-834" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(mrt_sf))</span>
<span id="cb114-835"><a href="#cb114-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-836"><a href="#cb114-836" aria-hidden="true" tabindex="-1"></a><span class="co">#shopping_mall_sf</span></span>
<span id="cb114-837"><a href="#cb114-837" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(shopping_mall_sf))</span>
<span id="cb114-838"><a href="#cb114-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-839"><a href="#cb114-839" aria-hidden="true" tabindex="-1"></a><span class="co">#primary_school_sf</span></span>
<span id="cb114-840"><a href="#cb114-840" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(primary_school_sf))</span>
<span id="cb114-841"><a href="#cb114-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-842"><a href="#cb114-842" aria-hidden="true" tabindex="-1"></a><span class="co">#popular_primary_schools_sf</span></span>
<span id="cb114-843"><a href="#cb114-843" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(popular_primary_schools_sf))</span>
<span id="cb114-844"><a href="#cb114-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-845"><a href="#cb114-845" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-846"><a href="#cb114-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-847"><a href="#cb114-847" aria-hidden="true" tabindex="-1"></a>Based on the output, there is no missing values.</span>
<span id="cb114-848"><a href="#cb114-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-849"><a href="#cb114-849" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check for Correct Coordinates System</span></span>
<span id="cb114-850"><a href="#cb114-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-853"><a href="#cb114-853" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-854"><a href="#cb114-854" aria-hidden="true" tabindex="-1"></a><span class="co">#mpsz</span></span>
<span id="cb114-855"><a href="#cb114-855" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mpsz)</span>
<span id="cb114-856"><a href="#cb114-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-857"><a href="#cb114-857" aria-hidden="true" tabindex="-1"></a><span class="co">#childcare_sf</span></span>
<span id="cb114-858"><a href="#cb114-858" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(childcare_sf)</span>
<span id="cb114-859"><a href="#cb114-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-860"><a href="#cb114-860" aria-hidden="true" tabindex="-1"></a><span class="co">#eldercare_sf</span></span>
<span id="cb114-861"><a href="#cb114-861" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(eldercare_sf)</span>
<span id="cb114-862"><a href="#cb114-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-863"><a href="#cb114-863" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_sf</span></span>
<span id="cb114-864"><a href="#cb114-864" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(hawkercentre_new_sf)</span>
<span id="cb114-865"><a href="#cb114-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-866"><a href="#cb114-866" aria-hidden="true" tabindex="-1"></a><span class="co">#kindergartens_sf</span></span>
<span id="cb114-867"><a href="#cb114-867" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(kindergartens_sf)</span>
<span id="cb114-868"><a href="#cb114-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-869"><a href="#cb114-869" aria-hidden="true" tabindex="-1"></a><span class="co">#nationalparks_sf</span></span>
<span id="cb114-870"><a href="#cb114-870" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(nationalparks_sf)</span>
<span id="cb114-871"><a href="#cb114-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-872"><a href="#cb114-872" aria-hidden="true" tabindex="-1"></a><span class="co">#supermarket_sf</span></span>
<span id="cb114-873"><a href="#cb114-873" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(supermarket_sf)</span>
<span id="cb114-874"><a href="#cb114-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-875"><a href="#cb114-875" aria-hidden="true" tabindex="-1"></a><span class="co">#bus_stop_sf</span></span>
<span id="cb114-876"><a href="#cb114-876" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(bus_stop_sf)</span>
<span id="cb114-877"><a href="#cb114-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-878"><a href="#cb114-878" aria-hidden="true" tabindex="-1"></a><span class="co">#mrt_sf</span></span>
<span id="cb114-879"><a href="#cb114-879" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mrt_sf)</span>
<span id="cb114-880"><a href="#cb114-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-881"><a href="#cb114-881" aria-hidden="true" tabindex="-1"></a><span class="co">#shopping_mall_sf</span></span>
<span id="cb114-882"><a href="#cb114-882" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(shopping_mall_sf)</span>
<span id="cb114-883"><a href="#cb114-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-884"><a href="#cb114-884" aria-hidden="true" tabindex="-1"></a><span class="co">#primary_school_sf</span></span>
<span id="cb114-885"><a href="#cb114-885" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(primary_school_sf)</span>
<span id="cb114-886"><a href="#cb114-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-887"><a href="#cb114-887" aria-hidden="true" tabindex="-1"></a><span class="co">#popular_primary_schools_sf</span></span>
<span id="cb114-888"><a href="#cb114-888" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(popular_primary_schools_sf)</span>
<span id="cb114-889"><a href="#cb114-889" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-890"><a href="#cb114-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-891"><a href="#cb114-891" aria-hidden="true" tabindex="-1"></a>Based on the output, our datasets are in the correct coordinate systems.</span>
<span id="cb114-892"><a href="#cb114-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-893"><a href="#cb114-893" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check for Invalid Geometries</span></span>
<span id="cb114-894"><a href="#cb114-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-897"><a href="#cb114-897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-898"><a href="#cb114-898" aria-hidden="true" tabindex="-1"></a><span class="co">#mpsz</span></span>
<span id="cb114-899"><a href="#cb114-899" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-900"><a href="#cb114-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-901"><a href="#cb114-901" aria-hidden="true" tabindex="-1"></a><span class="co">#childcare_sf</span></span>
<span id="cb114-902"><a href="#cb114-902" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(childcare_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-903"><a href="#cb114-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-904"><a href="#cb114-904" aria-hidden="true" tabindex="-1"></a><span class="co">#eldercare_sf</span></span>
<span id="cb114-905"><a href="#cb114-905" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(eldercare_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-906"><a href="#cb114-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-907"><a href="#cb114-907" aria-hidden="true" tabindex="-1"></a><span class="co">#kindergartens_sf</span></span>
<span id="cb114-908"><a href="#cb114-908" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(kindergartens_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-909"><a href="#cb114-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-910"><a href="#cb114-910" aria-hidden="true" tabindex="-1"></a><span class="co">#hawkercentre_new_sf</span></span>
<span id="cb114-911"><a href="#cb114-911" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(hawkercentre_new_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-912"><a href="#cb114-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-913"><a href="#cb114-913" aria-hidden="true" tabindex="-1"></a><span class="co">#nationalparks_sf</span></span>
<span id="cb114-914"><a href="#cb114-914" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(nationalparks_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-915"><a href="#cb114-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-916"><a href="#cb114-916" aria-hidden="true" tabindex="-1"></a><span class="co">#supermarket_sf</span></span>
<span id="cb114-917"><a href="#cb114-917" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(supermarket_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-918"><a href="#cb114-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-919"><a href="#cb114-919" aria-hidden="true" tabindex="-1"></a><span class="co">#bus_stop_sf</span></span>
<span id="cb114-920"><a href="#cb114-920" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(bus_stop_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-921"><a href="#cb114-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-922"><a href="#cb114-922" aria-hidden="true" tabindex="-1"></a><span class="co">#mrt_sf</span></span>
<span id="cb114-923"><a href="#cb114-923" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mrt_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-924"><a href="#cb114-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-925"><a href="#cb114-925" aria-hidden="true" tabindex="-1"></a><span class="co">#shopping_mall_sf</span></span>
<span id="cb114-926"><a href="#cb114-926" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(shopping_mall_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-927"><a href="#cb114-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-928"><a href="#cb114-928" aria-hidden="true" tabindex="-1"></a><span class="co">#primary_school_sf</span></span>
<span id="cb114-929"><a href="#cb114-929" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(primary_school_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-930"><a href="#cb114-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-931"><a href="#cb114-931" aria-hidden="true" tabindex="-1"></a><span class="co">#popular_primary_schools_sf</span></span>
<span id="cb114-932"><a href="#cb114-932" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(popular_primary_schools_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-933"><a href="#cb114-933" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-934"><a href="#cb114-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-935"><a href="#cb114-935" aria-hidden="true" tabindex="-1"></a>Based on the output, we can see that only the mpsz dataset has invalid geometries. The code chunk beow addresses this issue.</span>
<span id="cb114-936"><a href="#cb114-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-939"><a href="#cb114-939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-940"><a href="#cb114-940" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(mpsz)</span>
<span id="cb114-941"><a href="#cb114-941" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>))</span>
<span id="cb114-942"><a href="#cb114-942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-943"><a href="#cb114-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-944"><a href="#cb114-944" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Visualisations</span></span>
<span id="cb114-945"><a href="#cb114-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-946"><a href="#cb114-946" aria-hidden="true" tabindex="-1"></a>The following code chunks shows some visualisations for the data we have just preprocessed.</span>
<span id="cb114-947"><a href="#cb114-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-948"><a href="#cb114-948" aria-hidden="true" tabindex="-1"></a><span class="fu">##### **Subzone Boundary of Singapore 2014**</span></span>
<span id="cb114-949"><a href="#cb114-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-952"><a href="#cb114-952" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-953"><a href="#cb114-953" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(mpsz))</span>
<span id="cb114-954"><a href="#cb114-954" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-955"><a href="#cb114-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-956"><a href="#cb114-956" aria-hidden="true" tabindex="-1"></a><span class="fu">##### **MRT/LRT Stations Map**</span></span>
<span id="cb114-957"><a href="#cb114-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-960"><a href="#cb114-960" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-961"><a href="#cb114-961" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb114-962"><a href="#cb114-962" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mrt_sf) <span class="sc">+</span></span>
<span id="cb114-963"><a href="#cb114-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="fl">0.05</span>)</span>
<span id="cb114-964"><a href="#cb114-964" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-965"><a href="#cb114-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-966"><a href="#cb114-966" aria-hidden="true" tabindex="-1"></a><span class="fu">##### **Bus Map**</span></span>
<span id="cb114-967"><a href="#cb114-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-970"><a href="#cb114-970" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-971"><a href="#cb114-971" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb114-972"><a href="#cb114-972" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb114-973"><a href="#cb114-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb114-974"><a href="#cb114-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb114-975"><a href="#cb114-975" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(bus_stop_sf) <span class="sc">+</span></span>
<span id="cb114-976"><a href="#cb114-976" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-977"><a href="#cb114-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Bus Stops"</span>,</span>
<span id="cb114-978"><a href="#cb114-978" aria-hidden="true" tabindex="-1"></a>          <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb114-979"><a href="#cb114-979" aria-hidden="true" tabindex="-1"></a>          <span class="at">main.title.size =</span> <span class="fl">1.2</span>,</span>
<span id="cb114-980"><a href="#cb114-980" aria-hidden="true" tabindex="-1"></a>          <span class="at">frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb114-981"><a href="#cb114-981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-982"><a href="#cb114-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-983"><a href="#cb114-983" aria-hidden="true" tabindex="-1"></a><span class="fu">##### **Education/Healthcare related map**</span></span>
<span id="cb114-984"><a href="#cb114-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-985"><a href="#cb114-985" aria-hidden="true" tabindex="-1"></a>The code chunk below shows the location of:</span>
<span id="cb114-986"><a href="#cb114-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-987"><a href="#cb114-987" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>childcare centres - blue dots</span>
<span id="cb114-988"><a href="#cb114-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-989"><a href="#cb114-989" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>eldercare centres - red dots</span>
<span id="cb114-990"><a href="#cb114-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-991"><a href="#cb114-991" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>kindergartens - orange dots</span>
<span id="cb114-992"><a href="#cb114-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-993"><a href="#cb114-993" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>primary schools - black dots</span>
<span id="cb114-994"><a href="#cb114-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-995"><a href="#cb114-995" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>top 10 popular primary schools - grey dots</span>
<span id="cb114-996"><a href="#cb114-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-999"><a href="#cb114-999" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1000"><a href="#cb114-1000" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb114-1001"><a href="#cb114-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(childcare_sf) <span class="sc">+</span></span>
<span id="cb114-1002"><a href="#cb114-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="co">#affects transparency of points</span></span>
<span id="cb114-1003"><a href="#cb114-1003" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#2ec4b6"</span>,</span>
<span id="cb114-1004"><a href="#cb114-1004" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1005"><a href="#cb114-1005" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(eldercare_sf) <span class="sc">+</span></span>
<span id="cb114-1006"><a href="#cb114-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb114-1007"><a href="#cb114-1007" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#e71d36"</span>,</span>
<span id="cb114-1008"><a href="#cb114-1008" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1009"><a href="#cb114-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(kindergartens_sf) <span class="sc">+</span></span>
<span id="cb114-1010"><a href="#cb114-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb114-1011"><a href="#cb114-1011" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#ff9f1c"</span>,</span>
<span id="cb114-1012"><a href="#cb114-1012" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1013"><a href="#cb114-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(primary_school_sf) <span class="sc">+</span></span>
<span id="cb114-1014"><a href="#cb114-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb114-1015"><a href="#cb114-1015" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#011627"</span>,</span>
<span id="cb114-1016"><a href="#cb114-1016" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1017"><a href="#cb114-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(popular_primary_schools_sf) <span class="sc">+</span></span>
<span id="cb114-1018"><a href="#cb114-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb114-1019"><a href="#cb114-1019" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">"grey"</span>,</span>
<span id="cb114-1020"><a href="#cb114-1020" aria-hidden="true" tabindex="-1"></a>        <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1021"><a href="#cb114-1021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">14</span>))</span>
<span id="cb114-1022"><a href="#cb114-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1023"><a href="#cb114-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1024"><a href="#cb114-1024" aria-hidden="true" tabindex="-1"></a>One thing we can observe is that there are more childcare centres as compared to the rest.</span>
<span id="cb114-1025"><a href="#cb114-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1026"><a href="#cb114-1026" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Amenities Related Map</span></span>
<span id="cb114-1027"><a href="#cb114-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1028"><a href="#cb114-1028" aria-hidden="true" tabindex="-1"></a>The code chunk below shows the location of:</span>
<span id="cb114-1029"><a href="#cb114-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1030"><a href="#cb114-1030" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>supermarkets - red dots</span>
<span id="cb114-1031"><a href="#cb114-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1032"><a href="#cb114-1032" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>shopping malls - orange dots</span>
<span id="cb114-1033"><a href="#cb114-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1034"><a href="#cb114-1034" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>national parks - dark green dots</span>
<span id="cb114-1035"><a href="#cb114-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1036"><a href="#cb114-1036" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>hawker centres - blue dots</span>
<span id="cb114-1037"><a href="#cb114-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1040"><a href="#cb114-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1041"><a href="#cb114-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb114-1042"><a href="#cb114-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(supermarket_sf) <span class="sc">+</span></span>
<span id="cb114-1043"><a href="#cb114-1043" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="co">#affects transparency of points</span></span>
<span id="cb114-1044"><a href="#cb114-1044" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#d62828"</span>,</span>
<span id="cb114-1045"><a href="#cb114-1045" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1046"><a href="#cb114-1046" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(shopping_mall_sf) <span class="sc">+</span></span>
<span id="cb114-1047"><a href="#cb114-1047" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb114-1048"><a href="#cb114-1048" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#f77f00"</span>,</span>
<span id="cb114-1049"><a href="#cb114-1049" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1050"><a href="#cb114-1050" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(supermarket_sf) <span class="sc">+</span></span>
<span id="cb114-1051"><a href="#cb114-1051" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb114-1052"><a href="#cb114-1052" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#fcbf49"</span>,</span>
<span id="cb114-1053"><a href="#cb114-1053" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1054"><a href="#cb114-1054" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(nationalparks_sf) <span class="sc">+</span></span>
<span id="cb114-1055"><a href="#cb114-1055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb114-1056"><a href="#cb114-1056" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#023020"</span>,</span>
<span id="cb114-1057"><a href="#cb114-1057" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1058"><a href="#cb114-1058" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hawkercentre_new_sf) <span class="sc">+</span></span>
<span id="cb114-1059"><a href="#cb114-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb114-1060"><a href="#cb114-1060" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span><span class="st">"#ADD8E6"</span>,</span>
<span id="cb114-1061"><a href="#cb114-1061" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb114-1062"><a href="#cb114-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">14</span>))</span>
<span id="cb114-1063"><a href="#cb114-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1064"><a href="#cb114-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1065"><a href="#cb114-1065" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Resale Flat Prices</span></span>
<span id="cb114-1066"><a href="#cb114-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1069"><a href="#cb114-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1070"><a href="#cb114-1070" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb114-1071"><a href="#cb114-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb114-1072"><a href="#cb114-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(resale_sf) <span class="sc">+</span>  </span>
<span id="cb114-1073"><a href="#cb114-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"resale_price"</span>,</span>
<span id="cb114-1074"><a href="#cb114-1074" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb114-1075"><a href="#cb114-1075" aria-hidden="true" tabindex="-1"></a>          <span class="at">style=</span><span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb114-1076"><a href="#cb114-1076" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sets minimum zoom level to 11, sets maximum zoom level to 14</span></span>
<span id="cb114-1077"><a href="#cb114-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">14</span>))</span>
<span id="cb114-1078"><a href="#cb114-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1079"><a href="#cb114-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1080"><a href="#cb114-1080" aria-hidden="true" tabindex="-1"></a>We can observe that from July 2022 to December 2022, the are majority of the 5 room HDB flats can be found in the east side of Singapore and the higher priced flats tend to be in the southern-eastern side of Singapore.</span>
<span id="cb114-1081"><a href="#cb114-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1084"><a href="#cb114-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1085"><a href="#cb114-1085" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb114-1086"><a href="#cb114-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1087"><a href="#cb114-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1088"><a href="#cb114-1088" aria-hidden="true" tabindex="-1"></a><span class="fu">## Formulated Functions</span></span>
<span id="cb114-1089"><a href="#cb114-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1090"><a href="#cb114-1090" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proximity Distance Calculations</span></span>
<span id="cb114-1091"><a href="#cb114-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1092"><a href="#cb114-1092" aria-hidden="true" tabindex="-1"></a>As per our task , we need to find the proximity of certain facilities i.e proximity to CBD, eldercare, hawker centres, MRT, park, good primary school, shopping mall and supermarket. It can be computed by creating a function called proximity which utilises st_distance() to find the closest facility (shortest distance) with the rowMins() function of our matrixStats package. The values will then be appended to the resale_sf as a new column.</span>
<span id="cb114-1093"><a href="#cb114-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1096"><a href="#cb114-1096" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1097"><a href="#cb114-1097" aria-hidden="true" tabindex="-1"></a>proximity <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, varname) {</span>
<span id="cb114-1098"><a href="#cb114-1098" aria-hidden="true" tabindex="-1"></a>  dist_matrix <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(df1, df2) <span class="sc">%&gt;%</span></span>
<span id="cb114-1099"><a href="#cb114-1099" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_units</span>()</span>
<span id="cb114-1100"><a href="#cb114-1100" aria-hidden="true" tabindex="-1"></a>  df1[,varname] <span class="ot">&lt;-</span> <span class="fu">rowMins</span>(dist_matrix)</span>
<span id="cb114-1101"><a href="#cb114-1101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df1)</span>
<span id="cb114-1102"><a href="#cb114-1102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-1103"><a href="#cb114-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1104"><a href="#cb114-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1107"><a href="#cb114-1107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1108"><a href="#cb114-1108" aria-hidden="true" tabindex="-1"></a>resale_sf<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/resale_sf.rds"</span>)</span>
<span id="cb114-1109"><a href="#cb114-1109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1110"><a href="#cb114-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1113"><a href="#cb114-1113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1114"><a href="#cb114-1114" aria-hidden="true" tabindex="-1"></a><span class="co">#CBD, eldercare, hawker centres, MRT, park, good primary school, shopping mall and supermarket.</span></span>
<span id="cb114-1115"><a href="#cb114-1115" aria-hidden="true" tabindex="-1"></a>resale_sf <span class="ot">&lt;-</span> </span>
<span id="cb114-1116"><a href="#cb114-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(resale_sf, cbd_sf, <span class="st">"PROX_CBD"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1117"><a href="#cb114-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., eldercare_sf, <span class="st">"PROX_ELDERCARE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1118"><a href="#cb114-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., hawkercentre_new_sf, <span class="st">"PROX_HAWKER"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1119"><a href="#cb114-1119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., mrt_sf, <span class="st">"PROX_MRT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1120"><a href="#cb114-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., nationalparks_sf, <span class="st">"PROX_PARK"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1121"><a href="#cb114-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., popular_primary_schools_sf, <span class="st">"PROX_GDPRISCH"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1122"><a href="#cb114-1122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., shopping_mall_sf, <span class="st">"PROX_SHOPPINGMALL"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1123"><a href="#cb114-1123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., supermarket_sf, <span class="st">"PROX_SPRMKT"</span>)</span>
<span id="cb114-1124"><a href="#cb114-1124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1125"><a href="#cb114-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1126"><a href="#cb114-1126" aria-hidden="true" tabindex="-1"></a><span class="fu">### Facility Count within Radius Calculations</span></span>
<span id="cb114-1127"><a href="#cb114-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1128"><a href="#cb114-1128" aria-hidden="true" tabindex="-1"></a>As per our task, we also want to find the number of facilities within a particular radius. Thus, we have to create another function called num_radius() which utilise st_distance() to compute the distance between the flats and the desiredfacilities, and then sum up the observations with rowSums(). The values will be appended to the data frame as a new column.</span>
<span id="cb114-1129"><a href="#cb114-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1132"><a href="#cb114-1132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1133"><a href="#cb114-1133" aria-hidden="true" tabindex="-1"></a>num_radius <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, varname, radius) {</span>
<span id="cb114-1134"><a href="#cb114-1134" aria-hidden="true" tabindex="-1"></a>  dist_matrix <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(df1, df2) <span class="sc">%&gt;%</span></span>
<span id="cb114-1135"><a href="#cb114-1135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_units</span>() <span class="sc">%&gt;%</span></span>
<span id="cb114-1136"><a href="#cb114-1136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb114-1137"><a href="#cb114-1137" aria-hidden="true" tabindex="-1"></a>  df1[,varname] <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(dist_matrix <span class="sc">&lt;=</span> radius)</span>
<span id="cb114-1138"><a href="#cb114-1138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df1)</span>
<span id="cb114-1139"><a href="#cb114-1139" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-1140"><a href="#cb114-1140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1141"><a href="#cb114-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1144"><a href="#cb114-1144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1145"><a href="#cb114-1145" aria-hidden="true" tabindex="-1"></a><span class="co">#Numbers of kindergartens within 350m, Numbers of childcare centres within 350m, Numbers of bus stop within 350m, Numbers of primary school within 1km</span></span>
<span id="cb114-1146"><a href="#cb114-1146" aria-hidden="true" tabindex="-1"></a>resale_sf <span class="ot">&lt;-</span> </span>
<span id="cb114-1147"><a href="#cb114-1147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(resale_sf, kindergartens_sf, <span class="st">"NUM_KNDRGTN"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1148"><a href="#cb114-1148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., childcare_sf, <span class="st">"NUM_CHILDCARE"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1149"><a href="#cb114-1149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., bus_stop_sf, <span class="st">"NUM_BUS_STOP"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1150"><a href="#cb114-1150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., primary_school_sf, <span class="st">"NUM_PRISCH"</span>, <span class="dv">1000</span>)</span>
<span id="cb114-1151"><a href="#cb114-1151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1152"><a href="#cb114-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1153"><a href="#cb114-1153" aria-hidden="true" tabindex="-1"></a>Once again, I would like to save the latest resale_sf file.</span>
<span id="cb114-1154"><a href="#cb114-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1157"><a href="#cb114-1157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1158"><a href="#cb114-1158" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1159"><a href="#cb114-1159" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale_sf, <span class="st">"data/rds/resale_sf_complete.rds"</span>)</span>
<span id="cb114-1160"><a href="#cb114-1160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1161"><a href="#cb114-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1164"><a href="#cb114-1164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1165"><a href="#cb114-1165" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(<span class="fu">readRDS</span>(<span class="st">"data/rds/resale_sf_complete.rds"</span>))</span>
<span id="cb114-1166"><a href="#cb114-1166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1167"><a href="#cb114-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1168"><a href="#cb114-1168" aria-hidden="true" tabindex="-1"></a><span class="fu"># Train-Test Split</span></span>
<span id="cb114-1169"><a href="#cb114-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1170"><a href="#cb114-1170" aria-hidden="true" tabindex="-1"></a>As earlier mentioned, for the resale dataset,</span>
<span id="cb114-1171"><a href="#cb114-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1172"><a href="#cb114-1172" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Training dataset period: October 2022 to December 2023</span>
<span id="cb114-1173"><a href="#cb114-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1174"><a href="#cb114-1174" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Test dataset period: January 2023 to February 2023</span>
<span id="cb114-1175"><a href="#cb114-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1176"><a href="#cb114-1176" aria-hidden="true" tabindex="-1"></a>Hence, the code chunk below reads the rds file - resale_sf which we created earlier on and splits the dataset accordingly.</span>
<span id="cb114-1177"><a href="#cb114-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1180"><a href="#cb114-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1181"><a href="#cb114-1181" aria-hidden="true" tabindex="-1"></a>resale_sf_complete<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/rds/resale_sf_complete.rds"</span>)</span>
<span id="cb114-1182"><a href="#cb114-1182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1183"><a href="#cb114-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1186"><a href="#cb114-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1187"><a href="#cb114-1187" aria-hidden="true" tabindex="-1"></a>resale_train <span class="ot">&lt;-</span> resale_sf_complete <span class="sc">%&gt;%</span></span>
<span id="cb114-1188"><a href="#cb114-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2022-10"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2022-12"</span>,</span>
<span id="cb114-1189"><a href="#cb114-1189" aria-hidden="true" tabindex="-1"></a>         flat_type <span class="sc">==</span> <span class="st">"5 ROOM"</span>) </span>
<span id="cb114-1190"><a href="#cb114-1190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1191"><a href="#cb114-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1194"><a href="#cb114-1194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1195"><a href="#cb114-1195" aria-hidden="true" tabindex="-1"></a>resale_test <span class="ot">&lt;-</span> resale_sf_complete <span class="sc">%&gt;%</span></span>
<span id="cb114-1196"><a href="#cb114-1196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2023-01"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2023-02"</span>,</span>
<span id="cb114-1197"><a href="#cb114-1197" aria-hidden="true" tabindex="-1"></a>         flat_type <span class="sc">==</span> <span class="st">"5 ROOM"</span>) </span>
<span id="cb114-1198"><a href="#cb114-1198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1199"><a href="#cb114-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1200"><a href="#cb114-1200" aria-hidden="true" tabindex="-1"></a>For future references, I will be writing the train and test data set of resale_sf as a rds file.</span>
<span id="cb114-1201"><a href="#cb114-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1204"><a href="#cb114-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1205"><a href="#cb114-1205" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1206"><a href="#cb114-1206" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale_train, <span class="st">"data/model/resale_train.rds"</span>)</span>
<span id="cb114-1207"><a href="#cb114-1207" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale_test, <span class="st">"data/model/resale_test.rds"</span>)</span>
<span id="cb114-1208"><a href="#cb114-1208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1209"><a href="#cb114-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1210"><a href="#cb114-1210" aria-hidden="true" tabindex="-1"></a>The code chunk below reads our train and test dataset of resale_sf.</span>
<span id="cb114-1211"><a href="#cb114-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1214"><a href="#cb114-1214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1215"><a href="#cb114-1215" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/resale_train.rds"</span>)</span>
<span id="cb114-1216"><a href="#cb114-1216" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/resale_test.rds"</span>)</span>
<span id="cb114-1217"><a href="#cb114-1217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1218"><a href="#cb114-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1221"><a href="#cb114-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1222"><a href="#cb114-1222" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(train_data)</span>
<span id="cb114-1223"><a href="#cb114-1223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1224"><a href="#cb114-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1225"><a href="#cb114-1225" aria-hidden="true" tabindex="-1"></a>Having a glimpse at our training and test data, I realised that there are some columns that are irrelevant for our subsequent tasks such as flat_model , town, flat_type, block and street_name. Thus, I removed it.</span>
<span id="cb114-1226"><a href="#cb114-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1229"><a href="#cb114-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1230"><a href="#cb114-1230" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span><span class="fu">subset</span>(train_data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(month,flat_model, town,flat_type, block,street_name, storey_range ))</span>
<span id="cb114-1231"><a href="#cb114-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1232"><a href="#cb114-1232" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span><span class="fu">subset</span>(test_data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(month,flat_model, town,flat_type, block,street_name, storey_range ))</span>
<span id="cb114-1233"><a href="#cb114-1233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1234"><a href="#cb114-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1235"><a href="#cb114-1235" aria-hidden="true" tabindex="-1"></a>The lease_commence_date represents the age of the unit that we had calculated earlier on but its name can be misleading so I changed the name to age.</span>
<span id="cb114-1236"><a href="#cb114-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1239"><a href="#cb114-1239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1240"><a href="#cb114-1240" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(train_data)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"age"</span></span>
<span id="cb114-1241"><a href="#cb114-1241" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(test_data)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"age"</span></span>
<span id="cb114-1242"><a href="#cb114-1242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1243"><a href="#cb114-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1244"><a href="#cb114-1244" aria-hidden="true" tabindex="-1"></a>Looking at our data again, the type of age and remaining_lease is characters but it should be numeric/integer so i changed it accordingly.</span>
<span id="cb114-1245"><a href="#cb114-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1248"><a href="#cb114-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1249"><a href="#cb114-1249" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>age  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(train_data<span class="sc">$</span>age)</span>
<span id="cb114-1250"><a href="#cb114-1250" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>age  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data<span class="sc">$</span>age)</span>
<span id="cb114-1251"><a href="#cb114-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1252"><a href="#cb114-1252" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>remaining_lease  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(train_data<span class="sc">$</span>remaining_lease)</span>
<span id="cb114-1253"><a href="#cb114-1253" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>remaining_lease  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data<span class="sc">$</span>remaining_lease)</span>
<span id="cb114-1254"><a href="#cb114-1254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1255"><a href="#cb114-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1256"><a href="#cb114-1256" aria-hidden="true" tabindex="-1"></a>Finally, we are done processing our train and test data for our subsequent tasks!</span>
<span id="cb114-1257"><a href="#cb114-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1258"><a href="#cb114-1258" aria-hidden="true" tabindex="-1"></a>The code chunk below shows a summary of our resale prices.</span>
<span id="cb114-1259"><a href="#cb114-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1262"><a href="#cb114-1262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1263"><a href="#cb114-1263" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train_data<span class="sc">$</span>resale_price)</span>
<span id="cb114-1264"><a href="#cb114-1264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1265"><a href="#cb114-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1266"><a href="#cb114-1266" aria-hidden="true" tabindex="-1"></a><span class="fu"># Computing Correlation Matrix</span></span>
<span id="cb114-1267"><a href="#cb114-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1268"><a href="#cb114-1268" aria-hidden="true" tabindex="-1"></a>Before loading the predictors into a predictive model, it is always a good practice to use correlation matrix to examine if there is sign of multicolinearity.</span>
<span id="cb114-1269"><a href="#cb114-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1270"><a href="#cb114-1270" aria-hidden="true" tabindex="-1"></a>But before that, we need to drop our geometry values.</span>
<span id="cb114-1271"><a href="#cb114-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1274"><a href="#cb114-1274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1275"><a href="#cb114-1275" aria-hidden="true" tabindex="-1"></a>train_nogeo <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
<span id="cb114-1276"><a href="#cb114-1276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb114-1277"><a href="#cb114-1277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1278"><a href="#cb114-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1279"><a href="#cb114-1279" aria-hidden="true" tabindex="-1"></a>The code chunk below saves the rds file for training data without geometry so we can use it later.</span>
<span id="cb114-1280"><a href="#cb114-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1283"><a href="#cb114-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1284"><a href="#cb114-1284" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1285"><a href="#cb114-1285" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(train_nogeo, <span class="st">"data/model/train_nogeo.rds"</span>)</span>
<span id="cb114-1286"><a href="#cb114-1286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1287"><a href="#cb114-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1288"><a href="#cb114-1288" aria-hidden="true" tabindex="-1"></a>The code chunk below computes the correlation matrix.</span>
<span id="cb114-1289"><a href="#cb114-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1292"><a href="#cb114-1292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1293"><a href="#cb114-1293" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(train_nogeo), </span>
<span id="cb114-1294"><a href="#cb114-1294" aria-hidden="true" tabindex="-1"></a>                   <span class="at">diag =</span> <span class="cn">FALSE</span>, </span>
<span id="cb114-1295"><a href="#cb114-1295" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="st">"AOE"</span>,</span>
<span id="cb114-1296"><a href="#cb114-1296" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tl.pos =</span> <span class="st">"td"</span>, </span>
<span id="cb114-1297"><a href="#cb114-1297" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tl.cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb114-1298"><a href="#cb114-1298" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"number"</span>, </span>
<span id="cb114-1299"><a href="#cb114-1299" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"upper"</span>)</span>
<span id="cb114-1300"><a href="#cb114-1300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1301"><a href="#cb114-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1302"><a href="#cb114-1302" aria-hidden="true" tabindex="-1"></a>In <span class="co">[</span><span class="ot">general</span><span class="co">](https://blog.clairvoyantsoft.com/correlation-and-collinearity-how-they-can-make-or-break-a-model-9135fbe6936a)</span>, an absolute correlation coefficient of <span class="sc">\&gt;</span>0.7 among two or more predictors indicates the presence of multicollinearity. As we have a lot of variables, it is quite hard to see the correlation value, but most seems to be okay except age with its correlation to remaining_lease being -1. This indicates that age of the unit and the remaining lease have perfect multicollinearity and we should remove either the age or remaining lease when creating our linear regression model.</span>
<span id="cb114-1303"><a href="#cb114-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1304"><a href="#cb114-1304" aria-hidden="true" tabindex="-1"></a>The code chunk below removes the age of unit from our dataset.</span>
<span id="cb114-1305"><a href="#cb114-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1308"><a href="#cb114-1308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1309"><a href="#cb114-1309" aria-hidden="true" tabindex="-1"></a><span class="co">#removes age column</span></span>
<span id="cb114-1310"><a href="#cb114-1310" aria-hidden="true" tabindex="-1"></a>train_nogeo<span class="ot">&lt;-</span>train_nogeo[,<span class="sc">-</span><span class="dv">2</span>]</span>
<span id="cb114-1311"><a href="#cb114-1311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1312"><a href="#cb114-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1313"><a href="#cb114-1313" aria-hidden="true" tabindex="-1"></a>Another way to check multicolinearity is looking at the Variance Inflation Factor (VIF) which we will perform later.</span>
<span id="cb114-1314"><a href="#cb114-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1315"><a href="#cb114-1315" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multiple Linear Regression Model (OLS)</span></span>
<span id="cb114-1316"><a href="#cb114-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1317"><a href="#cb114-1317" aria-hidden="true" tabindex="-1"></a>First, let's build our multi regression model where y is resale_price and x is the independent predictors.</span>
<span id="cb114-1318"><a href="#cb114-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1321"><a href="#cb114-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1322"><a href="#cb114-1322" aria-hidden="true" tabindex="-1"></a>mlr1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(resale_price <span class="sc">~</span>. ,</span>
<span id="cb114-1323"><a href="#cb114-1323" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train_nogeo)</span>
<span id="cb114-1324"><a href="#cb114-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1325"><a href="#cb114-1325" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlr1)</span>
<span id="cb114-1326"><a href="#cb114-1326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1327"><a href="#cb114-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1328"><a href="#cb114-1328" aria-hidden="true" tabindex="-1"></a>Based on the output, we can infer that the adjusted R square is 0.7054 which roughly indicates that 70% of the variance of the dependent variable being studied is explained by the variance of the independent variable. It seems that most of the predictors are significant (p-value<span class="sc">\&lt;</span>0.5) except for PROX_SPRMKT, PROX_SHOPPINGMALL, PROX_GDPRISCH and NUM_BUS_STOP.</span>
<span id="cb114-1329"><a href="#cb114-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1330"><a href="#cb114-1330" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test of multicollinearity (VIF)</span></span>
<span id="cb114-1331"><a href="#cb114-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1332"><a href="#cb114-1332" aria-hidden="true" tabindex="-1"></a>We can use ols_vif_tol() function of our olsrr package to calculate VIF. In general, if the VIF value is less than 5, then there is usually no sign/possibility of correlations.</span>
<span id="cb114-1333"><a href="#cb114-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1336"><a href="#cb114-1336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1337"><a href="#cb114-1337" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_vif_tol</span>(mlr1)</span>
<span id="cb114-1338"><a href="#cb114-1338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1339"><a href="#cb114-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1340"><a href="#cb114-1340" aria-hidden="true" tabindex="-1"></a>Th higher the VIF, the less reliable our regression results are going to be. Based on the output, there are no signs of multicollinearity as VIF <span class="sc">\&lt;</span>5.</span>
<span id="cb114-1341"><a href="#cb114-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1342"><a href="#cb114-1342" aria-hidden="true" tabindex="-1"></a>The code chunk below saves the results of our model to an rds file.</span>
<span id="cb114-1343"><a href="#cb114-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1346"><a href="#cb114-1346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1347"><a href="#cb114-1347" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1348"><a href="#cb114-1348" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mlr1, <span class="st">"data/model/mlr1.rds"</span> ) </span>
<span id="cb114-1349"><a href="#cb114-1349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1350"><a href="#cb114-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1351"><a href="#cb114-1351" aria-hidden="true" tabindex="-1"></a><span class="fu"># GWR Predictive Method</span></span>
<span id="cb114-1352"><a href="#cb114-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1353"><a href="#cb114-1353" aria-hidden="true" tabindex="-1"></a>In this section, we will calibrate our mlr1 model to predict HDB resale prices.</span>
<span id="cb114-1354"><a href="#cb114-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1355"><a href="#cb114-1355" aria-hidden="true" tabindex="-1"></a><span class="fu">## Converting the sf data.frame to SpatialPointDataFrame</span></span>
<span id="cb114-1356"><a href="#cb114-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1359"><a href="#cb114-1359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1360"><a href="#cb114-1360" aria-hidden="true" tabindex="-1"></a>train_data_sp <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(train_data[,<span class="sc">-</span><span class="dv">2</span>])</span>
<span id="cb114-1361"><a href="#cb114-1361" aria-hidden="true" tabindex="-1"></a>train_data_sp</span>
<span id="cb114-1362"><a href="#cb114-1362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1363"><a href="#cb114-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1364"><a href="#cb114-1364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Computing adaptive bandwidth</span></span>
<span id="cb114-1365"><a href="#cb114-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1368"><a href="#cb114-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1369"><a href="#cb114-1369" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1370"><a href="#cb114-1370" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(resale_price <span class="sc">~</span>.,</span>
<span id="cb114-1371"><a href="#cb114-1371" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> train_data_sp,</span>
<span id="cb114-1372"><a href="#cb114-1372" aria-hidden="true" tabindex="-1"></a>                  <span class="at">approach=</span><span class="st">"CV"</span>,</span>
<span id="cb114-1373"><a href="#cb114-1373" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel=</span><span class="st">"gaussian"</span>,</span>
<span id="cb114-1374"><a href="#cb114-1374" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb114-1375"><a href="#cb114-1375" aria-hidden="true" tabindex="-1"></a>                  <span class="at">longlat=</span><span class="cn">FALSE</span></span>
<span id="cb114-1376"><a href="#cb114-1376" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb114-1377"><a href="#cb114-1377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1378"><a href="#cb114-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1379"><a href="#cb114-1379" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/bw_adaptive_out.PNG)</span>{width="397"}</span>
<span id="cb114-1380"><a href="#cb114-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1381"><a href="#cb114-1381" aria-hidden="true" tabindex="-1"></a>Doing cross-validation while utilising a gaussian kernel, the smallest CV score is 3.054284e+12 and its adaptive bandwidth is 22.</span>
<span id="cb114-1382"><a href="#cb114-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1383"><a href="#cb114-1383" aria-hidden="true" tabindex="-1"></a>Next, we will save the adaptive bandwidth as an rds file.</span>
<span id="cb114-1384"><a href="#cb114-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1387"><a href="#cb114-1387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1388"><a href="#cb114-1388" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1389"><a href="#cb114-1389" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(bw_adaptive, <span class="at">file =</span> <span class="st">"data/model/bw_adaptive.rds"</span>)</span>
<span id="cb114-1390"><a href="#cb114-1390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1391"><a href="#cb114-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1392"><a href="#cb114-1392" aria-hidden="true" tabindex="-1"></a><span class="fu">## Constructing the adaptive bandwidth GWR model</span></span>
<span id="cb114-1393"><a href="#cb114-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1394"><a href="#cb114-1394" aria-hidden="true" tabindex="-1"></a>First, let's call the saved bandwith by using the code chunk below.</span>
<span id="cb114-1395"><a href="#cb114-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1398"><a href="#cb114-1398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1399"><a href="#cb114-1399" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/bw_adaptive.rds"</span>)</span>
<span id="cb114-1400"><a href="#cb114-1400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1401"><a href="#cb114-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1402"><a href="#cb114-1402" aria-hidden="true" tabindex="-1"></a>Now, we can go ahead to calibrate the gwr-based hedonic pricing model by using adaptive bandwidth and Gaussian kernel as shown in the code chunk below.</span>
<span id="cb114-1403"><a href="#cb114-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1406"><a href="#cb114-1406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1407"><a href="#cb114-1407" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1408"><a href="#cb114-1408" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span>.,</span>
<span id="cb114-1409"><a href="#cb114-1409" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data=</span>train_data_sp,</span>
<span id="cb114-1410"><a href="#cb114-1410" aria-hidden="true" tabindex="-1"></a>                          <span class="at">bw=</span>bw_adaptive, </span>
<span id="cb114-1411"><a href="#cb114-1411" aria-hidden="true" tabindex="-1"></a>                          <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
<span id="cb114-1412"><a href="#cb114-1412" aria-hidden="true" tabindex="-1"></a>                          <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb114-1413"><a href="#cb114-1413" aria-hidden="true" tabindex="-1"></a>                          <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb114-1414"><a href="#cb114-1414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1415"><a href="#cb114-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1416"><a href="#cb114-1416" aria-hidden="true" tabindex="-1"></a>The code chunk below will be used to save the model in rds format for future use.</span>
<span id="cb114-1417"><a href="#cb114-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1420"><a href="#cb114-1420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1421"><a href="#cb114-1421" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1422"><a href="#cb114-1422" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwr_adaptive, <span class="st">"data/model/gwr_adaptive.rds"</span>)</span>
<span id="cb114-1423"><a href="#cb114-1423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1424"><a href="#cb114-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1425"><a href="#cb114-1425" aria-hidden="true" tabindex="-1"></a>The code below can be used to display the model output.</span>
<span id="cb114-1426"><a href="#cb114-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1429"><a href="#cb114-1429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1430"><a href="#cb114-1430" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/gwr_adaptive.rds"</span>)</span>
<span id="cb114-1431"><a href="#cb114-1431" aria-hidden="true" tabindex="-1"></a>gwr_adaptive</span>
<span id="cb114-1432"><a href="#cb114-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1433"><a href="#cb114-1433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1434"><a href="#cb114-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1435"><a href="#cb114-1435" aria-hidden="true" tabindex="-1"></a>From the output above, we can observe that the GWR Adjusted R-square is 0.9243233, which is higher than the non-spatial mulitiple linear regression model's Adjusted R-square of 0.709 . Based on <span class="co">[</span><span class="ot">research</span><span class="co">](https://builtin.com/data-science/adjusted-r-squared#:~:text=R%2Dsquared%20measures%20the%20goodness,is%20not%20a%20good%20fit.)</span>, R-squared measures the goodness of fit of a regression model. Hence, a higher R-squared indicates the model is a good fit, while a lower R-squared indicates the model is not a good fit which suggests that the GWR model is a better fit.</span>
<span id="cb114-1436"><a href="#cb114-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1437"><a href="#cb114-1437" aria-hidden="true" tabindex="-1"></a>GWR model also has a lower AIC i.e 35569.1 than the regression model's AIC i.e 37841.04. Based on <span class="co">[</span><span class="ot">research</span><span class="co">](https://www.scribbr.com/statistics/akaike-information-criterion/#:~:text=Lower%20AIC%20scores%20are%20better,be%20the%20better%2Dfit%20model.)</span>, the lower AIC scores, the better it is, as AIC penalizes models that use more parameters.</span>
<span id="cb114-1438"><a href="#cb114-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1439"><a href="#cb114-1439" aria-hidden="true" tabindex="-1"></a><span class="fu"># Preparing coordinates data</span></span>
<span id="cb114-1440"><a href="#cb114-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1441"><a href="#cb114-1441" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extracting coordinates data</span></span>
<span id="cb114-1442"><a href="#cb114-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1443"><a href="#cb114-1443" aria-hidden="true" tabindex="-1"></a>The code chunk below extract the x,y coordinates of the full, training and test data sets.</span>
<span id="cb114-1444"><a href="#cb114-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1447"><a href="#cb114-1447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1448"><a href="#cb114-1448" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(train_data)</span>
<span id="cb114-1449"><a href="#cb114-1449" aria-hidden="true" tabindex="-1"></a>coords_test <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(test_data)</span>
<span id="cb114-1450"><a href="#cb114-1450" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1451"><a href="#cb114-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1452"><a href="#cb114-1452" aria-hidden="true" tabindex="-1"></a>Before continue, we write all the output into rds for future uses</span>
<span id="cb114-1453"><a href="#cb114-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1456"><a href="#cb114-1456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1457"><a href="#cb114-1457" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1458"><a href="#cb114-1458" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(coords_train, <span class="st">"data/model/coords_train.rds"</span> )</span>
<span id="cb114-1459"><a href="#cb114-1459" aria-hidden="true" tabindex="-1"></a>coords_test <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(coords_test, <span class="st">"data/model/coords_test.rds"</span> )</span>
<span id="cb114-1460"><a href="#cb114-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1461"><a href="#cb114-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1462"><a href="#cb114-1462" aria-hidden="true" tabindex="-1"></a>Now, we need to retrieve our training data, which does not have the geometry.</span>
<span id="cb114-1463"><a href="#cb114-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1466"><a href="#cb114-1466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1467"><a href="#cb114-1467" aria-hidden="true" tabindex="-1"></a>train_nogeo_rds<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"data/model/train_nogeo.rds"</span>)</span>
<span id="cb114-1468"><a href="#cb114-1468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1469"><a href="#cb114-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1470"><a href="#cb114-1470" aria-hidden="true" tabindex="-1"></a><span class="fu"># Calibrating Random Forest Model</span></span>
<span id="cb114-1471"><a href="#cb114-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1472"><a href="#cb114-1472" aria-hidden="true" tabindex="-1"></a>Now, we will calibrate a model to predict HDB resale price by using random forest function of ranger package. Set.seed() is used to keep results constant as random forest is a simulation. Based on <span class="co">[</span><span class="ot">research</span><span class="co">](https://medium.com/@raj5287/effects-of-multi-collinearity-in-logistic-regression-svm-rf-af6766d91f1b#:~:text=Random%20Forest%20uses%20bootstrap%20sampling,different%20set%20of%20data%20points.)</span>, random forest uses bootstrap sampling and feature sampling, i.e row sampling and column sampling. Therefore, Random Forest is not affected by multicollinearity that much since it is picking different set of features for different models and every model sees a different set of data points. This means that I do not need to remove the age variable.</span>
<span id="cb114-1473"><a href="#cb114-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1476"><a href="#cb114-1476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1477"><a href="#cb114-1477" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb114-1478"><a href="#cb114-1478" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(resale_price <span class="sc">~</span>.,</span>
<span id="cb114-1479"><a href="#cb114-1479" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>train_nogeo_rds)</span>
<span id="cb114-1480"><a href="#cb114-1480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1481"><a href="#cb114-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1484"><a href="#cb114-1484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1485"><a href="#cb114-1485" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf)</span>
<span id="cb114-1486"><a href="#cb114-1486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1487"><a href="#cb114-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1488"><a href="#cb114-1488" aria-hidden="true" tabindex="-1"></a>Based on the output, for a random forest of 500 trees, the OOB prediction error (MSE) is 2833677157 and the R squared (OOB) / R2 is 0.8524123 which implies that around 85% of the variance of the train data is explained by the model.</span>
<span id="cb114-1489"><a href="#cb114-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1492"><a href="#cb114-1492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1493"><a href="#cb114-1493" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(rf<span class="sc">$</span>prediction.error)</span>
<span id="cb114-1494"><a href="#cb114-1494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1495"><a href="#cb114-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1496"><a href="#cb114-1496" aria-hidden="true" tabindex="-1"></a>Random forest rmse is 53232.29.</span>
<span id="cb114-1497"><a href="#cb114-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1498"><a href="#cb114-1498" aria-hidden="true" tabindex="-1"></a><span class="fu"># Calibrating a Geographically Weighted Random Forest</span></span>
<span id="cb114-1499"><a href="#cb114-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1500"><a href="#cb114-1500" aria-hidden="true" tabindex="-1"></a>Next, we would like to calibrate the Geographically Weighted Random Forest by using the grf.bw() function. As the grf.bw() function is computationally expensive, I will be running it on a subset of the data (500 rows). Even though the bandwidth of using 500 rows would differ a lot from the bandwidth of using the whole dataset, but for this assignment approximating it on a subset is good enough as a proof of concept.</span>
<span id="cb114-1501"><a href="#cb114-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1504"><a href="#cb114-1504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1505"><a href="#cb114-1505" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1506"><a href="#cb114-1506" aria-hidden="true" tabindex="-1"></a>gwRF_bw <span class="ot">&lt;-</span> <span class="fu">grf.bw</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> </span>
<span id="cb114-1507"><a href="#cb114-1507" aria-hidden="true" tabindex="-1"></a>                    age <span class="sc">+</span></span>
<span id="cb114-1508"><a href="#cb114-1508" aria-hidden="true" tabindex="-1"></a>                    remaining_lease <span class="sc">+</span> </span>
<span id="cb114-1509"><a href="#cb114-1509" aria-hidden="true" tabindex="-1"></a>                    floor_area_sqm <span class="sc">+</span></span>
<span id="cb114-1510"><a href="#cb114-1510" aria-hidden="true" tabindex="-1"></a>                    storey_order <span class="sc">+</span></span>
<span id="cb114-1511"><a href="#cb114-1511" aria-hidden="true" tabindex="-1"></a>                    PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb114-1512"><a href="#cb114-1512" aria-hidden="true" tabindex="-1"></a>                    PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_GDPRISCH <span class="sc">+</span> PROX_SPRMKT <span class="sc">+</span></span>
<span id="cb114-1513"><a href="#cb114-1513" aria-hidden="true" tabindex="-1"></a>                    PROX_SHOPPINGMALL <span class="sc">+</span> </span>
<span id="cb114-1514"><a href="#cb114-1514" aria-hidden="true" tabindex="-1"></a>                    NUM_KNDRGTN <span class="sc">+</span> NUM_CHILDCARE <span class="sc">+</span> NUM_BUS_STOP <span class="sc">+</span> NUM_PRISCH,</span>
<span id="cb114-1515"><a href="#cb114-1515" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train_nogeo_rds[<span class="dv">0</span><span class="sc">:</span><span class="dv">500</span>,],</span>
<span id="cb114-1516"><a href="#cb114-1516" aria-hidden="true" tabindex="-1"></a>                <span class="at">kernel =</span> <span class="st">"adaptive"</span>,</span>
<span id="cb114-1517"><a href="#cb114-1517" aria-hidden="true" tabindex="-1"></a>                <span class="at">trees =</span> <span class="dv">30</span>,</span>
<span id="cb114-1518"><a href="#cb114-1518" aria-hidden="true" tabindex="-1"></a>                <span class="at">coords =</span> coords_train[<span class="dv">0</span><span class="sc">:</span><span class="dv">500</span>,]</span>
<span id="cb114-1519"><a href="#cb114-1519" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb114-1520"><a href="#cb114-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1521"><a href="#cb114-1521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1522"><a href="#cb114-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1523"><a href="#cb114-1523" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/bw_gwr2.PNG)</span>{width="389"}</span>
<span id="cb114-1524"><a href="#cb114-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1525"><a href="#cb114-1525" aria-hidden="true" tabindex="-1"></a>As computation time is too long, I will use what has been generated so far. Based on the output, the best bandwidth is 85 with a R2 of 0.761592272965718.</span>
<span id="cb114-1526"><a href="#cb114-1526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1527"><a href="#cb114-1527" aria-hidden="true" tabindex="-1"></a>Next, I used the bandwidth discovered previously to calibrate our GWRF model. Afterwards, I saved it into an rds file.</span>
<span id="cb114-1528"><a href="#cb114-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1531"><a href="#cb114-1531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1532"><a href="#cb114-1532" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb114-1533"><a href="#cb114-1533" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">grf</span>(resale_price <span class="sc">~</span> </span>
<span id="cb114-1534"><a href="#cb114-1534" aria-hidden="true" tabindex="-1"></a>                    age <span class="sc">+</span></span>
<span id="cb114-1535"><a href="#cb114-1535" aria-hidden="true" tabindex="-1"></a>                    remaining_lease <span class="sc">+</span> </span>
<span id="cb114-1536"><a href="#cb114-1536" aria-hidden="true" tabindex="-1"></a>                    floor_area_sqm <span class="sc">+</span> storey_order <span class="sc">+</span></span>
<span id="cb114-1537"><a href="#cb114-1537" aria-hidden="true" tabindex="-1"></a>                    PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb114-1538"><a href="#cb114-1538" aria-hidden="true" tabindex="-1"></a>                    PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_GDPRISCH <span class="sc">+</span> PROX_SPRMKT <span class="sc">+</span></span>
<span id="cb114-1539"><a href="#cb114-1539" aria-hidden="true" tabindex="-1"></a>                    PROX_SHOPPINGMALL <span class="sc">+</span> </span>
<span id="cb114-1540"><a href="#cb114-1540" aria-hidden="true" tabindex="-1"></a>                    NUM_KNDRGTN <span class="sc">+</span> NUM_CHILDCARE <span class="sc">+</span> NUM_BUS_STOP <span class="sc">+</span> NUM_PRISCH,</span>
<span id="cb114-1541"><a href="#cb114-1541" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dframe=</span>train_nogeo_rds, </span>
<span id="cb114-1542"><a href="#cb114-1542" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bw=</span> <span class="dv">85</span>,</span>
<span id="cb114-1543"><a href="#cb114-1543" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ntree =</span> <span class="dv">30</span>,</span>
<span id="cb114-1544"><a href="#cb114-1544" aria-hidden="true" tabindex="-1"></a>                     <span class="at">kernel=</span><span class="st">"adaptive"</span>,</span>
<span id="cb114-1545"><a href="#cb114-1545" aria-hidden="true" tabindex="-1"></a>                     <span class="at">coords=</span>coords_train)</span>
<span id="cb114-1546"><a href="#cb114-1546" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwRF_adaptive, <span class="st">"data/model/gwRF_adaptive.rds"</span>)</span>
<span id="cb114-1547"><a href="#cb114-1547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1548"><a href="#cb114-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1551"><a href="#cb114-1551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1552"><a href="#cb114-1552" aria-hidden="true" tabindex="-1"></a><span class="co">#write_rds(gwRF_adaptive, "data/model/gwRF_adaptive.rds")</span></span>
<span id="cb114-1553"><a href="#cb114-1553" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/gwRF_adaptive.rds"</span>)</span>
<span id="cb114-1554"><a href="#cb114-1554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1555"><a href="#cb114-1555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1558"><a href="#cb114-1558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1559"><a href="#cb114-1559" aria-hidden="true" tabindex="-1"></a><span class="co">#look at important variables</span></span>
<span id="cb114-1560"><a href="#cb114-1560" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gwRF_adaptive<span class="sc">$</span>Local.Variable.Importance)</span>
<span id="cb114-1561"><a href="#cb114-1561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1562"><a href="#cb114-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1565"><a href="#cb114-1565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1566"><a href="#cb114-1566" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive<span class="sc">$</span>Global.Model</span>
<span id="cb114-1567"><a href="#cb114-1567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1568"><a href="#cb114-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1569"><a href="#cb114-1569" aria-hidden="true" tabindex="-1"></a>The output shows that the R2 is 0.8331023. for a GWR model of 30 trees and a bandwidth of 86.</span>
<span id="cb114-1570"><a href="#cb114-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1571"><a href="#cb114-1571" aria-hidden="true" tabindex="-1"></a><span class="fu"># Predicting by using Test Data</span></span>
<span id="cb114-1572"><a href="#cb114-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1573"><a href="#cb114-1573" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multiple Linear Regression (OLS)</span></span>
<span id="cb114-1574"><a href="#cb114-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1575"><a href="#cb114-1575" aria-hidden="true" tabindex="-1"></a>The code chunk below uses predict.lm() function of the stats package to run inference on our test data and save it into RDS format.</span>
<span id="cb114-1576"><a href="#cb114-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1579"><a href="#cb114-1579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1580"><a href="#cb114-1580" aria-hidden="true" tabindex="-1"></a>ols_pred <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(mlr1, test_data[,<span class="sc">-</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb114-1581"><a href="#cb114-1581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"data/model/ols_pred.rds"</span>)</span>
<span id="cb114-1582"><a href="#cb114-1582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1583"><a href="#cb114-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1584"><a href="#cb114-1584" aria-hidden="true" tabindex="-1"></a><span class="fu">## Random Forest</span></span>
<span id="cb114-1585"><a href="#cb114-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1586"><a href="#cb114-1586" aria-hidden="true" tabindex="-1"></a>The code chunk below uses predict() function of the ranger package to run inference on our test data and save it into RDS format.</span>
<span id="cb114-1587"><a href="#cb114-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1590"><a href="#cb114-1590" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1591"><a href="#cb114-1591" aria-hidden="true" tabindex="-1"></a>rf_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf, test_data) <span class="sc">%&gt;%</span></span>
<span id="cb114-1592"><a href="#cb114-1592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"data/model/rf_pred.rds"</span>)</span>
<span id="cb114-1593"><a href="#cb114-1593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1594"><a href="#cb114-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1595"><a href="#cb114-1595" aria-hidden="true" tabindex="-1"></a><span class="fu">## GWRF model</span></span>
<span id="cb114-1596"><a href="#cb114-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1597"><a href="#cb114-1597" aria-hidden="true" tabindex="-1"></a>The code chunk below will be used to combine the test data with its corresponding coordinates data.</span>
<span id="cb114-1598"><a href="#cb114-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1601"><a href="#cb114-1601" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1602"><a href="#cb114-1602" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, coords_test) <span class="sc">%&gt;%</span></span>
<span id="cb114-1603"><a href="#cb114-1603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb114-1604"><a href="#cb114-1604" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1605"><a href="#cb114-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1606"><a href="#cb114-1606" aria-hidden="true" tabindex="-1"></a>Next, predict.grf() of spatialML package will be used to predict the resale value by using the test data and gwRF_adaptive model calibrated earlier.</span>
<span id="cb114-1607"><a href="#cb114-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1610"><a href="#cb114-1610" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1611"><a href="#cb114-1611" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1612"><a href="#cb114-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1613"><a href="#cb114-1613" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb114-1614"><a href="#cb114-1614" aria-hidden="true" tabindex="-1"></a>gwRF_pred <span class="ot">&lt;-</span> <span class="fu">predict.grf</span>(gwRF_adaptive, </span>
<span id="cb114-1615"><a href="#cb114-1615" aria-hidden="true" tabindex="-1"></a>                           test_data, </span>
<span id="cb114-1616"><a href="#cb114-1616" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x.var.name=</span><span class="st">"X"</span>,</span>
<span id="cb114-1617"><a href="#cb114-1617" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y.var.name=</span><span class="st">"Y"</span>, </span>
<span id="cb114-1618"><a href="#cb114-1618" aria-hidden="true" tabindex="-1"></a>                           <span class="at">local.w=</span><span class="dv">1</span>,</span>
<span id="cb114-1619"><a href="#cb114-1619" aria-hidden="true" tabindex="-1"></a>                           <span class="at">global.w=</span><span class="dv">0</span>)</span>
<span id="cb114-1620"><a href="#cb114-1620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1621"><a href="#cb114-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1622"><a href="#cb114-1622" aria-hidden="true" tabindex="-1"></a>Before moving on, let us save the output into rds file for future use.</span>
<span id="cb114-1623"><a href="#cb114-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1626"><a href="#cb114-1626" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1627"><a href="#cb114-1627" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1628"><a href="#cb114-1628" aria-hidden="true" tabindex="-1"></a>GRF_pred <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(gwRF_pred, <span class="st">"data/model/GRF_pred.rds"</span>)</span>
<span id="cb114-1629"><a href="#cb114-1629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1630"><a href="#cb114-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1631"><a href="#cb114-1631" aria-hidden="true" tabindex="-1"></a>The output of the predict.grf() is a vector of predicted values. It is wiser to convert it into a data frame for further visualisation and analysis.</span>
<span id="cb114-1632"><a href="#cb114-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1635"><a href="#cb114-1635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1636"><a href="#cb114-1636" aria-hidden="true" tabindex="-1"></a>GRF_pred <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/GRF_pred.rds"</span>)</span>
<span id="cb114-1637"><a href="#cb114-1637" aria-hidden="true" tabindex="-1"></a>GRF_pred_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(GRF_pred)</span>
<span id="cb114-1638"><a href="#cb114-1638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1639"><a href="#cb114-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1640"><a href="#cb114-1640" aria-hidden="true" tabindex="-1"></a>In the code chunk below, cbind() is used to append the predicted values for both the GRF and multiple linear regression mode onto test_data.</span>
<span id="cb114-1641"><a href="#cb114-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1644"><a href="#cb114-1644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1645"><a href="#cb114-1645" aria-hidden="true" tabindex="-1"></a><span class="co">#for gwrf</span></span>
<span id="cb114-1646"><a href="#cb114-1646" aria-hidden="true" tabindex="-1"></a>test_data_p <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, GRF_pred_df)</span>
<span id="cb114-1647"><a href="#cb114-1647" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1648"><a href="#cb114-1648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1651"><a href="#cb114-1651" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1652"><a href="#cb114-1652" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb114-1653"><a href="#cb114-1653" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(test_data_p, <span class="st">"data/model/test_data_p.rds"</span>)</span>
<span id="cb114-1654"><a href="#cb114-1654" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1655"><a href="#cb114-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1656"><a href="#cb114-1656" aria-hidden="true" tabindex="-1"></a><span class="fu">## Models Evaluation</span></span>
<span id="cb114-1657"><a href="#cb114-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1658"><a href="#cb114-1658" aria-hidden="true" tabindex="-1"></a>To evaluate the 3 models, we can combine the resale price and predicted prices of each model into a single dataframe.</span>
<span id="cb114-1659"><a href="#cb114-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1662"><a href="#cb114-1662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1663"><a href="#cb114-1663" aria-hidden="true" tabindex="-1"></a>ols_pred_df <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/ols_pred.rds"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-1664"><a href="#cb114-1664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb114-1665"><a href="#cb114-1665" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ols_pred_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ols_pred"</span>)</span>
<span id="cb114-1666"><a href="#cb114-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1667"><a href="#cb114-1667" aria-hidden="true" tabindex="-1"></a>rf_pred_df <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/rf_pred.rds"</span>)<span class="sc">$</span>predictions <span class="sc">%&gt;%</span></span>
<span id="cb114-1668"><a href="#cb114-1668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb114-1669"><a href="#cb114-1669" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rf_pred_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rf_pred"</span>)</span>
<span id="cb114-1670"><a href="#cb114-1670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1671"><a href="#cb114-1671" aria-hidden="true" tabindex="-1"></a>gwRF_pred_df <span class="ot">&lt;-</span>  GRF_pred <span class="sc">%&gt;%</span></span>
<span id="cb114-1672"><a href="#cb114-1672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb114-1673"><a href="#cb114-1673" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gwRF_pred_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gwrf_pred"</span>)</span>
<span id="cb114-1674"><a href="#cb114-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1675"><a href="#cb114-1675" aria-hidden="true" tabindex="-1"></a>prices_pred_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data<span class="sc">$</span>resale_price, ols_pred_df, rf_pred_df,</span>
<span id="cb114-1676"><a href="#cb114-1676" aria-hidden="true" tabindex="-1"></a>                        gwRF_pred_df) <span class="sc">%&gt;%</span> </span>
<span id="cb114-1677"><a href="#cb114-1677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"actual_price"</span> <span class="ot">=</span> <span class="st">"test_data$resale_price"</span>)</span>
<span id="cb114-1678"><a href="#cb114-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1679"><a href="#cb114-1679" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prices_pred_df)</span>
<span id="cb114-1680"><a href="#cb114-1680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1681"><a href="#cb114-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1682"><a href="#cb114-1682" aria-hidden="true" tabindex="-1"></a>Looking at the results, it seems like gwrf model has the closest predicted value to the actual price as compared to the other models.</span>
<span id="cb114-1683"><a href="#cb114-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1684"><a href="#cb114-1684" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculating Root Mean Square Error</span></span>
<span id="cb114-1685"><a href="#cb114-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1686"><a href="#cb114-1686" aria-hidden="true" tabindex="-1"></a>The root mean square error (RMSE) allows us to measure how far predicted values are from observed values in a regression analysis.</span>
<span id="cb114-1687"><a href="#cb114-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1688"><a href="#cb114-1688" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multiple Linear Regression (OLS)</span></span>
<span id="cb114-1689"><a href="#cb114-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1692"><a href="#cb114-1692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1693"><a href="#cb114-1693" aria-hidden="true" tabindex="-1"></a><span class="co">#lm</span></span>
<span id="cb114-1694"><a href="#cb114-1694" aria-hidden="true" tabindex="-1"></a><span class="co">#MSE &lt;- mean((test_data$resale_price - lm_predicted_value)^2)</span></span>
<span id="cb114-1695"><a href="#cb114-1695" aria-hidden="true" tabindex="-1"></a><span class="co">#rmse_lm &lt;- sqrt(MSE)</span></span>
<span id="cb114-1696"><a href="#cb114-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1697"><a href="#cb114-1697" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((prices_pred_df<span class="sc">$</span>actual_price <span class="sc">-</span> prices_pred_df<span class="sc">$</span>ols_pred)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb114-1698"><a href="#cb114-1698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1699"><a href="#cb114-1699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1700"><a href="#cb114-1700" aria-hidden="true" tabindex="-1"></a><span class="fu">### Random Forest</span></span>
<span id="cb114-1701"><a href="#cb114-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1704"><a href="#cb114-1704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1705"><a href="#cb114-1705" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((prices_pred_df<span class="sc">$</span>actual_price <span class="sc">-</span> prices_pred_df<span class="sc">$</span>rf_pred)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb114-1706"><a href="#cb114-1706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1707"><a href="#cb114-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1708"><a href="#cb114-1708" aria-hidden="true" tabindex="-1"></a><span class="fu">### GWRF model</span></span>
<span id="cb114-1709"><a href="#cb114-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1710"><a href="#cb114-1710" aria-hidden="true" tabindex="-1"></a>In the code chunk below, rmse() of Metrics package is used to compute the RMSE for GRF model.</span>
<span id="cb114-1711"><a href="#cb114-1711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1714"><a href="#cb114-1714" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1715"><a href="#cb114-1715" aria-hidden="true" tabindex="-1"></a><span class="co">#grf</span></span>
<span id="cb114-1716"><a href="#cb114-1716" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse</span>(test_data_p<span class="sc">$</span>resale_price, </span>
<span id="cb114-1717"><a href="#cb114-1717" aria-hidden="true" tabindex="-1"></a>     test_data_p<span class="sc">$</span>GRF_pred)</span>
<span id="cb114-1718"><a href="#cb114-1718" aria-hidden="true" tabindex="-1"></a><span class="co">#sqrt(mean((prices_pred_df$actual_price - prices_pred_df$gwrf_pred)^2))</span></span>
<span id="cb114-1719"><a href="#cb114-1719" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1720"><a href="#cb114-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1721"><a href="#cb114-1721" aria-hidden="true" tabindex="-1"></a>Comparing the 3 models RMSE, the GWRF model has the lowest RMSE of 53185.72 as compared to OLS model's RMSE of 69388.4 and random forest model's RMSE of 52045.52. <span class="co">[</span><span class="ot">RMSE</span><span class="co">]</span>(https://help.sap.com/docs/SAP_PREDICTIVE_ANALYTICS/41d1a6d4e7574e32b815f1cc87c00f42/5e5198fd4afe4ae5b48fefe0d3161810.html#:~:text=The%20Root%20Mean%20Squared%20Error%20(RMSE)%20is%20one%20of%20the,the%20target%20value%20(accuracy).) measures the average difference between values predicted by a model and the actual values and provides an estimation of how well the model is able to predict the target value (accuracy). Hence, among the 3 models, the GWRF model will be better model at predicting the resale price.</span>
<span id="cb114-1722"><a href="#cb114-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1723"><a href="#cb114-1723" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualising the Predicted Values</span></span>
<span id="cb114-1724"><a href="#cb114-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1727"><a href="#cb114-1727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb114-1728"><a href="#cb114-1728" aria-hidden="true" tabindex="-1"></a>test_data_models <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, prices_pred_df)</span>
<span id="cb114-1729"><a href="#cb114-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1730"><a href="#cb114-1730" aria-hidden="true" tabindex="-1"></a>gwr_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> test_data_p,</span>
<span id="cb114-1731"><a href="#cb114-1731" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> GRF_pred,</span>
<span id="cb114-1732"><a href="#cb114-1732" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> resale_price)) <span class="sc">+</span></span>
<span id="cb114-1733"><a href="#cb114-1733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb114-1734"><a href="#cb114-1734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">col =</span> <span class="st">"Red"</span>)</span>
<span id="cb114-1735"><a href="#cb114-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1736"><a href="#cb114-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1737"><a href="#cb114-1737" aria-hidden="true" tabindex="-1"></a>lm_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> test_data_models,</span>
<span id="cb114-1738"><a href="#cb114-1738" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ols_pred,</span>
<span id="cb114-1739"><a href="#cb114-1739" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> actual_price)) <span class="sc">+</span></span>
<span id="cb114-1740"><a href="#cb114-1740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb114-1741"><a href="#cb114-1741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">col =</span> <span class="st">"Red"</span>)</span>
<span id="cb114-1742"><a href="#cb114-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1743"><a href="#cb114-1743" aria-hidden="true" tabindex="-1"></a>rf_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> test_data_models,</span>
<span id="cb114-1744"><a href="#cb114-1744" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> rf_pred,</span>
<span id="cb114-1745"><a href="#cb114-1745" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> actual_price)) <span class="sc">+</span></span>
<span id="cb114-1746"><a href="#cb114-1746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb114-1747"><a href="#cb114-1747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">col =</span> <span class="st">"Red"</span>)</span>
<span id="cb114-1748"><a href="#cb114-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1749"><a href="#cb114-1749" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(gwr_plot, lm_plot, rf_plot, <span class="at">labels =</span> <span class="st">"AUTO"</span>)</span>
<span id="cb114-1750"><a href="#cb114-1750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-1751"><a href="#cb114-1751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1752"><a href="#cb114-1752" aria-hidden="true" tabindex="-1"></a>By comparing the 3 graphs, GWRF model is more linear while OLS and random forest model points on the right half side, majority of it is above the red line. Thus, we can see that the GWRF model is better than the OLS and random forest model as the scatter points are more closer to the diagonal line.</span>
<span id="cb114-1753"><a href="#cb114-1753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1754"><a href="#cb114-1754" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb114-1755"><a href="#cb114-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-1756"><a href="#cb114-1756" aria-hidden="true" tabindex="-1"></a>In conclusion, be comparing the 3 models' performance at predicting the actual resale prices, the RMSE and visualisation of its scatterplots, we can determine that GWRF model is the best model at predicting the actual resale prices. One of the reasons why it performs better is because <span class="co">[</span><span class="ot">GWR</span><span class="co">](https://www.publichealth.columbia.edu/research/population-health-methods/geographically-weighted-regression#:~:text=outcome%20of%20interest.-,Description,variables%20to%20vary%20by%20locality.)</span> is an outgrowth of ordinary least squares regression (OLS) and adds a level of modeling sophistication by allowing the relationships between the independent and dependent variables to vary by locality.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>